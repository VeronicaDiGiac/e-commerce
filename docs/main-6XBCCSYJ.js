import{A as $,B as ht,C as Le,D as oh,E as sy,F as Gs,G as ne,H as pt,I as Ha,J as ah,K as Tt,L as Dn,M as vr,N as Ya,O as oy,P as ay,Q as xt,R as Ue,a as O,b as ci,c as za,d as Y_,e as J_,f as Ge,g as Ka,h as qs,i as rh,j as X_,k as qt,l as ih,m as Wa,n as Z_,o as ey,p as $a,q as De,r as ty,s as ny,t as Et,u as Nn,v as Qa,w as js,x as sh,y as ry,z as iy}from"./chunk-X5CCQU5A.js";import{a as H_}from"./chunk-4GH6JR52.js";import{a as W_,b as $_,c as Q_}from"./chunk-EVJX2DWG.js";import{a as j_,b as G_,d as z_,e as K_}from"./chunk-XCM34SZF.js";import{b as q_}from"./chunk-JF4C552L.js";import{d as B_,n as Ga}from"./chunk-4BUPRBWX.js";import{$ as Pn,A as Ls,Ca as Bt,Cb as L_,Db as nh,G as La,I as A_,Ia as kn,Jb as U_,L as Ua,N as _r,Na as Bs,O as S_,Oa as N_,P as Gu,Q as C_,R as Ba,S as an,T as zu,Ta as Ju,V as b_,W as R_,X as Ku,Ya as D_,_ as Rn,ab as V_,ba as je,c as Cn,da as W,db as we,ea as Us,eb as Ne,f as T_,fa as P_,fb as yr,ha as qa,i as ai,ia as xn,ib as Xu,j as I_,jb as Zu,kb as eh,l as gr,lb as it,m as li,ma as x_,mb as O_,n as bn,nb as th,o as Ut,pb as ja,qa as k_,s as Se,sa as Wu,ta as $u,ua as Qu,ub as M_,va as Hu,vb as F_,z as Fs,za as Yu}from"./chunk-KH45VKOF.js";import{a as oi,b as Ms,d as ju,e as x}from"./chunk-7A67K276.js";var ly=[{path:"home",loadComponent:()=>import("./chunk-6SLO5FRM.js")},{path:"card",loadComponent:()=>import("./chunk-DLS7Z6PB.js")},{path:"cart",loadComponent:()=>import("./chunk-TNEUWOCD.js")},{path:"woman-section",loadComponent:()=>import("./chunk-2ADKMU5E.js")},{path:"man-section",loadComponent:()=>import("./chunk-UJBEOOF3.js")},{path:"contact",loadComponent:()=>import("./chunk-RTKSJSA7.js").then(n=>n.ContactComponent)},{path:"profile",loadComponent:()=>import("./chunk-4LLO43G3.js").then(n=>n.ProfileComponent),canActivate:[Q_]},{path:"",redirectTo:"home",pathMatch:"full"}];var pA="firebase",mA="10.14.1";xt(pA,mA,"app");var cn=new M_("ANGULARFIRE2_VERSION");var gA=(n,e)=>{let t=e?[e]:ay(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},ln=class{constructor(){return gA(_A)}},_A="app-check";function lh(){}var Ja=class{zone;delegate;constructor(e,t=I_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},ch=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",lh,{},lh,lh)),t.pipe(b_({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},hi=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Ja(Zone.current)),this.insideAngular=t.run(()=>new Ja(Zone.current,ai)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(W(Bt))};static \u0275prov=Rn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function yA(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function be(n){return vA(yA())(n)}function vA(n){return function(t){return t=t.lift(new ch(n.ngZone)),t.pipe(li(n.outsideAngular),gr(n.insideAngular))}}var wA="firebase",EA="10.14.1";Ue.registerVersion(wA,EA,"app-compat");var TA=["ngOnDestroy"],uy=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(TA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(d=>{let p=d?.(...u);return r?.spy?.apply&&r.spy.apply(s,u,p),p})})})});var Xa=class{constructor(e){return e}},Vn=new je("angularfire2.app.options"),On=new je("angularfire2.app.name");function wr(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Ue.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Ue.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;IA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Xa(o)}var IA=(n,...e)=>{nh()&&typeof console<"u"&&console[n](...e)},AA={provide:Xa,useFactory:wr,deps:[Vn,Bt,[new P_,On]]},hy=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Vn,useValue:t},{provide:On,useValue:r}]}}constructor(t){Ue.registerVersion("angularfire",cn.full,"core"),Ue.registerVersion("angularfire",cn.full,"app-compat"),Ue.registerVersion("angular",F_.full,t.toString())}static \u0275fac=function(r){return new(r||n)(W(kn))};static \u0275mod=xn({type:n});static \u0275inj=Pn({providers:[AA]})}return n})();function di(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return SA(i,o)||(cy("error",`${e} was already initialized on the ${t} Firebase App with different settings.${CA?" You may need to reload as Firebase is not HMR aware.":""}`),cy("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function SA(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var CA=typeof module<"u"&&!!module.hot,cy=(n,...e)=>{nh()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var bA=new Map,RA={activated:!1,tokenObservers:[]},PA={initialized:!1,enabled:!1};function kt(n){return bA.get(n)||Object.assign({},RA)}function yy(){return PA}var xA="https://content-firebaseappcheck.googleapis.com/v1";var kA="exchangeDebugToken",dy={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Gx=24*60*60*1e3;var dh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return x(this,null,function*(){this.stop();try{this.pending=new Ge,this.pending.promise.catch(t=>{}),yield NA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ge,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function NA(n){return new Promise(e=>{setTimeout(e,n)})}var DA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Mn=new ey("appCheck","AppCheck",DA);function vy(n){if(!kt(n).activated)throw Mn.create("use-before-activation",{appName:n.name})}function wy(r,i){return x(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let y=yield o.getHeartbeatsHeader();y&&(s["X-Firebase-Client"]=y)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(y){throw Mn.create("fetch-network-error",{originalErrorMessage:y?.message})}if(c.status!==200)throw Mn.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(y){throw Mn.create("fetch-parse-error",{originalErrorMessage:y?.message})}let d=u.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Mn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let p=Number(d[1])*1e3,m=Date.now();return{token:u.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function Ey(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${xA}/projects/${t}/apps/${r}:${kA}?key=${i}`,body:{debug_token:e}}}var VA="firebase-app-check-database",OA=1,fh="firebase-app-check-store";var Za=null;function MA(){return Za||(Za=new Promise((n,e)=>{try{let t=indexedDB.open(VA,OA);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Mn.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(fh,{keyPath:"compositeKey"})}}}catch(t){e(Mn.create("storage-open",{originalErrorMessage:t?.message}))}}),Za)}function FA(n,e){return LA(UA(n),e)}function LA(n,e){return x(this,null,function*(){let r=(yield MA()).transaction(fh,"readwrite"),s=r.objectStore(fh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},r.onerror=c=>{var u;a(Mn.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function UA(n){return`${n.options.appId}-${n.name}`}var ph=new Dn("@firebase/app-check");function hh(n,e){return Wa()?FA(n,e).catch(t=>{ph.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Ty(){return yy().enabled}function Iy(){return x(this,null,function*(){let n=yy();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var BA={error:"UNKNOWN_ERROR"};function qA(n){return za.encodeString(JSON.stringify(n),!1)}function mh(n,e=!1){return x(this,null,function*(){let t=n.app;vy(t);let r=kt(t),i=r.token,s;if(i&&!zs(i)&&(r.token=void 0,i=void 0),!i){let c=yield r.cachedTokenPromise;c&&(zs(c)?i=c:yield hh(t,void 0))}if(!e&&i&&zs(i))return{token:i.token};let o=!1;if(Ty()){r.exchangeTokenPromise||(r.exchangeTokenPromise=wy(Ey(t,yield Iy()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let c=yield r.exchangeTokenPromise;return yield hh(t,c),r.token=c,{token:c.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield kt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?ph.warn(c.message):ph.error(c),s=c}let a;return i?s?zs(i)?a={token:i.token,internalError:s}:a=py(s):(a={token:i.token},r.token=i,yield hh(t,i)):a=py(s),o&&KA(t,a),a})}function jA(n){return x(this,null,function*(){let e=n.app;vy(e);let{provider:t}=kt(e);if(Ty()){let r=yield Iy(),{token:i}=yield wy(Ey(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function GA(n,e,t,r){let{app:i}=n,s=kt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&zs(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),fy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>fy(n))}function Ay(n,e){let t=kt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function fy(n){let{app:e}=n,t=kt(e),r=t.tokenRefresher;r||(r=zA(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function zA(n){let{app:e}=n;return new dh(()=>x(this,null,function*(){let t=kt(e),r;if(t.token?r=yield mh(n,!0):r=yield mh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=kt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},dy.RETRIAL_MIN_WAIT,dy.RETRIAL_MAX_WAIT)}function KA(n,e){let t=kt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function zs(n){return n.expireTimeMillis-Date.now()>0}function py(n){return{token:qA(BA),error:n}}var gh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=kt(this.app);for(let t of e)Ay(this.app,t.next);return Promise.resolve()}};function WA(n,e){return new gh(n,e)}function $A(n){return{getToken:e=>mh(n,e),getLimitedUseToken:()=>jA(n),addTokenListener:e=>GA(n,"INTERNAL",e),removeTokenListener:e=>Ay(n.app,e)}}var QA="@firebase/app-check",HA="0.8.8";var YA="app-check",my="app-check-internal";function JA(){vr(new pt(YA,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return WA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(my).initialize()})),vr(new pt(my,n=>{let e=n.getProvider("app-check").getImmediate();return $A(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),xt(QA,HA)}JA();var XA=["localhost","0.0.0.0","127.0.0.1"],tk=typeof window<"u"&&XA.includes(window.location.hostname);var Ks=new je("angularfire2.auth.use-emulator"),Ws=new je("angularfire2.auth.settings"),$s=new je("angularfire2.auth.tenant-id"),Qs=new je("angularfire2.auth.langugage-code"),Hs=new je("angularfire2.auth.use-device-language"),Ys=new je("angularfire.auth.persistence"),Js=(n,e,t,r,i,s,o,a)=>di(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(let[u,d]of Object.entries(o))c.settings[u]=d;return a&&c.setPersistence(a),c},[t,r,i,s,o,a]),Xs=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,c,u,d,p,m,y){let S=new T_,k=Ut(void 0).pipe(gr(o.outsideAngular),an(()=>s.runOutsideAngular(()=>import("./chunk-JRULJVBQ.js"))),Se(()=>wr(t,s,r)),Se(N=>Js(N,s,a,u,d,p,c,m)),Gu({bufferSize:1,refCount:!1}));if(Ga(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Ut(null);else{k.pipe(A_()).subscribe();let N=k.pipe(an(M=>M.getRedirectResult().then(K=>K,()=>null)),be,Gu({bufferSize:1,refCount:!1})),q=k.pipe(an(M=>new Cn(K=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(H=>K.next(H),H=>K.error(H),()=>K.complete()))})))),j=k.pipe(an(M=>new Cn(K=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(H=>K.next(H),H=>K.error(H),()=>K.complete()))}))));this.authState=N.pipe(zu(q),li(o.outsideAngular),gr(o.insideAngular)),this.user=N.pipe(zu(j),li(o.outsideAngular),gr(o.insideAngular)),this.idToken=this.user.pipe(an(M=>M?bn(M.getIdToken()):Ut(null))),this.idTokenResult=this.user.pipe(an(M=>M?bn(M.getIdTokenResult()):Ut(null))),this.credential=Fs(N,S,this.authState.pipe(Ls(M=>!M))).pipe(Se(M=>M?.user?M:null),li(o.outsideAngular),gr(o.insideAngular))}return uy(this,k,s,{spy:{apply:(N,q,j)=>{(N.startsWith("signIn")||N.startsWith("createUser"))&&j.then(M=>S.next(M))}}})}static \u0275fac=function(r){return new(r||n)(W(Vn),W(On,8),W(kn),W(Bt),W(hi),W(Ks,8),W(Ws,8),W($s,8),W(Qs,8),W(Hs,8),W(Ys,8),W(ln,8))};static \u0275prov=Rn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Sy=(()=>{class n{constructor(){Ue.registerVersion("angularfire",cn.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=xn({type:n});static \u0275inj=Pn({providers:[Xs]})}return n})();var by="@firebase/database",Ry="1.0.8";var Pd="";function xd(n){Pd=n}var Sh=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),De(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:$a(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Ch=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Et(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var sv=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Sh(e)}}catch{}return new Ch},Tr=sv("localStorage"),bh=sv("sessionStorage");var gi=new Dn("@firebase/database"),ov=function(){let n=1;return function(){return n++}}(),av=function(n){let e=sy(n),t=new iy;t.update(e);let r=t.digest();return za.encodeByteArray(r)},Io=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Io.apply(null,r):typeof r=="object"?e+=De(r):e+=r,e+=" "}return e},Ir=null,Py=!0,lv=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(gi.logLevel=Tt.VERBOSE,Ir=gi.log.bind(gi),e&&bh.set("logging_enabled",!0)):typeof n=="function"?Ir=n:(Ir=null,bh.remove("logging_enabled"))},ze=function(...n){if(Py===!0&&(Py=!1,Ir===null&&bh.get("logging_enabled")===!0&&lv(!0)),Ir){let e=Io.apply(null,n);Ir(e)}},Ao=function(n){return function(...e){ze(n,...e)}},Rh=function(...n){let e="FIREBASE INTERNAL ERROR: "+Io(...n);gi.error(e)},zt=function(...n){let e=`FIREBASE FATAL ERROR: ${Io(...n)}`;throw gi.error(e),new Error(e)},Ze=function(...n){let e="FIREBASE WARNING: "+Io(...n);gi.warn(e)},eS=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ze("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bl=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},tS=function(n){if(qt()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Bn="[MIN_NAME]",un="[MAX_NAME]",Sr=function(n,e){if(n===e)return 0;if(n===Bn||e===un)return-1;if(e===Bn||n===un)return 1;{let t=xy(n),r=xy(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},nS=function(n,e){return n===e?0:n<e?-1:1},Zs=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+De(e))},kd=function(n){if(typeof n!="object"||n===null)return De(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=De(e[r]),t+=":",t+=kd(n[e[r]]);return t+="}",t},cv=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Ke(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var uv=function(n){O(!bl(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,c;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(i?1:0),u.reverse();let d=u.join(""),p="";for(c=0;c<64;c+=8){let m=parseInt(d.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},rS=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},iS=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function sS(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var oS=new RegExp("^-?(0*)\\d{1,10}$"),aS=-2147483648,lS=2147483647,xy=function(n){if(oS.test(n)){let e=Number(n);if(e>=aS&&e<=lS)return e}return null},Si=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Ze("Exception was thrown by user callback.",t),e},Math.floor(0))}},cS=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ro=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Ph=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Ze(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var xh=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(ze("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ze(e)}},io=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),tl="5",hv="v",dv="s",fv="r",pv="f",mv=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,gv="ls",_v="p",kh="ac",yv="websocket",vv="long_polling";var nl=class{constructor(e,t,r,i,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Tr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Tr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function uS(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function wv(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let r;if(e===yv)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===vv)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);uS(n)&&(t.ns=n.namespace);let i=[];return Ke(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Nh=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Et(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return J_(this.counters_)}};var yh={},vh={};function Nd(n){let e=n.toString();return yh[e]||(yh[e]=new Nh),yh[e]}function hS(n,e){let t=n.toString();return vh[t]||(vh[t]=e()),vh[t]}var Dh=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Si(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var ky="start",dS="close",fS="pLPCommand",pS="pRTLPCB",Ev="id",Tv="pw",Iv="ser",mS="cb",gS="seg",_S="ts",yS="d",vS="dframe",Av=1870,Sv=30,wS=Av-Sv,ES=25e3,TS=3e4,lo=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ao(e),this.stats_=Nd(t),this.urlFn=c=>(this.appCheckToken&&(c[kh]=this.appCheckToken),wv(t,vv,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Dh(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(TS)),tS(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Vh((...s)=>{let[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ky)this.id=a,this.password=c;else if(o===dS)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[ky]="t",r[Iv]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[mS]=this.scriptTagHolder.uniqueCallbackIdentifier),r[hv]=tl,this.transportSessionId&&(r[dv]=this.transportSessionId),this.lastSessionId&&(r[gv]=this.lastSessionId),this.applicationId&&(r[_v]=this.applicationId),this.appCheckToken&&(r[kh]=this.appCheckToken),typeof location<"u"&&location.hostname&&mv.test(location.hostname)&&(r[fv]=pv);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return qt()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!rS()&&!iS()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=De(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=Y_(t),i=cv(r,wS);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(qt())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[vS]="t",r[Ev]=e,r[Tv]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=De(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Vh=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,qt())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=ov(),window[fS+this.uniqueCallbackIdentifier]=e,window[pS+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){ze("frame writing exception"),a.stack&&ze(a.stack),ze(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ze("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Ev]=this.myID,e[Tv]=this.myPW,e[Iv]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Sv+r.length<=Av;){let o=this.pendingSegs.shift();r=r+"&"+gS+i+"="+o.seg+"&"+_S+i+"="+o.ts+"&"+yS+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(ES)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){qt()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{ze("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var IS=16384,AS=45e3,rl=null;typeof MozWebSocket<"u"?rl=MozWebSocket:typeof WebSocket<"u"&&(rl=WebSocket);var pi=(()=>{class n{constructor(t,r,i,s,o,a,c){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ao(this.connId),this.stats_=Nd(r),this.connURL=n.connectionURL_(r,a,c,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[hv]=tl,!qt()&&typeof location<"u"&&location.hostname&&mv.test(location.hostname)&&(a[fv]=pv),r&&(a[dv]=r),i&&(a[gv]=i),s&&(a[kh]=s),o&&(a[_v]=o),wv(t,yv,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Tr.set("previous_websocket_failure",!0);try{let i;if(qt()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${tl}/${Pd}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new rl(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&rl!==null&&!n.forceDisallow_}static previouslyFailed(){return Tr.isInMemoryStorage||Tr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Tr.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=$a(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=De(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=cv(r,IS);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(AS))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Cv=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[lo,pi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=pi&&pi.isAvailable(),i=r&&!pi.previouslyFailed();if(t.webSocketOnly&&(r||Ze("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[pi];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),SS=6e4,CS=5e3,bS=10*1024,RS=100*1024,wh="t",Ny="d",PS="s",Dy="r",xS="e",Vy="o",Oy="a",My="n",Fy="p",kS="h",Oh=class{constructor(e,t,r,i,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ao("c:"+this.id+":"),this.transportManager_=new Cv(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ro(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>RS?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>bS?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(wh in e){let t=e[wh];t===Oy?this.upgradeIfSecondaryHealthy_():t===Dy?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Vy&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Zs("t",e),r=Zs("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Fy,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Oy,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:My,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Zs("t",e),r=Zs("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Zs(wh,e);if(Ny in e){let r=e[Ny];if(t===kS){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===My){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===PS?this.onConnectionShutdown_(r):t===Dy?this.onReset_(r):t===xS?Rh("Server Error: "+r):t===Vy?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Rh("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),tl!==r&&Ze("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),ro(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(SS))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ro(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(CS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Fy,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Tr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var il=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var sl=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var ol=class n extends sl{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!rh()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Ly=32,Uy=768,ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function le(){return new ce("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function qn(n){return n.pieces_.length-n.pieceNum_}function de(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ce(n.pieces_,e)}function Dd(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function NS(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function co(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function bv(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ce(e,0)}function ye(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ce)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new ce(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function st(n,e){let t=Z(n),r=Z(e);if(t===null)return e;if(t===r)return st(de(n),de(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function DS(n,e){let t=co(n,0),r=co(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=Sr(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Vd(n,e){if(qn(n)!==qn(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function It(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(qn(n)>qn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var Mh=class{constructor(e,t){this.errorPrefix_=t,this.parts_=co(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Gs(this.parts_[r]);Rv(this)}};function VS(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Gs(e),Rv(n)}function OS(n){let e=n.parts_.pop();n.byteLength_-=Gs(e),n.parts_.length>0&&(n.byteLength_-=1)}function Rv(n){if(n.byteLength_>Uy)throw new Error(n.errorPrefix_+"has a key path longer than "+Uy+" bytes ("+n.byteLength_+").");if(n.parts_.length>Ly)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ly+") or object contains a cycle "+Er(n))}function Er(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Fh=class n extends sl{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var eo=1e3,MS=60*5*1e3,By=30*1e3,FS=1.3,LS=3e4,US="server_kill",qy=3,Od=(()=>{class n extends il{constructor(t,r,i,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=Ao("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=eo,this.maxReconnectDelay_=MS,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!qt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Fh.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&ol.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(De(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new Ge,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?r.resolve(c):r.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;n.warnOnListenWarnings_(u,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&Et(t,"w")){let i=Nn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();Ze(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ny(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=By)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=ty(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+De(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):Rh("Unrecognized action received from server: "+De(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=eo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=eo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>LS&&(this.reconnectDelay_=eo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*FS)}this.onConnectStatus_(!1)}establishConnection_(){return x(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,i())},d=function(m){O(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(m)};this.realtime_={close:u,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,y]=yield Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?ze("getToken() completed but was canceled"):(ze("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=y&&y.token,c=new Oh(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,S=>{Ze(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(US)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&Ze(m),u())}}})}interrupt(t){ze("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){ze("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Qa(this.interruptReasons_)&&(this.reconnectDelay_=eo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>kd(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new ce(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){ze("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=qy&&(this.reconnectDelay_=By,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){ze("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=qy&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";qt()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+Pd.replace(/\./g,"-")]=1,rh()?t["framework.cordova"]=1:X_()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=ol.getInstance().currentlyOnline();return Qa(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var _i=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new te(Bn,e),i=new te(Bn,t);return this.compare(r,i)!==0}minPost(){return te.MIN}};var el,al=class extends _i{static get __EMPTY_NODE(){return el}static set __EMPTY_NODE(e){el=e}compare(e,t){return Sr(e.name,t.name)}isDefinedOn(e){throw ci("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(un,el)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,el)}toString(){return".key"}},Gt=new al;var mi=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Nt=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??At.EMPTY_NODE,this.right=o??At.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return At.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return At.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Lh=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Nt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},At=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Nt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Nt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new mi(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new mi(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new mi(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new mi(this.root_,null,this.comparator_,!0,e)}};At.EMPTY_NODE=new Lh;function BS(n,e){return Sr(n.name,e.name)}function Md(n,e){return Sr(n,e)}var Uh;function qS(n){Uh=n}var Pv=function(n){return typeof n=="number"?"number:"+uv(n):"string:"+n},xv=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Et(e,".sv"),"Priority must be a string or number.")}else O(n===Uh||n.isEmpty(),"priority of unexpected type.");O(n===Uh||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var jy,yi=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),xv(this.priorityNode_)}static set __childrenNodeConstructor(t){jy=t}static get __childrenNodeConstructor(){return jy}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=Z(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(O(i!==".priority"||qn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(de(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Pv(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=uv(this.value_):t+=this.value_,this.lazyHash_=av(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return O(s>=0,"Unknown leaf type: "+r),O(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),kv,Nv;function jS(n){kv=n}function GS(n){Nv=n}var Bh=class extends _i{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?Sr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(un,new yi("[PRIORITY-POST]",Nv))}makePost(e,t){let r=kv(e);return new te(t,new yi("[PRIORITY-POST]",r))}toString(){return".priority"}},pe=new Bh;var zS=Math.log(2),qh=class{constructor(e){let t=s=>parseInt(Math.log(s)/zS,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},ll=function(n,e,t,r){n.sort(e);let i=function(c,u){let d=u-c,p,m;if(d===0)return null;if(d===1)return p=n[c],m=t?t(p):p,new Nt(m,p.node,Nt.BLACK,null,null);{let y=parseInt(d/2,10)+c,S=i(c,y),k=i(y+1,u);return p=n[y],m=t?t(p):p,new Nt(m,p.node,Nt.BLACK,S,k)}},s=function(c){let u=null,d=null,p=n.length,m=function(S,k){let N=p-S,q=p;p-=S;let j=i(N+1,q),M=n[N],K=t?t(M):M;y(new Nt(K,M.node,k,null,j))},y=function(S){u?(u.left=S,u=S):(d=S,u=S)};for(let S=0;S<c.count;++S){let k=c.nextBitIsOne(),N=Math.pow(2,c.count-(S+1));k?m(N,Nt.BLACK):(m(N,Nt.BLACK),m(N,Nt.RED))}return d},o=new qh(n.length),a=s(o);return new At(r||e,a)};var Eh,fi={},vi=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(fi&&pe,"ChildrenNode.ts has not been loaded"),Eh=Eh||new n({".priority":fi},{".priority":pe}),Eh}get(e){let t=Nn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof At?t:null}hasIndex(e){return Et(this.indexSet_,e.toString())}addIndex(e,t){O(e!==Gt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=ll(r,e.getCompare()):a=fi;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,u)}addToIndexes(e,t){let r=js(this.indexes_,(i,s)=>{let o=Nn(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),i===fi)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(te.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),ll(a,o.getCompare())}else return fi;else{let a=t.get(e.name),c=i;return a&&(c=c.remove(new te(e.name,a))),c.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=js(this.indexes_,i=>{if(i===fi)return i;{let s=t.get(e.name);return s?i.remove(new te(e.name,s)):i}});return new n(r,this.indexSet_)}};var to,J=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&xv(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return to||(to=new n(new At(Md),null,vi.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||to}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?to:r}}getChild(t){let r=Z(t);return r===null?this:this.getImmediateChild(r).getChild(de(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(O(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new te(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?to:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=Z(t);if(i===null)return r;{O(Z(t)!==".priority"||qn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(de(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(pe,(a,c)=>{r[a]=c.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let c in r)a[c]=r[c];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Pv(this.getPriority().val())+":"),this.forEachChild(pe,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":av(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new te(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new te(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new te(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===So?-1:0}withIndex(t){if(t===Gt||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Gt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(pe),s=r.getIterator(pe),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Gt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),jh=class extends J{constructor(){super(new At(Md),J.EMPTY_NODE,vi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return J.EMPTY_NODE}isEmpty(){return!1}},So=new jh;Object.defineProperties(te,{MIN:{value:new te(Bn,J.EMPTY_NODE)},MAX:{value:new te(un,So)}});al.__EMPTY_NODE=J.EMPTY_NODE;yi.__childrenNodeConstructor=J;qS(So);GS(So);var KS=!0;function Ee(n,e=null){if(n===null)return J.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new yi(t,Ee(e))}if(!(n instanceof Array)&&KS){let t=[],r=!1;if(Ke(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=Ee(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new te(o,c)))}}),t.length===0)return J.EMPTY_NODE;let s=ll(t,BS,o=>o.name,Md);if(r){let o=ll(t,pe.getCompare());return new J(s,Ee(e),new vi({".priority":o},{".priority":pe}))}else return new J(s,Ee(e),vi.Default)}else{let t=J.EMPTY_NODE;return Ke(n,(r,i)=>{if(Et(n,r)&&r.substring(0,1)!=="."){let s=Ee(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Ee(e))}}jS(Ee);var uo=class extends _i{constructor(e){super(),this.indexPath_=e,O(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?Sr(e.name,t.name):s}makePost(e,t){let r=Ee(e),i=J.EMPTY_NODE.updateChild(this.indexPath_,r);return new te(t,i)}maxPost(){let e=J.EMPTY_NODE.updateChild(this.indexPath_,So);return new te(un,e)}toString(){return co(this.indexPath_,0).join("/")}};var Gh=class extends _i{compare(e,t){let r=e.node.compareTo(t.node);return r===0?Sr(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let r=Ee(e);return new te(t,r)}toString(){return".value"}},Fd=new Gh;function Dv(n){return{type:"value",snapshotNode:n}}function wi(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ho(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function fo(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function WS(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var po=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(ho(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(wi(t,r)):o.trackChildChange(fo(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(pe,(i,s)=>{t.hasChild(i)||r.trackChildChange(ho(i,s))}),t.isLeafNode()||t.forEachChild(pe,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(fo(i,s,o))}else r.trackChildChange(wi(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?J.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var cl=class n{constructor(e){this.indexedFilter_=new po(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new te(t,r))||(r=J.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=J.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(J.EMPTY_NODE);let s=this;return t.forEachChild(pe,(o,a)=>{s.matches(new te(o,a))||(i=i.updateImmediateChild(o,J.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var zh=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new cl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new te(t,r))||(r=J.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=J.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=J.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(J.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,J.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let p=this.index_.getCompare();o=(m,y)=>p(y,m)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let c=new te(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let p=a.getImmediateChild(t),m=i.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);let y=m==null?1:o(m,c);if(d&&!r.isEmpty()&&y>=0)return s?.trackChildChange(fo(t,r,p)),a.updateImmediateChild(t,r);{s?.trackChildChange(ho(t,p));let k=a.updateImmediateChild(t,J.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s?.trackChildChange(wi(m.name,m.node)),k.updateImmediateChild(m.name,m.node)):k}}else return r.isEmpty()?e:d&&o(u,c)>=0?(s!=null&&(s.trackChildChange(ho(u.name,u.node)),s.trackChildChange(wi(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,J.EMPTY_NODE)):e}};var mo=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Bn}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:un}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===pe}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function $S(n){return n.loadsAllData()?new po(n.getIndex()):n.hasLimit()?new zh(n):new cl(n)}function QS(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function HS(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Kh(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function YS(n,e,t){let r;return n.index_===Gt||t?r=Kh(n,e,t):r=Kh(n,e,un),r.startAfterSet_=!0,r}function Wh(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function JS(n,e,t){let r;return n.index_===Gt||t?r=Wh(n,e,t):r=Wh(n,e,Bn),r.endBeforeSet_=!0,r}function Rl(n,e){let t=n.copy();return t.index_=e,t}function Gy(n){let e={};if(n.isDefault())return e;let t;if(n.index_===pe?t="$priority":n.index_===Fd?t="$value":n.index_===Gt?t="$key":(O(n.index_ instanceof uo,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=De(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=De(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+De(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=De(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+De(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function zy(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==pe&&(e.i=n.index_.toString()),e}var $h=class n extends il{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Ao("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let c=Gy(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let p=d;if(u===404&&(p=null,u=null),u===null&&this.onDataUpdate_(s,p,!1,r),Nn(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",i(m,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=Gy(e._queryParams),r=e._path.toString(),i=new Ge;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ry(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=$a(a.responseText)}catch{Ze("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&Ze("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var Qh=class{constructor(){this.rootNode_=J.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function ul(){return{value:null,children:new Map}}function Ci(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=Z(e);n.children.has(r)||n.children.set(r,ul());let i=n.children.get(r);e=de(e),Ci(i,e,t)}}function Hh(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(pe,(r,i)=>{Ci(n,new ce(r),i)}),Hh(n,e)}}else if(n.children.size>0){let t=Z(e);return e=de(e),n.children.has(t)&&Hh(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Yh(n,e,t){n.value!==null?t(e,n.value):XS(n,(r,i)=>{let s=new ce(e.toString()+"/"+r);Yh(i,s,t)})}function XS(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Jh=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ke(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var Ky=10*1e3,ZS=30*1e3,eC=5*60*1e3,Xh=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Jh(e);let r=Ky+(ZS-Ky)*Math.random();ro(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;Ke(e,(i,s)=>{s>0&&Et(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),ro(this.reportStats_.bind(this),Math.floor(Math.random()*2*eC))}};var jt=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(jt||{});function Ld(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ud(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Bd(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Zh=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=jt.ACK_USER_WRITE,this.source=Ld()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ce(e));return new n(le(),t,this.revert)}}else return O(Z(this.path)===e,"operationForChild called for unrelated child."),new n(de(this.path),this.affectedTree,this.revert)}};var hl=class n{constructor(e,t){this.source=e,this.path=t,this.type=jt.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,le()):new n(this.source,de(this.path))}};var Ei=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=jt.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,le(),this.snap.getImmediateChild(e)):new n(this.source,de(this.path),this.snap)}};var go=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=jt.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new ce(e));return t.isEmpty()?null:t.value?new Ei(this.source,le(),t.value):new n(this.source,le(),t)}else return O(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,de(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Kt=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var ed=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function tC(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(WS(o.childName,o.snapshotNode))}),no(n,i,"child_removed",e,r,t),no(n,i,"child_added",e,r,t),no(n,i,"child_moved",s,r,t),no(n,i,"child_changed",e,r,t),no(n,i,"value",e,r,t),i}function no(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,c)=>rC(n,a,c)),o.forEach(a=>{let c=nC(n,a,s);i.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function nC(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function rC(n,e,t){if(e.childName==null||t.childName==null)throw ci("Should only compare child_ events.");let r=new te(e.childName,e.snapshotNode),i=new te(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Pl(n,e){return{eventCache:n,serverCache:e}}function so(n,e,t,r){return Pl(new Kt(e,t,r),n.serverCache)}function Vv(n,e,t,r){return Pl(n.eventCache,new Kt(e,t,r))}function dl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ar(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Th,iC=()=>(Th||(Th=new At(nS)),Th),ot=class n{constructor(e,t=iC()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return Ke(e,(r,i)=>{t=t.set(new ce(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:le(),value:this.value};if(ee(e))return null;{let r=Z(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(de(e),t);return s!=null?{path:ye(new ce(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),r=this.children.get(t);return r!==null?r.subtree(de(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let r=Z(e),s=(this.children.get(r)||new n(null)).set(de(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),r=this.children.get(t);if(r){let i=r.remove(de(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),r=this.children.get(t);return r?r.get(de(e)):null}}setTree(e,t){if(ee(e))return t;{let r=Z(e),s=(this.children.get(r)||new n(null)).setTree(de(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(le(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ye(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,le(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(de(e),ye(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,le(),t)}foreachOnPath_(e,t,r){if(ee(e))return this;{this.value&&r(t,this.value);let i=Z(e),s=this.children.get(i);return s?s.foreachOnPath_(de(e),ye(t,i),r):new n(null)}}foreach(e){this.foreach_(le(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(ye(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Dt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new ot(null))}};function oo(n,e,t){if(ee(e))return new Dt(new ot(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=st(i,e);return s=s.updateChild(o,t),new Dt(n.writeTree_.set(i,s))}else{let i=new ot(t),s=n.writeTree_.setTree(e,i);return new Dt(s)}}}function td(n,e,t){let r=n;return Ke(t,(i,s)=>{r=oo(r,ye(e,i),s)}),r}function Wy(n,e){if(ee(e))return Dt.empty();{let t=n.writeTree_.setTree(e,new ot(null));return new Dt(t)}}function nd(n,e){return Cr(n,e)!=null}function Cr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(st(t.path,e)):null}function $y(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(pe,(r,i)=>{e.push(new te(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new te(r,i.value))}),e}function Ln(n,e){if(ee(e))return n;{let t=Cr(n,e);return t!=null?new Dt(new ot(t)):new Dt(n.writeTree_.subtree(e))}}function rd(n){return n.writeTree_.isEmpty()}function Ti(n,e){return Ov(le(),n.writeTree_,e)}function Ov(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=Ov(ye(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(ye(n,".priority"),r)),t}}function xl(n,e){return Uv(e,n)}function sC(n,e,t,r,i){O(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=oo(n.visibleWrites,e,t)),n.lastWriteId=r}function oC(n,e,t,r){O(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=td(n.visibleWrites,e,t),n.lastWriteId=r}function aC(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function lC(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&cC(a,r.path)?i=!1:It(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return uC(n),!0;if(r.snap)n.visibleWrites=Wy(n.visibleWrites,r.path);else{let a=r.children;Ke(a,c=>{n.visibleWrites=Wy(n.visibleWrites,ye(r.path,c))})}return!0}else return!1}function cC(n,e){if(n.snap)return It(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&It(ye(n.path,t),e))return!0;return!1}function uC(n){n.visibleWrites=Mv(n.allWrites,hC,le()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function hC(n){return n.visible}function Mv(n,e,t){let r=Dt.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)It(t,o)?(a=st(t,o),r=oo(r,a,s.snap)):It(o,t)&&(a=st(o,t),r=oo(r,le(),s.snap.getChild(a)));else if(s.children){if(It(t,o))a=st(t,o),r=td(r,a,s.children);else if(It(o,t))if(a=st(o,t),ee(a))r=td(r,le(),s.children);else{let c=Nn(s.children,Z(a));if(c){let u=c.getChild(de(a));r=oo(r,le(),u)}}}else throw ci("WriteRecord should have .snap or .children")}}return r}function Fv(n,e,t,r,i){if(!r&&!i){let s=Cr(n.visibleWrites,e);if(s!=null)return s;{let o=Ln(n.visibleWrites,e);if(rd(o))return t;if(t==null&&!nd(o,le()))return null;{let a=t||J.EMPTY_NODE;return Ti(o,a)}}}else{let s=Ln(n.visibleWrites,e);if(!i&&rd(s))return t;if(!i&&t==null&&!nd(s,le()))return null;{let o=function(u){return(u.visible||i)&&(!r||!~r.indexOf(u.writeId))&&(It(u.path,e)||It(e,u.path))},a=Mv(n.allWrites,o,e),c=t||J.EMPTY_NODE;return Ti(a,c)}}}function dC(n,e,t){let r=J.EMPTY_NODE,i=Cr(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(pe,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=Ln(n.visibleWrites,e);return t.forEachChild(pe,(o,a)=>{let c=Ti(Ln(s,new ce(o)),a);r=r.updateImmediateChild(o,c)}),$y(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=Ln(n.visibleWrites,e);return $y(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function fC(n,e,t,r,i){O(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=ye(e,t);if(nd(n.visibleWrites,s))return null;{let o=Ln(n.visibleWrites,s);return rd(o)?i.getChild(t):Ti(o,i.getChild(t))}}function pC(n,e,t,r){let i=ye(e,t),s=Cr(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=Ln(n.visibleWrites,i);return Ti(o,r.getNode().getImmediateChild(t))}else return null}function mC(n,e){return Cr(n.visibleWrites,e)}function gC(n,e,t,r,i,s,o){let a,c=Ln(n.visibleWrites,e),u=Cr(c,le());if(u!=null)a=u;else if(t!=null)a=Ti(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=o.getCompare(),m=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),y=m.getNext();for(;y&&d.length<i;)p(y,r)!==0&&d.push(y),y=m.getNext();return d}else return[]}function _C(){return{visibleWrites:Dt.empty(),allWrites:[],lastWriteId:-1}}function fl(n,e,t,r){return Fv(n.writeTree,n.treePath,e,t,r)}function qd(n,e){return dC(n.writeTree,n.treePath,e)}function Qy(n,e,t,r){return fC(n.writeTree,n.treePath,e,t,r)}function pl(n,e){return mC(n.writeTree,ye(n.treePath,e))}function yC(n,e,t,r,i,s){return gC(n.writeTree,n.treePath,e,t,r,i,s)}function jd(n,e,t){return pC(n.writeTree,n.treePath,e,t)}function Lv(n,e){return Uv(ye(n.treePath,e),n.writeTree)}function Uv(n,e){return{treePath:n,writeTree:e}}var id=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,fo(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,ho(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,wi(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,fo(r,e.snapshotNode,i.oldSnap));else throw ci("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var sd=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},Bv=new sd,_o=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Kt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return jd(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ar(this.viewCache_),s=yC(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function vC(n){return{filter:n}}function wC(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function EC(n,e,t,r,i){let s=new id,o,a;if(t.type===jt.OVERWRITE){let u=t;u.source.fromUser?o=od(n,e,u.path,u.snap,r,i,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ee(u.path),o=ml(n,e,u.path,u.snap,r,i,a,s))}else if(t.type===jt.MERGE){let u=t;u.source.fromUser?o=IC(n,e,u.path,u.children,r,i,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=ad(n,e,u.path,u.children,r,i,a,s))}else if(t.type===jt.ACK_USER_WRITE){let u=t;u.revert?o=CC(n,e,u.path,r,i,s):o=AC(n,e,u.path,u.affectedTree,r,i,s)}else if(t.type===jt.LISTEN_COMPLETE)o=SC(n,e,t.path,r,s);else throw ci("Unknown operation type: "+t.type);let c=s.getChanges();return TC(e,o,c),{viewCache:o,changes:c}}function TC(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=dl(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(Dv(dl(e)))}}function qv(n,e,t,r,i,s){let o=e.eventCache;if(pl(r,t)!=null)return e;{let a,c;if(ee(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=Ar(e),d=u instanceof J?u:J.EMPTY_NODE,p=qd(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{let u=fl(r,Ar(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=Z(t);if(u===".priority"){O(qn(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let p=Qy(r,t,d,c);p!=null?a=n.filter.updatePriority(d,p):a=o.getNode()}else{let d=de(t),p;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let m=Qy(r,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(u).updateChild(d,m):p=o.getNode().getImmediateChild(u)}else p=jd(r,u,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),u,p,d,i,s):a=o.getNode()}}return so(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function ml(n,e,t,r,i,s,o,a){let c=e.serverCache,u,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))u=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,r);u=d.updateFullNode(c.getNode(),y,null)}else{let y=Z(t);if(!c.isCompleteForPath(t)&&qn(t)>1)return e;let S=de(t),N=c.getNode().getImmediateChild(y).updateChild(S,r);y===".priority"?u=d.updatePriority(c.getNode(),N):u=d.updateChild(c.getNode(),y,N,S,Bv,null)}let p=Vv(e,u,c.isFullyInitialized()||ee(t),d.filtersNodes()),m=new _o(i,p,s);return qv(n,p,t,i,m,a)}function od(n,e,t,r,i,s,o){let a=e.eventCache,c,u,d=new _o(i,e,s);if(ee(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=so(e,u,!0,n.filter.filtersNodes());else{let p=Z(t);if(p===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=so(e,u,a.isFullyInitialized(),a.isFiltered());else{let m=de(t),y=a.getNode().getImmediateChild(p),S;if(ee(m))S=r;else{let k=d.getCompleteChild(p);k!=null?Dd(m)===".priority"&&k.getChild(bv(m)).isEmpty()?S=k:S=k.updateChild(m,r):S=J.EMPTY_NODE}if(y.equals(S))c=e;else{let k=n.filter.updateChild(a.getNode(),p,S,m,d,o);c=so(e,k,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Hy(n,e){return n.eventCache.isCompleteForChild(e)}function IC(n,e,t,r,i,s,o){let a=e;return r.foreach((c,u)=>{let d=ye(t,c);Hy(e,Z(d))&&(a=od(n,a,d,u,i,s,o))}),r.foreach((c,u)=>{let d=ye(t,c);Hy(e,Z(d))||(a=od(n,a,d,u,i,s,o))}),a}function Yy(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function ad(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;ee(t)?u=r:u=new ot(null).setTree(t,r);let d=e.serverCache.getNode();return u.children.inorderTraversal((p,m)=>{if(d.hasChild(p)){let y=e.serverCache.getNode().getImmediateChild(p),S=Yy(n,y,m);c=ml(n,c,new ce(p),S,i,s,o,a)}}),u.children.inorderTraversal((p,m)=>{let y=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!d.hasChild(p)&&!y){let S=e.serverCache.getNode().getImmediateChild(p),k=Yy(n,S,m);c=ml(n,c,new ce(p),k,i,s,o,a)}}),c}function AC(n,e,t,r,i,s,o){if(pl(i,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(ee(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return ml(n,e,t,c.getNode().getChild(t),i,s,a,o);if(ee(t)){let u=new ot(null);return c.getNode().forEachChild(Gt,(d,p)=>{u=u.set(new ce(d),p)}),ad(n,e,t,u,i,s,a,o)}else return e}else{let u=new ot(null);return r.foreach((d,p)=>{let m=ye(t,d);c.isCompleteForPath(m)&&(u=u.set(d,c.getNode().getChild(m)))}),ad(n,e,t,u,i,s,a,o)}}function SC(n,e,t,r,i){let s=e.serverCache,o=Vv(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return qv(n,o,t,r,Bv,i)}function CC(n,e,t,r,i,s){let o;if(pl(r,t)!=null)return e;{let a=new _o(r,e,i),c=e.eventCache.getNode(),u;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=fl(r,Ar(e));else{let p=e.serverCache.getNode();O(p instanceof J,"serverChildren would be complete if leaf node"),d=qd(r,p)}d=d,u=n.filter.updateFullNode(c,d,s)}else{let d=Z(t),p=jd(r,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?u=n.filter.updateChild(c,d,p,de(t),a,s):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(c,d,J.EMPTY_NODE,de(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=fl(r,Ar(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||pl(r,le())!=null,so(e,u,o,n.filter.filtersNodes())}}var ld=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new po(r.getIndex()),s=$S(r);this.processor_=vC(s);let o=t.serverCache,a=t.eventCache,c=i.updateFullNode(J.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(J.EMPTY_NODE,a.getNode(),null),d=new Kt(c,o.isFullyInitialized(),i.filtersNodes()),p=new Kt(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Pl(p,d),this.eventGenerator_=new ed(this.query_)}get query(){return this.query_}};function bC(n){return n.viewCache_.serverCache.getNode()}function RC(n){return dl(n.viewCache_)}function PC(n,e){let t=Ar(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function Jy(n){return n.eventRegistrations_.length===0}function xC(n,e){n.eventRegistrations_.push(e)}function Xy(n,e,t){let r=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function Zy(n,e,t,r){e.type===jt.MERGE&&e.source.queryId!==null&&(O(Ar(n.viewCache_),"We should always have a full cache before handling merges"),O(dl(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=EC(n.processor_,i,e,t,r);return wC(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,jv(n,s.changes,s.viewCache.eventCache.getNode(),null)}function kC(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(pe,(s,o)=>{r.push(wi(s,o))}),t.isFullyInitialized()&&r.push(Dv(t.getNode())),jv(n,r,t.getNode(),e)}function jv(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return tC(n.eventGenerator_,e,t,i)}var gl,_l=class{constructor(){this.views=new Map}};function NC(n){O(!gl,"__referenceConstructor has already been defined"),gl=n}function DC(){return O(gl,"Reference.ts has not been loaded"),gl}function VC(n){return n.views.size===0}function Gd(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return O(s!=null,"SyncTree gave us an op for an invalid query."),Zy(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(Zy(o,e,t,r));return s}}function Gv(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=fl(t,i?r:null),c=!1;a?c=!0:r instanceof J?(a=qd(t,r),c=!1):(a=J.EMPTY_NODE,c=!1);let u=Pl(new Kt(a,c,!1),new Kt(r,i,!1));return new ld(e,u)}return o}function OC(n,e,t,r,i,s){let o=Gv(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),xC(o,t),kC(o,t)}function MC(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=jn(n);if(i==="default")for(let[c,u]of n.views.entries())o=o.concat(Xy(u,t,r)),Jy(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{let c=n.views.get(i);c&&(o=o.concat(Xy(c,t,r)),Jy(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!jn(n)&&s.push(new(DC())(e._repo,e._path)),{removed:s,events:o}}function zv(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Un(n,e){let t=null;for(let r of n.views.values())t=t||PC(r,e);return t}function Kv(n,e){if(e._queryParams.loadsAllData())return kl(n);{let r=e._queryIdentifier;return n.views.get(r)}}function Wv(n,e){return Kv(n,e)!=null}function jn(n){return kl(n)!=null}function kl(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var yl;function FC(n){O(!yl,"__referenceConstructor has already been defined"),yl=n}function LC(){return O(yl,"Reference.ts has not been loaded"),yl}var UC=1,vl=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ot(null),this.pendingWriteTree_=_C(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function zd(n,e,t,r,i){return sC(n.pendingWriteTree_,e,t,r,i),i?bi(n,new Ei(Ld(),e,t)):[]}function BC(n,e,t,r){oC(n.pendingWriteTree_,e,t,r);let i=ot.fromObject(t);return bi(n,new go(Ld(),e,i))}function Fn(n,e,t=!1){let r=aC(n.pendingWriteTree_,e);if(lC(n.pendingWriteTree_,e)){let s=new ot(null);return r.snap!=null?s=s.set(le(),!0):Ke(r.children,o=>{s=s.set(new ce(o),!0)}),bi(n,new Zh(r.path,s,t))}else return[]}function Co(n,e,t){return bi(n,new Ei(Ud(),e,t))}function qC(n,e,t){let r=ot.fromObject(t);return bi(n,new go(Ud(),e,r))}function jC(n,e){return bi(n,new hl(Ud(),e))}function GC(n,e,t){let r=Kd(n,t);if(r){let i=Wd(r),s=i.path,o=i.queryId,a=st(s,e),c=new hl(Bd(o),a);return $d(n,s,c)}else return[]}function wl(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||Wv(o,e))){let c=MC(o,e,t,r);VC(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=c.removed;if(a=c.events,!i){let d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(s,(m,y)=>jn(y));if(d&&!p){let m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){let y=WC(m);for(let S=0;S<y.length;++S){let k=y[S],N=k.query,q=Yv(n,k);n.listenProvider_.startListening(ao(N),yo(n,N),q.hashFn,q.onComplete)}}}!p&&u.length>0&&!r&&(d?n.listenProvider_.stopListening(ao(e),null):u.forEach(m=>{let y=n.queryToTagMap.get(Dl(m));n.listenProvider_.stopListening(ao(m),y)}))}$C(n,u)}return a}function $v(n,e,t,r){let i=Kd(n,r);if(i!=null){let s=Wd(i),o=s.path,a=s.queryId,c=st(o,e),u=new Ei(Bd(a),c,t);return $d(n,o,u)}else return[]}function zC(n,e,t,r){let i=Kd(n,r);if(i){let s=Wd(i),o=s.path,a=s.queryId,c=st(o,e),u=ot.fromObject(t),d=new go(Bd(a),c,u);return $d(n,o,d)}else return[]}function cd(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(m,y)=>{let S=st(m,i);s=s||Un(y,S),o=o||jn(y)});let a=n.syncPointTree_.get(i);a?(o=o||jn(a),s=s||Un(a,le())):(a=new _l,n.syncPointTree_=n.syncPointTree_.set(i,a));let c;s!=null?c=!0:(c=!1,s=J.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((y,S)=>{let k=Un(S,le());k&&(s=s.updateImmediateChild(y,k))}));let u=Wv(a,e);if(!u&&!e._queryParams.loadsAllData()){let m=Dl(e);O(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");let y=QC();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}let d=xl(n.pendingWriteTree_,i),p=OC(a,e,t,d,s,c);if(!u&&!o&&!r){let m=Kv(a,e);p=p.concat(HC(n,e,m))}return p}function Nl(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=st(o,e),u=Un(a,c);if(u)return u});return Fv(i,e,s,t,!0)}function KC(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(u,d)=>{let p=st(u,t);r=r||Un(d,p)});let i=n.syncPointTree_.get(t);i?r=r||Un(i,le()):(i=new _l,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Kt(r,!0,!1):null,a=xl(n.pendingWriteTree_,e._path),c=Gv(i,e,a,s?o.getNode():J.EMPTY_NODE,s);return RC(c)}function bi(n,e){return Qv(e,n.syncPointTree_,null,xl(n.pendingWriteTree_,le()))}function Qv(n,e,t,r){if(ee(n.path))return Hv(n,e,t,r);{let i=e.get(le());t==null&&i!=null&&(t=Un(i,le()));let s=[],o=Z(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=Lv(r,o);s=s.concat(Qv(a,c,u,d))}return i&&(s=s.concat(Gd(i,n,r,t))),s}}function Hv(n,e,t,r){let i=e.get(le());t==null&&i!=null&&(t=Un(i,le()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=Lv(r,o),d=n.operationForChild(o);d&&(s=s.concat(Hv(d,a,c,u)))}),i&&(s=s.concat(Gd(i,n,r,t))),s}function Yv(n,e){let t=e.query,r=yo(n,t);return{hashFn:()=>(bC(e)||J.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?GC(n,t._path,r):jC(n,t._path);{let s=sS(i,t);return wl(n,t,null,s)}}}}function yo(n,e){let t=Dl(e);return n.queryToTagMap.get(t)}function Dl(n){return n._path.toString()+"$"+n._queryIdentifier}function Kd(n,e){return n.tagToQueryMap.get(e)}function Wd(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ce(n.substr(0,e))}}function $d(n,e,t){let r=n.syncPointTree_.get(e);O(r,"Missing sync point for query tag that we're tracking");let i=xl(n.pendingWriteTree_,e);return Gd(r,t,i,null)}function WC(n){return n.fold((e,t,r)=>{if(t&&jn(t))return[kl(t)];{let i=[];return t&&(i=zv(t)),Ke(r,(s,o)=>{i=i.concat(o)}),i}})}function ao(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(LC())(n._repo,n._path):n}function $C(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Dl(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function QC(){return UC++}function HC(n,e,t){let r=e._path,i=yo(n,e),s=Yv(n,t),o=n.listenProvider_.startListening(ao(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)O(!jn(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,p)=>{if(!ee(u)&&d&&jn(d))return[kl(d).query];{let m=[];return d&&(m=m.concat(zv(d).map(y=>y.query))),Ke(p,(y,S)=>{m=m.concat(S)}),m}});for(let u=0;u<c.length;++u){let d=c[u];n.listenProvider_.stopListening(ao(d),yo(n,d))}}return o}var ud=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},hd=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ye(this.path_,e);return new n(this.syncTree_,t)}node(){return Nl(this.syncTree_,this.path_)}},YC=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},ev=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return JC(n[".sv"],e,t);if(typeof n[".sv"]=="object")return XC(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},JC=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},XC=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&O(!1,"Unexpected increment value: "+r);let i=e.node();if(O(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},Jv=function(n,e,t,r){return Hd(e,new hd(t,n),r)},Qd=function(n,e,t){return Hd(n,new ud(e),t)};function Hd(n,e,t){let r=n.getPriority().val(),i=ev(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=ev(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new yi(a,Ee(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new yi(i))),o.forEachChild(pe,(a,c)=>{let u=Hd(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}var vo=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Vl(n,e){let t=e instanceof ce?e:new ce(e),r=n,i=Z(t);for(;i!==null;){let s=Nn(r.node.children,i)||{children:{},childCount:0};r=new vo(i,r,s),t=de(t),i=Z(t)}return r}function br(n){return n.node.value}function Yd(n,e){n.node.value=e,dd(n)}function Xv(n){return n.node.childCount>0}function ZC(n){return br(n)===void 0&&!Xv(n)}function Ol(n,e){Ke(n.node.children,(t,r)=>{e(new vo(t,n,r))})}function Zv(n,e,t,r){t&&!r&&e(n),Ol(n,i=>{Zv(i,e,!0,r)}),t&&r&&e(n)}function eb(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function bo(n){return new ce(n.parent===null?n.name:bo(n.parent)+"/"+n.name)}function dd(n){n.parent!==null&&tb(n.parent,n.name,n)}function tb(n,e,t){let r=ZC(t),i=Et(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,dd(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,dd(n))}var nb=/[\[\].#$\/\u0000-\u001F\u007F]/,rb=/[\[\].#$\u0000-\u001F\u007F]/,Ih=10*1024*1024,Ml=function(n){return typeof n=="string"&&n.length!==0&&!nb.test(n)},ew=function(n){return typeof n=="string"&&n.length!==0&&!rb.test(n)},ib=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ew(n)},wo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!bl(n)||n&&typeof n=="object"&&Et(n,".sv")},Wt=function(n,e,t,r){r&&e===void 0||Ro(ht(n,"value"),e,t)},Ro=function(n,e,t){let r=t instanceof ce?new Mh(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Er(r));if(typeof e=="function")throw new Error(n+"contains a function "+Er(r)+" with contents = "+e.toString());if(bl(e))throw new Error(n+"contains "+e.toString()+" "+Er(r));if(typeof e=="string"&&e.length>Ih/3&&Gs(e)>Ih)throw new Error(n+"contains a string greater than "+Ih+" utf8 bytes "+Er(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ke(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Ml(o)))throw new Error(n+" contains an invalid key ("+o+") "+Er(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);VS(r,o),Ro(n,a,r),OS(r)}),i&&s)throw new Error(n+' contains ".value" child '+Er(r)+" in addition to actual children.")}},sb=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=co(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Ml(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(DS);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&It(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},tw=function(n,e,t,r){if(r&&e===void 0)return;let i=ht(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];Ke(e,(o,a)=>{let c=new ce(o);if(Ro(i,a,ye(t,c)),Dd(c)===".priority"&&!wo(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),sb(i,s)},Jd=function(n,e,t){if(!(t&&e===void 0)){if(bl(e))throw new Error(ht(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!wo(e))throw new Error(ht(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Po=function(n,e,t,r){if(!(r&&t===void 0)&&!Ml(t))throw new Error(ht(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ri=function(n,e,t,r){if(!(r&&t===void 0)&&!ew(t))throw new Error(ht(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},ob=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ri(n,e,t,r)},mt=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},nw=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Ml(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!ib(t))throw new Error(ht(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var fd=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Fl(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!Vd(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function rw(n,e,t){Fl(n,t),iw(n,r=>Vd(r,e))}function gt(n,e,t){Fl(n,t),iw(n,r=>It(r,e)||It(e,r))}function iw(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(ab(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function ab(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();Ir&&ze("event: "+t.toString()),Si(r)}}}var sw="repo_interrupt",lb=25,pd=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fd,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ul(),this.transactionQueueTree_=new vo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function cb(n,e,t){if(n.stats_=Nd(n.repoInfo_),n.forceRestClient_||cS())n.server_=new $h(n.repoInfo_,(r,i,s,o)=>{tv(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>nv(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{De(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Od(n.repoInfo_,e,(r,i,s,o)=>{tv(n,r,i,s,o)},r=>{nv(n,r)},r=>{ub(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=hS(n.repoInfo_,()=>new Xh(n.stats_,n.server_)),n.infoData_=new Qh,n.infoSyncTree_=new vl({startListening:(r,i,s,o)=>{let a=[],c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=Co(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Xd(n,"connected",!1),n.serverSyncTree_=new vl({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,c)=>{let u=o(a,c);gt(n.eventQueue_,r._path,u)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function ow(n){let t=n.infoData_.getNode(new ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function xo(n){return YC({timestamp:ow(n)})}function tv(n,e,t,r,i){n.dataUpdateCount++;let s=new ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let c=js(t,u=>Ee(u));o=zC(n.serverSyncTree_,s,c,i)}else{let c=Ee(t);o=$v(n.serverSyncTree_,s,c,i)}else if(r){let c=js(t,u=>Ee(u));o=qC(n.serverSyncTree_,s,c)}else{let c=Ee(t);o=Co(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=Ii(n,s)),gt(n.eventQueue_,a,o)}function nv(n,e){Xd(n,"connected",e),e===!1&&fb(n)}function ub(n,e){Ke(e,(t,r)=>{Xd(n,t,r)})}function Xd(n,e,t){let r=new ce("/.info/"+e),i=Ee(t);n.infoData_.updateSnapshot(r,i);let s=Co(n.infoSyncTree_,r,i);gt(n.eventQueue_,r,s)}function Ll(n){return n.nextWriteId_++}function hb(n,e,t){let r=KC(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Ee(i).withIndex(e._queryParams.getIndex());cd(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Co(n.serverSyncTree_,e._path,s);else{let a=yo(n.serverSyncTree_,e);o=$v(n.serverSyncTree_,e._path,s,a)}return gt(n.eventQueue_,e._path,o),wl(n.serverSyncTree_,e,t,null,!0),s},i=>(Pi(n,"get for query "+De(e)+" failed: "+i),Promise.reject(new Error(i))))}function Zd(n,e,t,r,i){Pi(n,"set",{path:e.toString(),value:t,priority:r});let s=xo(n),o=Ee(t,r),a=Nl(n.serverSyncTree_,e),c=Qd(o,a,s),u=Ll(n),d=zd(n.serverSyncTree_,e,c,u,!0);Fl(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(m,y)=>{let S=m==="ok";S||Ze("set at "+e+" failed: "+m);let k=Fn(n.serverSyncTree_,u,!S);gt(n.eventQueue_,e,k),Gn(n,i,m,y)});let p=tf(n,e);Ii(n,p),gt(n.eventQueue_,p,[])}function db(n,e,t,r){Pi(n,"update",{path:e.toString(),value:t});let i=!0,s=xo(n),o={};if(Ke(t,(a,c)=>{i=!1,o[a]=Jv(ye(e,a),Ee(c),n.serverSyncTree_,s)}),i)ze("update() called with empty data.  Don't do anything."),Gn(n,r,"ok",void 0);else{let a=Ll(n),c=BC(n.serverSyncTree_,e,o,a);Fl(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,d)=>{let p=u==="ok";p||Ze("update at "+e+" failed: "+u);let m=Fn(n.serverSyncTree_,a,!p),y=m.length>0?Ii(n,e):e;gt(n.eventQueue_,y,m),Gn(n,r,u,d)}),Ke(t,u=>{let d=tf(n,ye(e,u));Ii(n,d)}),gt(n.eventQueue_,e,[])}}function fb(n){Pi(n,"onDisconnectEvents");let e=xo(n),t=ul();Yh(n.onDisconnect_,le(),(i,s)=>{let o=Jv(i,s,n.serverSyncTree_,e);Ci(t,i,o)});let r=[];Yh(t,le(),(i,s)=>{r=r.concat(Co(n.serverSyncTree_,i,s));let o=tf(n,i);Ii(n,o)}),n.onDisconnect_=ul(),gt(n.eventQueue_,le(),r)}function pb(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Hh(n.onDisconnect_,e),Gn(n,t,r,i)})}function rv(n,e,t,r){let i=Ee(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Ci(n.onDisconnect_,e,i),Gn(n,r,s,o)})}function mb(n,e,t,r,i){let s=Ee(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ci(n.onDisconnect_,e,s),Gn(n,i,o,a)})}function gb(n,e,t,r){if(Qa(t)){ze("onDisconnect().update() called with empty data.  Don't do anything."),Gn(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&Ke(t,(o,a)=>{let c=Ee(a);Ci(n.onDisconnect_,ye(e,o),c)}),Gn(n,r,i,s)})}function _b(n,e,t){let r;Z(e._path)===".info"?r=cd(n.infoSyncTree_,e,t):r=cd(n.serverSyncTree_,e,t),rw(n.eventQueue_,e._path,r)}function md(n,e,t){let r;Z(e._path)===".info"?r=wl(n.infoSyncTree_,e,t):r=wl(n.serverSyncTree_,e,t),rw(n.eventQueue_,e._path,r)}function aw(n){n.persistentConnection_&&n.persistentConnection_.interrupt(sw)}function yb(n){n.persistentConnection_&&n.persistentConnection_.resume(sw)}function Pi(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),ze(t,...e)}function Gn(n,e,t,r){e&&Si(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function vb(n,e,t,r,i,s){Pi(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:ov(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=ef(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ro("transaction failed: Data returned ",c,o.path),o.status=0;let u=Vl(n.transactionQueueTree_,e),d=br(u)||[];d.push(o),Yd(u,d);let p;typeof c=="object"&&c!==null&&Et(c,".priority")?(p=Nn(c,".priority"),O(wo(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(Nl(n.serverSyncTree_,e)||J.EMPTY_NODE).getPriority().val();let m=xo(n),y=Ee(c,p),S=Qd(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=S,o.currentWriteId=Ll(n);let k=zd(n.serverSyncTree_,e,S,o.currentWriteId,o.applyLocally);gt(n.eventQueue_,e,k),Ul(n,n.transactionQueueTree_)}}function ef(n,e,t){return Nl(n.serverSyncTree_,e,t)||J.EMPTY_NODE}function Ul(n,e=n.transactionQueueTree_){if(e||Bl(n,e),br(e)){let t=cw(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&wb(n,bo(e),t)}else Xv(e)&&Ol(e,t=>{Ul(n,t)})}function wb(n,e,t){let r=t.map(u=>u.currentWriteId),i=ef(n,e,r),s=i,o=i.hash();for(let u=0;u<t.length;u++){let d=t[u];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=st(e,d.path);s=s.updateChild(p,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Pi(n,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let p=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(Fn(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Bl(n,Vl(n.transactionQueueTree_,e)),Ul(n,n.transactionQueueTree_),gt(n.eventQueue_,e,d);for(let m=0;m<p.length;m++)Si(p[m])}else{if(u==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{Ze("transaction at "+c.toString()+" failed: "+u);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=u}Ii(n,e)}},o)}function Ii(n,e){let t=lw(n,e),r=bo(t),i=cw(n,t);return Eb(n,i,r),r}function Eb(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=st(t,c.path),d=!1,p;if(O(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,i=i.concat(Fn(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=lb)d=!0,p="maxretry",i=i.concat(Fn(n.serverSyncTree_,c.currentWriteId,!0));else{let m=ef(n,c.path,o);c.currentInputSnapshot=m;let y=e[a].update(m.val());if(y!==void 0){Ro("transaction failed: Data returned ",y,c.path);let S=Ee(y);typeof y=="object"&&y!=null&&Et(y,".priority")||(S=S.updatePriority(m.getPriority()));let N=c.currentWriteId,q=xo(n),j=Qd(S,m,q);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=j,c.currentWriteId=Ll(n),o.splice(o.indexOf(N),1),i=i.concat(zd(n.serverSyncTree_,c.path,j,c.currentWriteId,c.applyLocally)),i=i.concat(Fn(n.serverSyncTree_,N,!0))}else d=!0,p="nodata",i=i.concat(Fn(n.serverSyncTree_,c.currentWriteId,!0))}gt(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(p),!1,null))))}Bl(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Si(r[a]);Ul(n,n.transactionQueueTree_)}function lw(n,e){let t,r=n.transactionQueueTree_;for(t=Z(e);t!==null&&br(r)===void 0;)r=Vl(r,t),e=de(e),t=Z(e);return r}function cw(n,e){let t=[];return uw(n,e,t),t.sort((r,i)=>r.order-i.order),t}function uw(n,e,t){let r=br(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Ol(e,i=>{uw(n,i,t)})}function Bl(n,e){let t=br(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,Yd(e,t.length>0?t:void 0)}Ol(e,r=>{Bl(n,r)})}function tf(n,e){let t=bo(lw(n,e)),r=Vl(n.transactionQueueTree_,e);return eb(r,i=>{Ah(n,i)}),Ah(n,r),Zv(r,i=>{Ah(n,i)}),t}function Ah(n,e){let t=br(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Fn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Yd(e,void 0):t.length=s+1,gt(n.eventQueue_,bo(e),i);for(let o=0;o<r.length;o++)Si(r[o])}}function Tb(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Ib(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Ze(`Invalid query segment '${t}' in query '${n}'`)}return e}var gd=function(n,e){let t=Ab(n),r=t.namespace;t.domain==="firebase.com"&&zt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&zt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||eS();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new nl(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new ce(t.pathString)}},Ab=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(i=Tb(n.substring(d,p)));let m=Ib(n.substring(Math.min(n.length,p)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let S=e.indexOf(".");r=e.substring(0,S).toLowerCase(),t=e.substring(S+1),s=r}"ns"in m&&(s=m.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var iv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Sb=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=iv.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=iv.charAt(e[i]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var El=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+De(this.snapshot.exportVal())}},Tl=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Eo=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Il=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Ge;return pb(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){mt("OnDisconnect.remove",this._path);let e=new Ge;return rv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){mt("OnDisconnect.set",this._path),Wt("OnDisconnect.set",e,this._path,!1);let t=new Ge;return rv(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){mt("OnDisconnect.setWithPriority",this._path),Wt("OnDisconnect.setWithPriority",e,this._path,!1),Jd("OnDisconnect.setWithPriority",t,!1);let r=new Ge;return mb(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){mt("OnDisconnect.update",this._path),tw("OnDisconnect.update",e,this._path,!1);let t=new Ge;return gb(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var at=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ee(this._path)?null:Dd(this._path)}get ref(){return new _t(this._repo,this._path)}get _queryIdentifier(){let e=zy(this._queryParams),t=kd(e);return t==="{}"?"default":t}get _queryObject(){return zy(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=Vd(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+NS(this._path)}};function ql(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Kn(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Gt){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Bn)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==un)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===pe){if(e!=null&&!wo(e)||t!=null&&!wo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof uo||n.getIndex()===Fd,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function jl(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var _t=class n extends at{constructor(e,t){super(e,t,new mo,!1)}get parent(){let e=bv(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Ai=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ce(e),r=zn(this.ref,e);return new n(this._node.getChild(t),r,pe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,zn(this.ref,r),pe)))}hasChild(e){let t=new ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function nf(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?zn(n._root,e):n._root}function rf(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=gd(e,n._repo.repoInfo_.nodeAdmin);nw("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&zt("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),nf(n,t.path.toString())}function zn(n,e){return n=ne(n),Z(n._path)===null?ob("child","path",e,!1):Ri("child","path",e,!1),new _t(n._repo,ye(n._path,e))}function hw(n,e){n=ne(n),mt("push",n._path),Wt("push",e,n._path,!0);let t=ow(n._repo),r=Sb(t),i=zn(n,r),s=zn(n,r),o;return e!=null?o=Gl(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function dw(n){return mt("remove",n._path),Gl(n,null)}function Gl(n,e){n=ne(n),mt("set",n._path),Wt("set",e,n._path,!1);let t=new Ge;return Zd(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function fw(n,e){n=ne(n),mt("setPriority",n._path),Jd("setPriority",e,!1);let t=new Ge;return Zd(n._repo,ye(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function pw(n,e,t){if(mt("setWithPriority",n._path),Wt("setWithPriority",e,n._path,!1),Jd("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new Ge;return Zd(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function mw(n,e){tw("update",e,n._path,!1);let t=new Ge;return db(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function gw(n){n=ne(n);let e=new Eo(()=>{}),t=new To(e);return hb(n._repo,n,t).then(r=>new Ai(r,new _t(n._repo,n._path),n._queryParams.getIndex()))}var To=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new El("value",this,new Ai(e.snapshotNode,new _t(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Tl(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Al=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Tl(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let r=zn(new _t(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new El(e.type,this,new Ai(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function ko(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let c=t,u=(d,p)=>{md(n._repo,n,a),c(d,p)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Eo(t,s||void 0),a=e==="value"?new To(o):new Al(e,o);return _b(n._repo,n,a),()=>md(n._repo,n,a)}function zl(n,e,t,r){return ko(n,"value",e,t,r)}function sf(n,e,t,r){return ko(n,"child_added",e,t,r)}function of(n,e,t,r){return ko(n,"child_changed",e,t,r)}function af(n,e,t,r){return ko(n,"child_moved",e,t,r)}function lf(n,e,t,r){return ko(n,"child_removed",e,t,r)}function cf(n,e,t){let r=null,i=t?new Eo(t):null;e==="value"?r=new To(i):e&&(r=new Al(e,i)),md(n._repo,n,r)}var yt=class{},Sl=class extends yt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Wt("endAt",this._value,e._path,!0);let t=Wh(e._queryParams,this._value,this._key);if(jl(t),Kn(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function _w(n,e){return Po("endAt","key",e,!0),new Sl(n,e)}var _d=class extends yt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Wt("endBefore",this._value,e._path,!1);let t=JS(e._queryParams,this._value,this._key);if(jl(t),Kn(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function yw(n,e){return Po("endBefore","key",e,!0),new _d(n,e)}var Cl=class extends yt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Wt("startAt",this._value,e._path,!0);let t=Kh(e._queryParams,this._value,this._key);if(jl(t),Kn(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function vw(n=null,e){return Po("startAt","key",e,!0),new Cl(n,e)}var yd=class extends yt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Wt("startAfter",this._value,e._path,!1);let t=YS(e._queryParams,this._value,this._key);if(jl(t),Kn(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function ww(n,e){return Po("startAfter","key",e,!0),new yd(n,e)}var vd=class extends yt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new at(e._repo,e._path,QS(e._queryParams,this._limit),e._orderByCalled)}};function Ew(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new vd(n)}var wd=class extends yt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new at(e._repo,e._path,HS(e._queryParams,this._limit),e._orderByCalled)}};function Tw(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new wd(n)}var Ed=class extends yt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ql(e,"orderByChild");let t=new ce(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new uo(t),i=Rl(e._queryParams,r);return Kn(i),new at(e._repo,e._path,i,!0)}};function Iw(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ri("orderByChild","path",n,!1),new Ed(n)}var Td=class extends yt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ql(e,"orderByKey");let t=Rl(e._queryParams,Gt);return Kn(t),new at(e._repo,e._path,t,!0)}};function Aw(){return new Td}var Id=class extends yt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ql(e,"orderByPriority");let t=Rl(e._queryParams,pe);return Kn(t),new at(e._repo,e._path,t,!0)}};function Sw(){return new Id}var Ad=class extends yt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ql(e,"orderByValue");let t=Rl(e._queryParams,Fd);return Kn(t),new at(e._repo,e._path,t,!0)}};function Cw(){return new Ad}var Sd=class extends yt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Wt("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Sl(this._value,this._key)._apply(new Cl(this._value,this._key)._apply(e))}};function bw(n,e){return Po("equalTo","key",e,!0),new Sd(n,e)}function St(n,...e){let t=ne(n);for(let r of e)t=r._apply(t);return t}NC(_t);FC(_t);var Cb="FIREBASE_DATABASE_EMULATOR_HOST",Cd={},bb=!1;function Rb(n,e,t,r){n.repoInfo_=new nl(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function uf(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||zt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ze("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=gd(s,i),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[Cb]),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=gd(s,i),a=o.repoInfo):c=!o.repoInfo.secure;let d=i&&c?new io(io.OWNER):new xh(n.name,n.options,e);nw("Invalid Firebase Database URL",o),ee(o.path)||zt("Database URL must point to the root of a Firebase Database (not including a child path).");let p=xb(a,n,d,new Ph(n.name,t));return new bd(p,n)}function Pb(n,e){let t=Cd[e];(!t||t[n.key]!==n)&&zt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),aw(n),delete t[n.key]}function xb(n,e,t,r){let i=Cd[e.name];i||(i={},Cd[e.name]=i);let s=i[n.toURLString()];return s&&zt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new pd(n,bb,t,r),i[n.toURLString()]=s,s}var bd=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(cb(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new _t(this._repo,le())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Pb(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&zt("Cannot call "+e+" on a deleted database.")}};function Rw(){Cv.IS_TRANSPORT_INITIALIZED&&Ze("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Pw(){Rw(),lo.forceDisallow()}function xw(){Rw(),pi.forceDisallow(),lo.forceAllow()}function kw(n,e,t,r={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&zt("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&zt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new io(io.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:Ka(r.mockUserToken,n.app.options.projectId);s=new io(o)}Rb(i,e,t,s)}function Nw(n){n=ne(n),n._checkNotDeleted("goOffline"),aw(n._repo)}function Dw(n){n=ne(n),n._checkNotDeleted("goOnline"),yb(n._repo)}function Vw(n,e){lv(n,e)}function kb(n){xd(Ya),vr(new pt("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return uf(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),xt(by,Ry,n),xt(by,Ry,"esm2017")}var Nb={".sv":"timestamp"};function Ow(){return Nb}function Mw(n){return{".sv":{increment:n}}}var Rd=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function Fw(n,e,t){var r;if(n=ne(n),mt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new Ge,o=(c,u,d)=>{let p=null;c?s.reject(c):(p=new Ai(d,new _t(n._repo,n._path),pe),s.resolve(new Rd(u,p)))},a=zl(n,()=>{});return vb(n._repo,n._path,e,o,a,i),s.promise}Od.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Od.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};kb();var Db="@firebase/database-compat",Vb="1.0.8";var Ob=new Dn("@firebase/database-compat"),Lw=function(n){let e="FIREBASE WARNING: "+n;Ob.warn(e)};var Mb=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(ht(n,e)+"must be a boolean.")},Fb=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ht(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var hf=class{constructor(e){this._delegate=e}cancel(e){$("OnDisconnect.cancel",0,1,arguments.length),Le("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){$("OnDisconnect.remove",0,1,arguments.length),Le("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){$("OnDisconnect.set",1,2,arguments.length),Le("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){$("OnDisconnect.setWithPriority",2,3,arguments.length),Le("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if($("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,Lw("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Le("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var df=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return $("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Rr=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return $("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return $("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return $("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return $("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return $("DataSnapshot.child",0,1,arguments.length),e=String(e),Ri("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return $("DataSnapshot.hasChild",1,1,arguments.length),Ri("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return $("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return $("DataSnapshot.forEach",1,1,arguments.length),Le("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return $("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return $("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return $("DataSnapshot.ref",0,0,arguments.length),new hn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Kl=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;$("Query.on",2,4,arguments.length),Le("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(u,d)=>{t.call(o.context,new Rr(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return zl(this._delegate,a,c),t;case"child_added":return sf(this._delegate,a,c),t;case"child_removed":return lf(this._delegate,a,c),t;case"child_changed":return of(this._delegate,a,c),t;case"child_moved":return af(this._delegate,a,c),t;default:throw new Error(ht("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if($("Query.off",0,3,arguments.length),Fb("Query.off",e,!0),Le("Query.off","callback",t,!0),oh("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,cf(this._delegate,e,i)}else cf(this._delegate,e)}get(){return gw(this._delegate).then(e=>new Rr(this.database,e))}once(e,t,r,i){$("Query.once",1,4,arguments.length),Le("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new Ge,a=(u,d)=>{let p=new Rr(this.database,u);t&&t.call(s.context,p,d),o.resolve(p)};a.userCallback=t,a.context=s.context;let c=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":zl(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":sf(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":lf(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":of(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":af(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(ht("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return $("Query.limitToFirst",1,1,arguments.length),new n(this.database,St(this._delegate,Ew(e)))}limitToLast(e){return $("Query.limitToLast",1,1,arguments.length),new n(this.database,St(this._delegate,Tw(e)))}orderByChild(e){return $("Query.orderByChild",1,1,arguments.length),new n(this.database,St(this._delegate,Iw(e)))}orderByKey(){return $("Query.orderByKey",0,0,arguments.length),new n(this.database,St(this._delegate,Aw()))}orderByPriority(){return $("Query.orderByPriority",0,0,arguments.length),new n(this.database,St(this._delegate,Sw()))}orderByValue(){return $("Query.orderByValue",0,0,arguments.length),new n(this.database,St(this._delegate,Cw()))}startAt(e=null,t){return $("Query.startAt",0,2,arguments.length),new n(this.database,St(this._delegate,vw(e,t)))}startAfter(e=null,t){return $("Query.startAfter",0,2,arguments.length),new n(this.database,St(this._delegate,ww(e,t)))}endAt(e=null,t){return $("Query.endAt",0,2,arguments.length),new n(this.database,St(this._delegate,_w(e,t)))}endBefore(e=null,t){return $("Query.endBefore",0,2,arguments.length),new n(this.database,St(this._delegate,yw(e,t)))}equalTo(e,t){return $("Query.equalTo",1,2,arguments.length),new n(this.database,St(this._delegate,bw(e,t)))}toString(){return $("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return $("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if($("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Le(e,"cancel",i.cancel,!0),i.context=r,oh(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(ht(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new hn(this.database,new _t(this._delegate._repo,this._delegate._path))}},hn=class n extends Kl{constructor(e,t){super(e,new at(t._repo,t._path,new mo,!1)),this.database=e,this._delegate=t}getKey(){return $("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return $("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,zn(this._delegate,e))}getParent(){$("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return $("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){$("Reference.set",1,2,arguments.length),Le("Reference.set","onComplete",t,!0);let r=Gl(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if($("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,Lw("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}mt("Reference.update",this._delegate._path),Le("Reference.update","onComplete",t,!0);let r=mw(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){$("Reference.setWithPriority",2,3,arguments.length),Le("Reference.setWithPriority","onComplete",r,!0);let i=pw(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){$("Reference.remove",0,1,arguments.length),Le("Reference.remove","onComplete",e,!0);let t=dw(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){$("Reference.transaction",1,3,arguments.length),Le("Reference.transaction","transactionUpdate",e,!1),Le("Reference.transaction","onComplete",t,!0),Mb("Reference.transaction","applyLocally",r,!0);let i=Fw(this._delegate,e,{applyLocally:r}).then(s=>new df(s.committed,new Rr(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){$("Reference.setPriority",1,2,arguments.length),Le("Reference.setPriority","onComplete",t,!0);let r=fw(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){$("Reference.push",0,2,arguments.length),Le("Reference.push","onComplete",t,!0);let r=hw(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return mt("Reference.onDisconnect",this._delegate._path),new hf(new Il(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Pr=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Pw,forceLongPolling:xw}}useEmulator(e,t,r={}){kw(this._delegate,e,t,r)}ref(e){if($("database.ref",0,1,arguments.length),e instanceof hn){let t=rf(this._delegate,e.toString());return new hn(this,t)}else{let t=nf(this._delegate,e);return new hn(this,t)}}refFromURL(e){$("database.refFromURL",1,1,arguments.length);let r=rf(this._delegate,e);return new hn(this,r)}goOffline(){return $("database.goOffline",0,0,arguments.length),Nw(this._delegate)}goOnline(){return $("database.goOnline",0,0,arguments.length),Dw(this._delegate)}};Pr.ServerValue={TIMESTAMP:Ow(),increment:n=>Mw(n)};function Lb({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){xd(t);let a=new ah("database-standalone"),c=new Ha("auth-internal",a);c.setComponent(new pt("auth-internal",()=>r,"PRIVATE"));let u;return i&&(u=new Ha("app-check-internal",a),u.setComponent(new pt("app-check-internal",()=>i,"PRIVATE"))),{instance:new Pr(uf(n,c,u,e,o),n),namespace:s}}var Ub=Object.freeze({__proto__:null,initStandalone:Lb});var Bb=Pr.ServerValue;function qb(n){n.INTERNAL.registerComponent(new pt("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Pr(i,r)},"PUBLIC").setServiceProps({Reference:hn,Query:Kl,Database:Pr,DataSnapshot:Rr,enableLogging:Vw,INTERNAL:Ub,ServerValue:Bb}).setMultipleInstances(!0)),n.registerVersion(Db,Vb)}qb(Ue);function No(n,e,t="on",r=ai){return new Cn(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Se(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),S_())}function jb(n){return typeof n=="string"}function Gb(n){return typeof n.exportVal=="function"}function Gw(n){return n==null}function zw(n){return typeof n.set=="function"}function Uw(n,e){return zw(e)?e:n.ref(e)}function Kw(n,e){if(jb(n))return e.stringCase();if(zw(n))return e.firebaseCase();if(Gb(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function Ww(n){return(Gw(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function $w(n,e,t){e=Ww(e);let r=e.map(i=>No(n,i,"on",t));return Fs(...r)}function zb(n,e,t){let r=$w(n,e).pipe(_r((i,s)=>[...i,s],[]));return Wb(n,r,t)}function Kb(n,e){return No(n,"value","on",e).pipe(Se(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function Wb(n,e,t){return Kb(n,t).pipe(R_(e),Se(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),C_(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Se(i=>i.actions))}function Bw(n,e){return function(r,i){return Kw(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function $b(n){return function(t){return t?Kw(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Qb(n,e,t){return No(n,"value","once",t).pipe(an(r=>{let i=[Ut(r)];return e.forEach(s=>i.push(No(n,s,"on",t))),Fs(...i).pipe(_r(Yb,[]))}),La())}function Qw(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function Hb(n,e){if(Gw(e))return 0;{let t=Qw(n,e);return t===-1?n.length:t+1}}function Yb(n,e){let{payload:t,prevKey:r,key:i}=e,s=Qw(n,i),o=Hb(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function qw(n,e,t){return e=Ww(e),Qb(n,e,t)}function Jb(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Bw(r,"update"),set:Bw(r,"set"),push:i=>r.push(i),remove:$b(r),snapshotChanges(i){return qw(n,i,t).pipe(be)},stateChanges(i){return $w(n,i,t).pipe(be)},auditTrail(i){return zb(n,i,t).pipe(be)},valueChanges(i,s){return qw(n,i,t).pipe(Se(a=>a.map(c=>s&&s.idField?Ms(oi({},c.payload.val()),{[s.idField]:c.key}):c.payload.val())),be)}}}function jw(n,e){return function(){return No(n,"value","on",e)}}function Xb(n,e){return{query:n,snapshotChanges(){return jw(n,e.schedulers.outsideAngular)().pipe(be)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return jw(n,e.schedulers.outsideAngular)().pipe(be,Se(r=>r.payload.exists()?r.payload.val():null))}}}var Zb=new je("angularfire2.realtimeDatabaseURL"),eR=new je("angularfire2.database.use-emulator"),tR=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,c,u,d,p,m,y,S,k,N){this.schedulers=a;let q=c,j=wr(t,o,r);u&&Js(j,o,d,m,y,S,p,k),this.database=di(`${j.name}.database.${i}`,"AngularFireDatabase",j.name,()=>{let M=o.runOutsideAngular(()=>j.database(i||void 0));return q&&M.useEmulator(...q),M},[q])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>Uw(this.database,t)),s=i;return r&&(s=r(i)),Jb(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>Uw(this.database,t));return Xb(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(W(Vn),W(On,8),W(Zb,8),W(kn),W(Bt),W(hi),W(eR,8),W(Xs,8),W(Ks,8),W(Ws,8),W($s,8),W(Qs,8),W(Hs,8),W(Ys,8),W(ln,8))};static \u0275prov=Rn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Hw=(()=>{class n{constructor(){Ue.registerVersion("angularfire",cn.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=xn({type:n});static \u0275inj=Pn({providers:[tR]})}return n})();var Yw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Jw={};var Wn,ff;(function(){var n;function e(E,_){function w(){}w.prototype=_.prototype,E.D=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(T,I,C){for(var v=Array(arguments.length-2),rn=2;rn<arguments.length;rn++)v[rn-2]=arguments[rn];return _.prototype[I].apply(T,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,w){w||(w=0);var T=Array(16);if(typeof _=="string")for(var I=0;16>I;++I)T[I]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],I=E.g[2];var C=E.g[3],v=_+(C^w&(I^C))+T[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[1]+3905402710&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[2]+606105819&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[3]+3250441966&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(C^w&(I^C))+T[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[5]+1200080426&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[6]+2821735955&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[7]+4249261313&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(C^w&(I^C))+T[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[9]+2336552879&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[10]+4294925233&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[11]+2304563134&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(C^w&(I^C))+T[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(I^_&(w^I))+T[13]+4254626195&4294967295,C=_+(v<<12&4294967295|v>>>20),v=I+(w^C&(_^w))+T[14]+2792965006&4294967295,I=C+(v<<17&4294967295|v>>>15),v=w+(_^I&(C^_))+T[15]+1236535329&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(I^C&(w^I))+T[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[6]+3225465664&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[11]+643717713&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[0]+3921069994&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^C&(w^I))+T[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[10]+38016083&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[15]+3634488961&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[4]+3889429448&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^C&(w^I))+T[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[14]+3275163606&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[3]+4107603335&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[8]+1163531501&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^C&(w^I))+T[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^I&(_^w))+T[2]+4243563512&4294967295,C=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(C^_))+T[7]+1735328473&4294967295,I=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(I^C))+T[12]+2368359562&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(w^I^C)+T[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[8]+2272392833&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[11]+1839030562&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[14]+4259657740&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^C)+T[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[4]+1272893353&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[7]+4139469664&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[10]+3200236656&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^C)+T[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[0]+3936430074&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[3]+3572445317&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[6]+76029189&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^C)+T[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^I)+T[12]+3873151461&4294967295,C=_+(v<<11&4294967295|v>>>21),v=I+(C^_^w)+T[15]+530742520&4294967295,I=C+(v<<16&4294967295|v>>>16),v=w+(I^C^_)+T[2]+3299628645&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(I^(w|~C))+T[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[7]+1126891415&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[14]+2878612391&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[5]+4237533241&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~C))+T[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[3]+2399980690&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[10]+4293915773&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[1]+2240044497&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~C))+T[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[15]+4264355552&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[6]+2734768916&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[13]+1309151649&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~C))+T[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~I))+T[11]+3174756917&4294967295,C=_+(v<<10&4294967295|v>>>22),v=I+(_^(C|~w))+T[2]+718787259&4294967295,I=C+(v<<15&4294967295|v>>>17),v=w+(C^(I|~_))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+C&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var w=_-this.blockSize,T=this.B,I=this.h,C=0;C<_;){if(I==0)for(;C<=w;)i(this,E,C),C+=this.blockSize;if(typeof E=="string"){for(;C<_;)if(T[I++]=E.charCodeAt(C++),I==this.blockSize){i(this,T),I=0;break}}else for(;C<_;)if(T[I++]=E[C++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var w=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=w&255,w/=256;for(this.u(E),E=Array(16),_=w=0;4>_;++_)for(var T=0;32>T;T+=8)E[w++]=this.g[_]>>>T&255;return E};function s(E,_){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;for(var w=[],T=!0,I=E.length-1;0<=I;I--){var C=E[I]|0;T&&C==_||(w[I]=C,T=!1)}this.g=w}var a={};function c(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function u(E){if(isNaN(E)||!isFinite(E))return p;if(0>E)return N(u(-E));for(var _=[],w=1,T=0;E>=w;T++)_[T]=E/w|0,w*=4294967296;return new o(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return N(d(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(_,8)),T=p,I=0;I<E.length;I+=8){var C=Math.min(8,E.length-I),v=parseInt(E.substring(I,I+C),_);8>C?(C=u(Math.pow(_,C)),T=T.j(C).add(u(v))):(T=T.j(w),T=T.add(u(v)))}return T}var p=c(0),m=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(k(this))return-N(this).m();for(var E=0,_=1,w=0;w<this.g.length;w++){var T=this.i(w);E+=(0<=T?T:4294967296+T)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(k(this))return"-"+N(this).toString(E);for(var _=u(Math.pow(E,6)),w=this,T="";;){var I=K(w,_).g;w=q(w,I.j(_));var C=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=I,S(w))return C+T;for(;6>C.length;)C="0"+C;T=C+T}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function k(E){return E.h==-1}n.l=function(E){return E=q(this,E),k(E)?-1:S(E)?0:1};function N(E){for(var _=E.g.length,w=[],T=0;T<_;T++)w[T]=~E.g[T];return new o(w,~E.h).add(m)}n.abs=function(){return k(this)?N(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0,I=0;I<=_;I++){var C=T+(this.i(I)&65535)+(E.i(I)&65535),v=(C>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=v>>>16,C&=65535,v&=65535,w[I]=v<<16|C}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(E,_){return E.add(N(_))}n.j=function(E){if(S(this)||S(E))return p;if(k(this))return k(E)?N(this).j(N(E)):N(N(this).j(E));if(k(E))return N(this.j(N(E)));if(0>this.l(y)&&0>E.l(y))return u(this.m()*E.m());for(var _=this.g.length+E.g.length,w=[],T=0;T<2*_;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<E.g.length;I++){var C=this.i(T)>>>16,v=this.i(T)&65535,rn=E.i(I)>>>16,_s=E.i(I)&65535;w[2*T+2*I]+=v*_s,j(w,2*T+2*I),w[2*T+2*I+1]+=C*_s,j(w,2*T+2*I+1),w[2*T+2*I+1]+=v*rn,j(w,2*T+2*I+1),w[2*T+2*I+2]+=C*rn,j(w,2*T+2*I+2)}for(T=0;T<_;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=_;T<2*_;T++)w[T]=0;return new o(w,0)};function j(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function M(E,_){this.g=E,this.h=_}function K(E,_){if(S(_))throw Error("division by zero");if(S(E))return new M(p,p);if(k(E))return _=K(N(E),_),new M(N(_.g),N(_.h));if(k(_))return _=K(E,N(_)),new M(N(_.g),_.h);if(30<E.g.length){if(k(E)||k(_))throw Error("slowDivide_ only works with positive integers.");for(var w=m,T=_;0>=T.l(E);)w=H(w),T=H(T);var I=Y(w,1),C=Y(T,1);for(T=Y(T,2),w=Y(w,2);!S(T);){var v=C.add(T);0>=v.l(E)&&(I=I.add(w),C=v),T=Y(T,1),w=Y(w,1)}return _=q(E,I.j(_)),new M(I,_)}for(I=p;0<=E.l(_);){for(w=Math.max(1,Math.floor(E.m()/_.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),C=u(w),v=C.j(_);k(v)||0<v.l(E);)w-=T,C=u(w),v=C.j(_);S(C)&&(C=m),I=I.add(C),E=q(E,v)}return new M(I,E)}n.A=function(E){return K(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)&E.i(T);return new o(w,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)|E.i(T);return new o(w,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)^E.i(T);return new o(w,this.h^E.h)};function H(E){for(var _=E.g.length+1,w=[],T=0;T<_;T++)w[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(w,E.h)}function Y(E,_){var w=_>>5;_%=32;for(var T=E.g.length-w,I=[],C=0;C<T;C++)I[C]=0<_?E.i(C+w)>>>_|E.i(C+w+1)<<32-_:E.i(C+w);return new o(I,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ff=Jw.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Wn=Jw.Integer=o}).apply(typeof Yw<"u"?Yw:typeof self<"u"?self:typeof window<"u"?window:{});var Wl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},dn={};var pf,nR,xi,mf,Do,$l,gf,_f,yf;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Wl=="object"&&Wl];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(l,h){if(h)e:{var f=r;l=l.split(".");for(var g=0;g<l.length-1;g++){var A=l[g];if(!(A in f))break e;f=f[A]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,g=!1,A={next:function(){if(!g&&f<l.length){var R=f++;return{value:h(R,l[R]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function m(l,h,f){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function S(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,A,R){for(var F=Array(arguments.length-2),he=2;he<arguments.length;he++)F[he-2]=arguments[he];return h.prototype[A].apply(g,F)}}function k(l){let h=l.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function N(l,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(c(g)){let A=l.length||0,R=g.length||0;l.length=A+R;for(let F=0;F<R;F++)l[A+F]=g[F]}else l.push(g)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(l){return/^[\s\xa0]*$/.test(l)}function M(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function K(l){return K[" "](l),l}K[" "]=function(){};var H=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function Y(l,h,f){for(let g in l)h.call(f,l[g],g,l)}function E(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(l,h){let f,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(f in g)l[f]=g[f];for(let R=0;R<w.length;R++)f=w[R],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function I(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function C(l){a.setTimeout(()=>{throw l},0)}function v(){var l=_u;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class rn{constructor(){this.h=this.g=null}add(h,f){let g=_s.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var _s=new q(()=>new V0,l=>l.reset());class V0{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let ys,vs=!1,_u=new rn,Eg=()=>{let l=a.Promise.resolve(void 0);ys=()=>{l.then(O0)}};var O0=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){C(f)}var h=_s;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}vs=!1};function Tn(){this.s=this.s,this.C=this.C}Tn.prototype.s=!1,Tn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Tn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function He(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}He.prototype.h=function(){this.defaultPrevented=!0};var M0=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function ws(l,h){if(He.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(H){e:{try{K(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:F0[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&ws.aa.h.call(this)}}S(ws,He);var F0={2:"touch",3:"pen",4:"mouse"};ws.prototype.h=function(){ws.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Es="closure_listenable_"+(1e6*Math.random()|0),L0=0;function U0(l,h,f,g,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=A,this.key=++L0,this.da=this.fa=!1}function Ea(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Ta(l){this.src=l,this.g={},this.h=0}Ta.prototype.add=function(l,h,f,g,A){var R=l.toString();l=this.g[R],l||(l=this.g[R]=[],this.h++);var F=vu(l,h,g,A);return-1<F?(h=l[F],f||(h.fa=!1)):(h=new U0(h,this.src,R,!!g,A),h.fa=f,l.push(h)),h};function yu(l,h){var f=h.type;if(f in l.g){var g=l.g[f],A=Array.prototype.indexOf.call(g,h,void 0),R;(R=0<=A)&&Array.prototype.splice.call(g,A,1),R&&(Ea(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function vu(l,h,f,g){for(var A=0;A<l.length;++A){var R=l[A];if(!R.da&&R.listener==h&&R.capture==!!f&&R.ha==g)return A}return-1}var wu="closure_lm_"+(1e6*Math.random()|0),Eu={};function Tg(l,h,f,g,A){if(g&&g.once)return Ag(l,h,f,g,A);if(Array.isArray(h)){for(var R=0;R<h.length;R++)Tg(l,h[R],f,g,A);return null}return f=Su(f),l&&l[Es]?l.K(h,f,u(g)?!!g.capture:!!g,A):Ig(l,h,f,!1,g,A)}function Ig(l,h,f,g,A,R){if(!h)throw Error("Invalid event type");var F=u(A)?!!A.capture:!!A,he=Iu(l);if(he||(l[wu]=he=new Ta(l)),f=he.add(h,f,g,F,R),f.proxy)return f;if(g=B0(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)M0||(A=F),A===void 0&&(A=!1),l.addEventListener(h.toString(),g,A);else if(l.attachEvent)l.attachEvent(Cg(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function B0(){function l(f){return h.call(l.src,l.listener,f)}let h=q0;return l}function Ag(l,h,f,g,A){if(Array.isArray(h)){for(var R=0;R<h.length;R++)Ag(l,h[R],f,g,A);return null}return f=Su(f),l&&l[Es]?l.L(h,f,u(g)?!!g.capture:!!g,A):Ig(l,h,f,!0,g,A)}function Sg(l,h,f,g,A){if(Array.isArray(h))for(var R=0;R<h.length;R++)Sg(l,h[R],f,g,A);else g=u(g)?!!g.capture:!!g,f=Su(f),l&&l[Es]?(l=l.i,h=String(h).toString(),h in l.g&&(R=l.g[h],f=vu(R,f,g,A),-1<f&&(Ea(R[f]),Array.prototype.splice.call(R,f,1),R.length==0&&(delete l.g[h],l.h--)))):l&&(l=Iu(l))&&(h=l.g[h.toString()],l=-1,h&&(l=vu(h,f,g,A)),(f=-1<l?h[l]:null)&&Tu(f))}function Tu(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Es])yu(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent(Cg(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=Iu(h))?(yu(f,l),f.h==0&&(f.src=null,h[wu]=null)):Ea(l)}}}function Cg(l){return l in Eu?Eu[l]:Eu[l]="on"+l}function q0(l,h){if(l.da)l=!0;else{h=new ws(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&Tu(l),l=f.call(g,h)}return l}function Iu(l){return l=l[wu],l instanceof Ta?l:null}var Au="__closure_events_fn_"+(1e9*Math.random()>>>0);function Su(l){return typeof l=="function"?l:(l[Au]||(l[Au]=function(h){return l.handleEvent(h)}),l[Au])}function Ye(){Tn.call(this),this.i=new Ta(this),this.M=this,this.F=null}S(Ye,Tn),Ye.prototype[Es]=!0,Ye.prototype.removeEventListener=function(l,h,f,g){Sg(this,l,h,f,g)};function nt(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new He(h,l);else if(h instanceof He)h.target=h.target||l;else{var A=h;h=new He(g,l),T(h,A)}if(A=!0,f)for(var R=f.length-1;0<=R;R--){var F=h.g=f[R];A=Ia(F,g,!0,h)&&A}if(F=h.g=l,A=Ia(F,g,!0,h)&&A,A=Ia(F,g,!1,h)&&A,f)for(R=0;R<f.length;R++)F=h.g=f[R],A=Ia(F,g,!1,h)&&A}Ye.prototype.N=function(){if(Ye.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)Ea(f[g]);delete l.g[h],l.h--}}this.F=null},Ye.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},Ye.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function Ia(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,R=0;R<h.length;++R){var F=h[R];if(F&&!F.da&&F.capture==f){var he=F.listener,We=F.ha||F.src;F.fa&&yu(l.i,F),A=he.call(We,g)!==!1&&A}}return A&&!g.defaultPrevented}function bg(l,h,f){if(typeof l=="function")f&&(l=m(l,f));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function Rg(l){l.g=bg(()=>{l.g=null,l.i&&(l.i=!1,Rg(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class j0 extends Tn{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Rg(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ts(l){Tn.call(this),this.h=l,this.g={}}S(Ts,Tn);var Pg=[];function xg(l){Y(l.g,function(h,f){this.g.hasOwnProperty(f)&&Tu(h)},l),l.g={}}Ts.prototype.N=function(){Ts.aa.N.call(this),xg(this)},Ts.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Cu=a.JSON.stringify,G0=a.JSON.parse,z0=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function bu(){}bu.prototype.h=null;function kg(l){return l.h||(l.h=l.i())}function Ng(){}var Is={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ru(){He.call(this,"d")}S(Ru,He);function Pu(){He.call(this,"c")}S(Pu,He);var dr={},Dg=null;function Aa(){return Dg=Dg||new Ye}dr.La="serverreachability";function Vg(l){He.call(this,dr.La,l)}S(Vg,He);function As(l){let h=Aa();nt(h,new Vg(h))}dr.STAT_EVENT="statevent";function Og(l,h){He.call(this,dr.STAT_EVENT,l),this.stat=h}S(Og,He);function rt(l){let h=Aa();nt(h,new Og(h,l))}dr.Ma="timingevent";function Mg(l,h){He.call(this,dr.Ma,l),this.size=h}S(Mg,He);function Ss(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Cs(){this.g=!0}Cs.prototype.xa=function(){this.g=!1};function K0(l,h,f,g,A,R){l.info(function(){if(l.g)if(R)for(var F="",he=R.split("&"),We=0;We<he.length;We++){var ae=he[We].split("=");if(1<ae.length){var Je=ae[0];ae=ae[1];var Xe=Je.split("_");F=2<=Xe.length&&Xe[1]=="type"?F+(Je+"="+ae+"&"):F+(Je+"=redacted&")}}else F=null;else F=R;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+f+`
`+F})}function W0(l,h,f,g,A,R,F){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+f+`
`+R+" "+F})}function ni(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+Q0(l,f)+(g?" "+g:"")})}function $0(l,h){l.info(function(){return"TIMEOUT: "+h})}Cs.prototype.info=function(){};function Q0(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var R=A[0];if(R!="noop"&&R!="stop"&&R!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return Cu(f)}catch{return h}}var Sa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Fg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xu;function Ca(){}S(Ca,bu),Ca.prototype.g=function(){return new XMLHttpRequest},Ca.prototype.i=function(){return{}},xu=new Ca;function In(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new Ts(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Lg}function Lg(){this.i=null,this.g="",this.h=!1}var Ug={},ku={};function Nu(l,h,f){l.L=1,l.v=xa(sn(h)),l.m=f,l.P=!0,Bg(l,null)}function Bg(l,h){l.F=Date.now(),ba(l),l.A=sn(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),e_(f.i,"t",g),l.C=0,f=l.j.J,l.h=new Lg,l.g=y_(l.j,f?h:null,!l.m),0<l.O&&(l.M=new j0(m(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(Pg[0]=A.toString()),A=Pg);for(var R=0;R<A.length;R++){var F=Tg(f,A[R],g||h.handleEvent,!1,h.h||h);if(!F)break;h.g[F.key]=F}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),As(),K0(l.i,l.u,l.A,l.l,l.R,l.m)}In.prototype.ca=function(l){l=l.target;let h=this.M;h&&on(l)==3?h.j():this.Y(l)},In.prototype.Y=function(l){try{if(l==this.g)e:{let Xe=on(this.g);var h=this.g.Ba();let si=this.g.Z();if(!(3>Xe)&&(Xe!=3||this.g&&(this.h.h||this.g.oa()||a_(this.g)))){this.J||Xe!=4||h==7||(h==8||0>=si?As(3):As(2)),Du(this);var f=this.g.Z();this.X=f;t:if(qg(this)){var g=a_(this.g);l="";var A=g.length,R=on(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fr(this),bs(this);var F="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(R&&h==A-1)});g.length=0,this.h.g+=l,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=f==200,W0(this.i,this.u,this.A,this.l,this.R,Xe,f),this.o){if(this.T&&!this.K){t:{if(this.g){var he,We=this.g;if((he=We.g?We.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(he)){var ae=he;break t}}ae=null}if(f=ae)ni(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vu(this,f);else{this.o=!1,this.s=3,rt(12),fr(this),bs(this);break e}}if(this.P){f=!0;let Pt;for(;!this.J&&this.C<F.length;)if(Pt=H0(this,F),Pt==ku){Xe==4&&(this.s=4,rt(14),f=!1),ni(this.i,this.l,null,"[Incomplete Response]");break}else if(Pt==Ug){this.s=4,rt(15),ni(this.i,this.l,F,"[Invalid Chunk]"),f=!1;break}else ni(this.i,this.l,Pt,null),Vu(this,Pt);if(qg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xe!=4||F.length!=0||this.h.h||(this.s=1,rt(16),f=!1),this.o=this.o&&f,!f)ni(this.i,this.l,F,"[Invalid Chunked Response]"),fr(this),bs(this);else if(0<F.length&&!this.W){this.W=!0;var Je=this.j;Je.g==this&&Je.ba&&!Je.M&&(Je.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Bu(Je),Je.M=!0,rt(11))}}else ni(this.i,this.l,F,null),Vu(this,F);Xe==4&&fr(this),this.o&&!this.J&&(Xe==4?p_(this.j,this):(this.o=!1,ba(this)))}else dA(this.g),f==400&&0<F.indexOf("Unknown SID")?(this.s=3,rt(12)):(this.s=0,rt(13)),fr(this),bs(this)}}}catch{}finally{}};function qg(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function H0(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?ku:(f=Number(h.substring(f,g)),isNaN(f)?Ug:(g+=1,g+f>h.length?ku:(h=h.slice(g,g+f),l.C=g+f,h)))}In.prototype.cancel=function(){this.J=!0,fr(this)};function ba(l){l.S=Date.now()+l.I,jg(l,l.I)}function jg(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ss(m(l.ba,l),h)}function Du(l){l.B&&(a.clearTimeout(l.B),l.B=null)}In.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?($0(this.i,this.A),this.L!=2&&(As(),rt(17)),fr(this),this.s=2,bs(this)):jg(this,this.S-l)};function bs(l){l.j.G==0||l.J||p_(l.j,l)}function fr(l){Du(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,xg(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Vu(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||Ou(f.h,l))){if(!l.K&&Ou(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Oa(f),Da(f);else break e;Uu(f),rt(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=Ss(m(f.Za,f),6e3));if(1>=Kg(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else mr(f,11)}else if((l.K||f.g==l)&&Oa(f),!j(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(f.T=ae[0],ae=ae[1],f.G==2)if(ae[0]=="c"){f.K=ae[1],f.ia=ae[2];let Je=ae[3];Je!=null&&(f.la=Je,f.j.info("VER="+f.la));let Xe=ae[4];Xe!=null&&(f.Aa=Xe,f.j.info("SVER="+f.Aa));let si=ae[5];si!=null&&typeof si=="number"&&0<si&&(g=1.5*si,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let Pt=l.g;if(Pt){let Fa=Pt.g?Pt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fa){var R=g.h;R.g||Fa.indexOf("spdy")==-1&&Fa.indexOf("quic")==-1&&Fa.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Mu(R,R.h),R.h=null))}if(g.D){let qu=Pt.g?Pt.g.getResponseHeader("X-HTTP-Session-Id"):null;qu&&(g.ya=qu,ge(g.I,g.D,qu))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var F=l;if(g.qa=__(g,g.J?g.ia:null,g.W),F.K){Wg(g.h,F);var he=F,We=g.L;We&&(he.I=We),he.B&&(Du(he),ba(he)),g.g=F}else d_(g);0<f.i.length&&Va(f)}else ae[0]!="stop"&&ae[0]!="close"||mr(f,7);else f.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?mr(f,7):Lu(f):ae[0]!="noop"&&f.l&&f.l.ta(ae),f.v=0)}}As(4)}catch{}}var Y0=class{constructor(l,h){this.g=l,this.map=h}};function Gg(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function zg(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Kg(l){return l.h?1:l.g?l.g.size:0}function Ou(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Mu(l,h){l.g?l.g.add(h):l.h=h}function Wg(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}Gg.prototype.cancel=function(){if(this.i=$g(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function $g(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return k(l.i)}function J0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function X0(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let g in l)h[f++]=g;return h}}}function Qg(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=X0(l),g=J0(l),A=g.length,R=0;R<A;R++)h.call(void 0,g[R],f&&f[R],l)}var Hg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Z0(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),A=null;if(0<=g){var R=l[f].substring(0,g);A=l[f].substring(g+1)}else R=l[f];h(R,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function pr(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof pr){this.h=l.h,Ra(this,l.j),this.o=l.o,this.g=l.g,Pa(this,l.s),this.l=l.l;var h=l.i,f=new xs;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),Yg(this,f),this.m=l.m}else l&&(h=String(l).match(Hg))?(this.h=!1,Ra(this,h[1]||"",!0),this.o=Rs(h[2]||""),this.g=Rs(h[3]||"",!0),Pa(this,h[4]),this.l=Rs(h[5]||"",!0),Yg(this,h[6]||"",!0),this.m=Rs(h[7]||"")):(this.h=!1,this.i=new xs(null,this.h))}pr.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Ps(h,Jg,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Ps(h,Jg,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(Ps(f,f.charAt(0)=="/"?nA:tA,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",Ps(f,iA)),l.join("")};function sn(l){return new pr(l)}function Ra(l,h,f){l.j=f?Rs(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function Pa(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Yg(l,h,f){h instanceof xs?(l.i=h,sA(l.i,l.h)):(f||(h=Ps(h,rA)),l.i=new xs(h,l.h))}function ge(l,h,f){l.i.set(h,f)}function xa(l){return ge(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Rs(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ps(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,eA),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function eA(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Jg=/[#\/\?@]/g,tA=/[#\?:]/g,nA=/[#\?]/g,rA=/[#\?@]/g,iA=/#/g;function xs(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function An(l){l.g||(l.g=new Map,l.h=0,l.i&&Z0(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=xs.prototype,n.add=function(l,h){An(this),this.i=null,l=ri(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function Xg(l,h){An(l),h=ri(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function Zg(l,h){return An(l),h=ri(l,h),l.g.has(h)}n.forEach=function(l,h){An(this),this.g.forEach(function(f,g){f.forEach(function(A){l.call(h,A,g,this)},this)},this)},n.na=function(){An(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let A=l[g];for(let R=0;R<A.length;R++)f.push(h[g])}return f},n.V=function(l){An(this);let h=[];if(typeof l=="string")Zg(this,l)&&(h=h.concat(this.g.get(ri(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return An(this),this.i=null,l=ri(this,l),Zg(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function e_(l,h,f){Xg(l,h),0<f.length&&(l.i=null,l.g.set(ri(l,h),k(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let R=encodeURIComponent(String(g)),F=this.V(g);for(g=0;g<F.length;g++){var A=R;F[g]!==""&&(A+="="+encodeURIComponent(String(F[g]))),l.push(A)}}return this.i=l.join("&")};function ri(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function sA(l,h){h&&!l.j&&(An(l),l.i=null,l.g.forEach(function(f,g){var A=g.toLowerCase();g!=A&&(Xg(this,g),e_(this,A,f))},l)),l.j=h}function oA(l,h){let f=new Cs;if(a.Image){let g=new Image;g.onload=y(Sn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(Sn,f,"TestLoadImage: error",!1,h,g),g.onabort=y(Sn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(Sn,f,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function aA(l,h){let f=new Cs,g=new AbortController,A=setTimeout(()=>{g.abort(),Sn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(R=>{clearTimeout(A),R.ok?Sn(f,"TestPingServer: ok",!0,h):Sn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),Sn(f,"TestPingServer: error",!1,h)})}function Sn(l,h,f,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(f)}catch{}}function lA(){this.g=new z0}function cA(l,h,f){let g=f||"";try{Qg(l,function(A,R){let F=A;u(A)&&(F=Cu(A)),h.push(g+R+"="+encodeURIComponent(F))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function ks(l){this.l=l.Ub||null,this.j=l.eb||!1}S(ks,bu),ks.prototype.g=function(){return new ka(this.l,this.j)},ks.prototype.i=function(l){return function(){return l}}({});function ka(l,h){Ye.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(ka,Ye),n=ka.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,Ds(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ns(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ds(this)),this.g&&(this.readyState=3,Ds(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;t_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function t_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?Ns(this):Ds(this),this.readyState==3&&t_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,Ns(this))},n.Qa=function(l){this.g&&(this.response=l,Ns(this))},n.ga=function(){this.g&&Ns(this)};function Ns(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Ds(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function Ds(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(ka.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function n_(l){let h="";return Y(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function Fu(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=n_(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):ge(l,h,f))}function Ae(l){Ye.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Ae,Ye);var uA=/^https?$/i,hA=["POST","PUT"];n=Ae.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xu.g(),this.v=this.o?kg(this.o):kg(xu),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(R){r_(this,R);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)f.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let R of g.keys())f.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(hA,h,void 0))||g||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,F]of f)this.g.setRequestHeader(R,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{o_(this),this.u=!0,this.g.send(l),this.u=!1}catch(R){r_(this,R)}};function r_(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,i_(l),Na(l)}function i_(l){l.A||(l.A=!0,nt(l,"complete"),nt(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,nt(this,"complete"),nt(this,"abort"),Na(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Na(this,!0)),Ae.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?s_(this):this.bb())},n.bb=function(){s_(this)};function s_(l){if(l.h&&typeof o<"u"&&(!l.v[1]||on(l)!=4||l.Z()!=2)){if(l.u&&on(l)==4)bg(l.Ea,0,l);else if(nt(l,"readystatechange"),on(l)==4){l.h=!1;try{let F=l.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=F===0){var A=String(l.D).match(Hg)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),g=!uA.test(A?A.toLowerCase():"")}f=g}if(f)nt(l,"complete"),nt(l,"success");else{l.m=6;try{var R=2<on(l)?l.g.statusText:""}catch{R=""}l.l=R+" ["+l.Z()+"]",i_(l)}}finally{Na(l)}}}}function Na(l,h){if(l.g){o_(l);let f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||nt(l,"ready");try{f.onreadystatechange=g}catch{}}}function o_(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function on(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<on(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),G0(h)}};function a_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function dA(l){let h={};l=(l.g&&2<=on(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(j(l[g]))continue;var f=I(l[g]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let R=h[A]||[];h[A]=R,R.push(f)}E(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Vs(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function l_(l){this.Aa=0,this.i=[],this.j=new Cs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Vs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Vs("baseRetryDelayMs",5e3,l),this.cb=Vs("retryDelaySeedMs",1e4,l),this.Wa=Vs("forwardChannelMaxRetries",2,l),this.wa=Vs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Gg(l&&l.concurrentRequestLimit),this.Da=new lA,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=l_.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,g){rt(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=__(this,null,this.W),Va(this)};function Lu(l){if(c_(l),l.G==3){var h=l.U++,f=sn(l.I);if(ge(f,"SID",l.K),ge(f,"RID",h),ge(f,"TYPE","terminate"),Os(l,f),h=new In(l,l.j,h),h.L=2,h.v=xa(sn(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=y_(h.j,null),h.g.ea(h.v)),h.F=Date.now(),ba(h)}g_(l)}function Da(l){l.g&&(Bu(l),l.g.cancel(),l.g=null)}function c_(l){Da(l),l.u&&(a.clearTimeout(l.u),l.u=null),Oa(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Va(l){if(!zg(l.h)&&!l.s){l.s=!0;var h=l.Ga;ys||Eg(),vs||(ys(),vs=!0),_u.add(h,l),l.B=0}}function fA(l,h){return Kg(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ss(m(l.Ga,l,h),m_(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new In(this,this.j,l),R=this.o;if(this.S&&(R?(R=_(R),T(R,this.S)):R=this.S),this.m!==null||this.O||(A.H=R,R=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=h_(this,A,h),f=sn(this.I),ge(f,"RID",l),ge(f,"CVER",22),this.D&&ge(f,"X-HTTP-Session-Id",this.D),Os(this,f),R&&(this.O?h="headers="+encodeURIComponent(String(n_(R)))+"&"+h:this.m&&Fu(f,this.m,R)),Mu(this.h,A),this.Ua&&ge(f,"TYPE","init"),this.P?(ge(f,"$req",h),ge(f,"SID","null"),A.T=!0,Nu(A,f,null)):Nu(A,f,h),this.G=2}}else this.G==3&&(l?u_(this,l):this.i.length==0||zg(this.h)||u_(this))};function u_(l,h){var f;h?f=h.l:f=l.U++;let g=sn(l.I);ge(g,"SID",l.K),ge(g,"RID",f),ge(g,"AID",l.T),Os(l,g),l.m&&l.o&&Fu(g,l.m,l.o),f=new In(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=h_(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Mu(l.h,f),Nu(f,g,h)}function Os(l,h){l.H&&Y(l.H,function(f,g){ge(h,g,f)}),l.l&&Qg({},function(f,g){ge(h,g,f)})}function h_(l,h,f){f=Math.min(l.i.length,f);var g=l.l?m(l.l.Na,l.l,l):null;e:{var A=l.i;let R=-1;for(;;){let F=["count="+f];R==-1?0<f?(R=A[0].g,F.push("ofs="+R)):R=0:F.push("ofs="+R);let he=!0;for(let We=0;We<f;We++){let ae=A[We].g,Je=A[We].map;if(ae-=R,0>ae)R=Math.max(0,A[We].g-100),he=!1;else try{cA(Je,F,"req"+ae+"_")}catch{g&&g(Je)}}if(he){g=F.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function d_(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;ys||Eg(),vs||(ys(),vs=!0),_u.add(h,l),l.v=0}}function Uu(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ss(m(l.Fa,l),m_(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,f_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ss(m(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,rt(10),Da(this),f_(this))};function Bu(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function f_(l){l.g=new In(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=sn(l.qa);ge(h,"RID","rpc"),ge(h,"SID",l.K),ge(h,"AID",l.T),ge(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&ge(h,"TO",l.ja),ge(h,"TYPE","xmlhttp"),Os(l,h),l.m&&l.o&&Fu(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=xa(sn(h)),f.m=null,f.P=!0,Bg(f,l)}n.Za=function(){this.C!=null&&(this.C=null,Da(this),Uu(this),rt(19))};function Oa(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function p_(l,h){var f=null;if(l.g==h){Oa(l),Bu(l),l.g=null;var g=2}else if(Ou(l.h,h))f=h.D,Wg(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;g=Aa(),nt(g,new Mg(g,f)),Va(l)}else d_(l);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&fA(l,h)||g==2&&Uu(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:mr(l,5);break;case 4:mr(l,10);break;case 3:mr(l,6);break;default:mr(l,2)}}}function m_(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function mr(l,h){if(l.j.info("Error code "+h),h==2){var f=m(l.fb,l),g=l.Xa;let A=!g;g=new pr(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ra(g,"https"),xa(g),A?oA(g.toString(),f):aA(g.toString(),f)}else rt(2);l.G=0,l.l&&l.l.sa(h),g_(l),c_(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),rt(2)):(this.j.info("Failed to ping google.com"),rt(1))};function g_(l){if(l.G=0,l.ka=[],l.l){let h=$g(l.h);(h.length!=0||l.i.length!=0)&&(N(l.ka,h),N(l.ka,l.i),l.h.i.length=0,k(l.i),l.i.length=0),l.l.ra()}}function __(l,h,f){var g=f instanceof pr?sn(f):new pr(f);if(g.g!="")h&&(g.g=h+"."+g.g),Pa(g,g.s);else{var A=a.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var R=new pr(null);g&&Ra(R,g),h&&(R.g=h),A&&Pa(R,A),f&&(R.l=f),g=R}return f=l.D,h=l.ya,f&&h&&ge(g,f,h),ge(g,"VER",l.la),Os(l,g),g}function y_(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ae(new ks({eb:f})):new Ae(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function v_(){}n=v_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ma(){}Ma.prototype.g=function(l,h){return new ft(l,h)};function ft(l,h){Ye.call(this),this.g=new l_(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!j(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new ii(this)}S(ft,Ye),ft.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ft.prototype.close=function(){Lu(this.g)},ft.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=Cu(l),l=f);h.i.push(new Y0(h.Ya++,l)),h.G==3&&Va(h)},ft.prototype.N=function(){this.g.l=null,delete this.j,Lu(this.g),delete this.g,ft.aa.N.call(this)};function w_(l){Ru.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}S(w_,Ru);function E_(){Pu.call(this),this.status=1}S(E_,Pu);function ii(l){this.g=l}S(ii,v_),ii.prototype.ua=function(){nt(this.g,"a")},ii.prototype.ta=function(l){nt(this.g,new w_(l))},ii.prototype.sa=function(l){nt(this.g,new E_)},ii.prototype.ra=function(){nt(this.g,"b")},Ma.prototype.createWebChannel=Ma.prototype.g,ft.prototype.send=ft.prototype.o,ft.prototype.open=ft.prototype.m,ft.prototype.close=ft.prototype.close,yf=dn.createWebChannelTransport=function(){return new Ma},_f=dn.getStatEventTarget=function(){return Aa()},gf=dn.Event=dr,$l=dn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Sa.NO_ERROR=0,Sa.TIMEOUT=8,Sa.HTTP_ERROR=6,Do=dn.ErrorCode=Sa,Fg.COMPLETE="complete",mf=dn.EventType=Fg,Ng.EventType=Is,Is.OPEN="a",Is.CLOSE="b",Is.ERROR="c",Is.MESSAGE="d",Ye.prototype.listen=Ye.prototype.K,xi=dn.WebChannel=Ng,nR=dn.FetchXmlHttpFactory=ks,Ae.prototype.listenOnce=Ae.prototype.L,Ae.prototype.getLastError=Ae.prototype.Ka,Ae.prototype.getLastErrorCode=Ae.prototype.Ba,Ae.prototype.getStatus=Ae.prototype.Z,Ae.prototype.getResponseJson=Ae.prototype.Oa,Ae.prototype.getResponseText=Ae.prototype.oa,Ae.prototype.send=Ae.prototype.ea,Ae.prototype.setWithCredentials=Ae.prototype.Ha,pf=dn.XhrIo=Ae}).apply(typeof Wl<"u"?Wl:typeof self<"u"?self:typeof window<"u"?window:{});var Xw="@firebase/firestore";var Me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Me.UNAUTHENTICATED=new Me(null),Me.GOOGLE_CREDENTIALS=new Me("google-credentials-uid"),Me.FIRST_PARTY=new Me("first-party-uid"),Me.MOCK_USER=new Me("mock-user");var as="10.14.0";var Zn=new Dn("@firebase/firestore");function Oi(){return Zn.logLevel}function tT(n){Zn.setLogLevel(n)}function V(n,...e){if(Zn.logLevel<=Tt.DEBUG){let t=e.map(Im);Zn.debug(`Firestore (${as}): ${n}`,...t)}}function Re(n,...e){if(Zn.logLevel<=Tt.ERROR){let t=e.map(Im);Zn.error(`Firestore (${as}): ${n}`,...t)}}function Vt(n,...e){if(Zn.logLevel<=Tt.WARN){let t=e.map(Im);Zn.warn(`Firestore (${as}): ${n}`,...t)}}function Im(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${as}) INTERNAL ASSERTION FAILED: `+n;throw Re(e),new Error(e)}function G(n,e){n||B()}function nT(n,e){n||B()}function L(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends Z_{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Be=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var rc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Af=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Me.UNAUTHENTICATED))}shutdown(){}},Sf=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Cf=class{constructor(e){this.t=e,this.currentUser=Me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let r=this.i,i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),s=new Be;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Be,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>x(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Be)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(G(typeof r.accessToken=="string"),new rc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Me(e)}},bf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Me.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Rf=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new bf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Me.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Pf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},xf=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){G(this.o===void 0);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new Pf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function rR(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var ic=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=rR(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function Q(n,e){return n<e?-1:n>e?1:0}function zi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function rT(n){return n+"\0"}var Te=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var z=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Te(0,0))}static max(){return new n(new Te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var sc=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(),r===void 0?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends sc{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},iR=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pe=class n extends sc{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return iR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new D(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new D(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Ki=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function kf(n){return n.fields.find(e=>e.kind===2)}function kr(n){return n.fields.filter(e=>e.kind!==2)}Ki.UNKNOWN_ID=-1;var qi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ko=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,bt.min())}};function iT(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new Te(t+1,0):new Te(t,r));return new bt(i,U.empty(),e)}function sT(n){return new bt(n.readTime,n.key,-1)}var bt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),U.empty(),-1)}static max(){return new n(z.max(),U.empty(),-1)}};function Am(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}var oT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",oc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function cr(n){return x(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==oT)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var ac=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Be,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Fr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Sm(r.target.error);this.V.reject(new Fr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Fr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Df(t)}},er=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(qs())===12.2&&Re("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),Nr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Wa())return!1;if(n.v())return!0;let e=qs(),t=n.S(e),r=0<t&&t<10,i=aT(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return x(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Fr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new D(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new D(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Fr(e,o))},i.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return x(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=ac.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),b.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function aT(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Nf=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Nr(this.B.delete())}},Fr=class extends D{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ur(n){return n.name==="IndexedDbTransactionError"}var Df=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Nr(r)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),Nr(this.store.add(e))}get(e){return Nr(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),Nr(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),Nr(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new b((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new b((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new b((r,i)=>{t.onerror=s=>{let o=Sm(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new b((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new Nf(a),u=t(a.primaryKey,a.value,c);if(u instanceof b){let d=u.catch(p=>(c.done(),b.reject(p)));r.push(d)}c.isDone?i():c.K===null?a.continue():a.continue(c.K)}}).next(()=>b.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Nr(n){return new b((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Sm(r.target.error);t(i)}})}var Zw=!1;function Sm(n){let e=er.S(qs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Zw||(Zw=!0,setTimeout(()=>{throw r},0)),r}}return n}var Vf=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>x(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){ur(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield cr(t)}yield this.X(6e4)}))}},Of=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return x(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(V("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=sT(s);Am(o,r)>0&&(r=o)}),new bt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var vt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function da(n){return n==null}function Wo(n){return n===0&&1/n==-1/0}function lT(n){return typeof n=="number"&&Number.isInteger(n)&&!Wo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function lt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=eE(e)),e=sR(n.get(t),e);return eE(e)}function sR(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function eE(n){return n+""}function $t(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===""&&n.charAt(1)===""),se.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&B(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;i.length===0?c=a:(i+=a,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:B()}s=o+2}return new se(r)}var tE=["userId","batchId"];function Xl(n,e){return[n,lt(e)]}function cT(n,e,t){return[n,lt(e),t]}var oR={},aR=["prefixPath","collectionGroup","readTime","documentId"],lR=["prefixPath","collectionGroup","documentId"],cR=["collectionGroup","readTime","prefixPath","documentId"],uR=["canonicalId","targetId"],hR=["targetId","path"],dR=["path","targetId"],fR=["collectionId","parent"],pR=["indexId","uid"],mR=["uid","sequenceNumber"],gR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],_R=["indexId","uid","orderedDocumentKey"],yR=["userId","collectionPath","documentId"],vR=["userId","collectionPath","largestBatchId"],wR=["userId","collectionGroup","largestBatchId"],uT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ER=[...uT,"documentOverlays"],hT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],dT=hT,Cm=[...dT,"indexConfiguration","indexState","indexEntries"],TR=Cm,IR=[...Cm,"globals"];var $o=class extends oc{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function qe(n,e){let t=L(n);return er.F(t._e,e)}function nE(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Hr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function fT(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||Ht.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ht.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bi(this.root,e,this.comparator,!0)}},Bi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ht=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}};Ht.EMPTY=null,Ht.RED=!0,Ht.BLACK=!1;Ht.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var fe=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new lc(this.data.getIterator())}getIteratorFrom(e){return new lc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},lc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function ki(n){return n.hasNext()?n.getNext():void 0}var wt=class n{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new n([])}unionWith(e){let t=new fe(Pe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var cc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function pT(){return typeof atob<"u"}var ke=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new cc("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ke.EMPTY_BYTE_STRING=new ke("");var AR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mn(n){if(G(!!n),typeof n=="string"){let e=0,t=AR.exec(n);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ve(n.seconds),nanos:ve(n.nanos)}}function ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function tr(n){return typeof n=="string"?ke.fromBase64String(n):ke.fromUint8Array(n)}function eu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function bm(n){let e=n.mapValue.fields.__previous_value__;return eu(e)?bm(e):e}function Qo(n){let e=mn(n.mapValue.fields.__local_write_time__.timestampValue);return new Te(e.seconds,e.nanos)}var Mf=class{constructor(e,t,r,i,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},nr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Jn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Zl={nullValue:"NULL_VALUE"};function Lr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?eu(n)?4:mT(n)?9007199254740991:tu(n)?10:11:B()}function Xt(n,e){if(n===e)return!0;let t=Lr(n);if(t!==Lr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qo(n).isEqual(Qo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=mn(i.timestampValue),a=mn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return tr(i.bytesValue).isEqual(tr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ve(i.geoPointValue.latitude)===ve(s.geoPointValue.latitude)&&ve(i.geoPointValue.longitude)===ve(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ve(i.integerValue)===ve(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ve(i.doubleValue),a=ve(s.doubleValue);return o===a?Wo(o)===Wo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return zi(n.arrayValue.values||[],e.arrayValue.values||[],Xt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(nE(o)!==nE(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Xt(o[c],a[c])))return!1;return!0}(n,e);default:return B()}}function Ho(n,e){return(n.values||[]).find(t=>Xt(t,e))!==void 0}function rr(n,e){if(n===e)return 0;let t=Lr(n),r=Lr(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ve(s.integerValue||s.doubleValue),c=ve(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return rE(n.timestampValue,e.timestampValue);case 4:return rE(Qo(n),Qo(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){let a=tr(s),c=tr(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=Q(a[u],c[u]);if(d!==0)return d}return Q(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=Q(ve(s.latitude),ve(o.latitude));return a!==0?a:Q(ve(s.longitude),ve(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return iE(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,u,d;let p=s.fields||{},m=o.fields||{},y=(a=p.value)===null||a===void 0?void 0:a.arrayValue,S=(c=m.value)===null||c===void 0?void 0:c.arrayValue,k=Q(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=S?.values)===null||d===void 0?void 0:d.length)||0);return k!==0?k:iE(y,S)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Jn.mapValue&&o===Jn.mapValue)return 0;if(s===Jn.mapValue)return 1;if(o===Jn.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){let m=Q(c[p],d[p]);if(m!==0)return m;let y=rr(a[c[p]],u[d[p]]);if(y!==0)return y}return Q(c.length,d.length)}(n.mapValue,e.mapValue);default:throw B()}}function rE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=mn(n),r=mn(e),i=Q(t.seconds,r.seconds);return i!==0?i:Q(t.nanos,r.nanos)}function iE(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=rr(t[i],r[i]);if(s)return s}return Q(t.length,r.length)}function Wi(n){return Ff(n)}function Ff(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=mn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return tr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Ff(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Ff(t.fields[o])}`;return i+"}"}(n.mapValue):B()}function Ur(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Lf(n){return!!n&&"integerValue"in n}function Yo(n){return!!n&&"arrayValue"in n}function sE(n){return!!n&&"nullValue"in n}function oE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ec(n){return!!n&&"mapValue"in n}function tu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Bo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Hr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Bo(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Bo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function mT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var gT={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function SR(n){return"nullValue"in n?Zl:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ur(nr.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?tu(n)?gT:{mapValue:{}}:B()}function CR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ur(nr.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?gT:"mapValue"in n?tu(n)?{mapValue:{}}:Jn:B()}function aE(n,e){let t=rr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function lE(n,e){let t=rr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var tt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ec(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Bo(t)}setAll(e){let t=Pe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Bo(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ec(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ec(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Hr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Bo(this.value))}};function _T(n){let e=[];return Hr(n.fields,(t,r)=>{let i=new Pe([t]);if(ec(r)){let s=_T(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new wt(e)}var Fe=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),tt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Zt=class{constructor(e,t){this.position=e,this.inclusive=t}};function cE(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=U.comparator(U.fromName(o.referenceValue),t.key):r=rr(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function uE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xt(n.position[t],e.position[t]))return!1;return!0}var Br=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function bR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var uc=class{},re=class n extends uc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new qf(e,t,r):t==="array-contains"?new zf(e,r):t==="in"?new hc(e,r):t==="not-in"?new Kf(e,r):t==="array-contains-any"?new Wf(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new jf(e,r):new Gf(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(rr(t,this.value)):t!==null&&Lr(this.value)===Lr(t)&&this.matchesComparison(rr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends uc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return $i(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function $i(n){return n.op==="and"}function Uf(n){return n.op==="or"}function Rm(n){return yT(n)&&$i(n)}function yT(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function Bf(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+Wi(n.value);if(Rm(n))return n.filters.map(e=>Bf(e)).join(",");{let e=n.filters.map(t=>Bf(t)).join(",");return`${n.op}(${e})`}}function vT(n,e){return n instanceof re?function(r,i){return i instanceof re&&r.op===i.op&&r.field.isEqual(i.field)&&Xt(r.value,i.value)}(n,e):n instanceof ue?function(r,i){return i instanceof ue&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&vT(o,i.filters[a]),!0):!1}(n,e):void B()}function wT(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function ET(n){return n instanceof re?function(t){return`${t.field.canonicalString()} ${t.op} ${Wi(t.value)}`}(n):n instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(ET).join(" ,")+"}"}(n):"Filter"}var qf=class extends re{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},jf=class extends re{constructor(e,t){super(e,"in",t),this.keys=TT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Gf=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=TT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function TT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var zf=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Yo(t)&&Ho(t.arrayValue,this.value)}},hc=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ho(this.value.arrayValue,t)}},Kf=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ho(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ho(this.value.arrayValue,t)}},Wf=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Yo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ho(this.value.arrayValue,r))}};var $f=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function Qf(n,e=null,t=[],r=[],i=null,s=null,o=null){return new $f(n,e,t,r,i,s,o)}function qr(n){let e=L(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Bf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),da(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Wi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Wi(r)).join(",")),e.ue=t}return e.ue}function fa(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!bR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!vT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!uE(n.startAt,e.startAt)&&uE(n.endAt,e.endAt)}function dc(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function fc(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function hE(n,e,t){let r=Zl,i=!0;for(let s of fc(n,e)){let o=Zl,a=!0;switch(s.op){case"<":case"<=":o=SR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Zl}aE({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];aE({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function dE(n,e,t){let r=Jn,i=!0;for(let s of fc(n,e)){let o=Jn,a=!0;switch(s.op){case">=":case">":o=CR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Jn}lE({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];lE({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Ot=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function IT(n,e,t,r,i,s,o,a){return new Ot(n,e,t,r,i,s,o,a)}function ls(n){return new Ot(n)}function fE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Pm(n){return n.collectionGroup!==null}function ji(n){let e=L(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new fe(Pe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Br(s,r))}),t.has(Pe.keyField().canonicalString())||e.ce.push(new Br(Pe.keyField(),r))}return e.ce}function ct(n){let e=L(n);return e.le||(e.le=RR(e,ji(n))),e.le}function RR(n,e){if(n.limitType==="F")return Qf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Br(i.field,s)});let t=n.endAt?new Zt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zt(n.startAt.position,n.startAt.inclusive):null;return Qf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Hf(n,e){let t=n.filters.concat([e]);return new Ot(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function pc(n,e,t){return new Ot(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function pa(n,e){return fa(ct(n),ct(e))&&n.limitType===e.limitType}function AT(n){return`${qr(ct(n))}|lt:${n.limitType}`}function Mi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>ET(i)).join(", ")}]`),da(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Wi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Wi(i)).join(",")),`Target(${r})`}(ct(n))}; limitType=${n.limitType})`}function ma(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):U.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of ji(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=cE(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,ji(r),i)||r.endAt&&!function(o,a,c){let u=cE(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,ji(r),i))}(n,e)}function ST(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function CT(n){return(e,t)=>{let r=!1;for(let i of ji(n)){let s=PR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function PR(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?rr(c,u):B()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}var en=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Hr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return fT(this.inner)}size(){return this.innerSize}};var xR=new _e(U.comparator);function dt(){return xR}var bT=new _e(U.comparator);function Lo(...n){let e=bT;for(let t of n)e=e.insert(t.key,t);return e}function RT(n){let e=bT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Qt(){return qo()}function PT(){return qo()}function qo(){return new en(n=>n.toString(),(n,e)=>n.isEqual(e))}var kR=new _e(U.comparator),NR=new fe(U.comparator);function X(...n){let e=NR;for(let t of n)e=e.add(t);return e}var DR=new fe(Q);function xm(){return DR}function km(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wo(e)?"-0":e}}function xT(n){return{integerValue:""+n}}function kT(n,e){return lT(e)?xT(e):km(n,e)}var Qi=class{constructor(){this._=void 0}};function VR(n,e,t){return n instanceof ir?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&eu(s)&&(s=bm(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof gn?DT(n,e):n instanceof _n?VT(n,e):function(i,s){let o=NT(i,s),a=pE(o)+pE(i.Pe);return Lf(o)&&Lf(i.Pe)?xT(a):km(i.serializer,a)}(n,e)}function OR(n,e,t){return n instanceof gn?DT(n,e):n instanceof _n?VT(n,e):t}function NT(n,e){return n instanceof sr?function(r){return Lf(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var ir=class extends Qi{},gn=class extends Qi{constructor(e){super(),this.elements=e}};function DT(n,e){let t=OT(e);for(let r of n.elements)t.some(i=>Xt(i,r))||t.push(r);return{arrayValue:{values:t}}}var _n=class extends Qi{constructor(e){super(),this.elements=e}};function VT(n,e){let t=OT(e);for(let r of n.elements)t=t.filter(i=>!Xt(i,r));return{arrayValue:{values:t}}}var sr=class extends Qi{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function pE(n){return ve(n.integerValue||n.doubleValue)}function OT(n){return Yo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var jr=class{constructor(e,t){this.field=e,this.transform=t}};function MR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof gn&&i instanceof gn||r instanceof _n&&i instanceof _n?zi(r.elements,i.elements,Xt):r instanceof sr&&i instanceof sr?Xt(r.Pe,i.Pe):r instanceof ir&&i instanceof ir}(n.transform,e.transform)}var Yf=class{constructor(e,t){this.version=e,this.transformResults=t}},Ce=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function tc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Hi=class{};function MT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ar(n.key,Ce.none()):new or(n.key,n.data,Ce.none());{let t=n.data,r=tt.empty(),i=new fe(Pe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Mt(n.key,r,new wt(i.toArray()),Ce.none())}}function FR(n,e,t){n instanceof or?function(i,s,o){let a=i.value.clone(),c=gE(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Mt?function(i,s,o){if(!tc(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=gE(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(FT(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function jo(n,e,t,r){return n instanceof or?function(s,o,a,c){if(!tc(s.precondition,o))return a;let u=s.value.clone(),d=_E(s.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Mt?function(s,o,a,c){if(!tc(s.precondition,o))return a;let u=_E(s.fieldTransforms,c,o),d=o.data;return d.setAll(FT(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,r):function(s,o,a){return tc(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function LR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=NT(r.transform,i||null);s!=null&&(t===null&&(t=tt.empty()),t.set(r.field,s))}return t||null}function mE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&zi(r,i,(s,o)=>MR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var or=class extends Hi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Mt=class extends Hi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function FT(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function gE(n,e,t){let r=new Map;G(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,OR(o,a,t[i]))}return r}function _E(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,VR(s,o,e))}return r}var ar=class extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Jo=class extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Xo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&FR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=jo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=jo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=PT();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let c=MT(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&zi(this.mutations,e.mutations,(t,r)=>mE(t,r))&&zi(this.baseMutations,e.baseMutations,(t,r)=>mE(t,r))}},Jf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){G(e.mutations.length===r.length);let i=function(){return kR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Zo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Xf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ve,ie;function LT(n){switch(n){default:return B();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function UT(n){if(n===void 0)return Re("GRPC error has no .code"),P.UNKNOWN;switch(n){case Ve.OK:return P.OK;case Ve.CANCELLED:return P.CANCELLED;case Ve.UNKNOWN:return P.UNKNOWN;case Ve.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ve.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ve.INTERNAL:return P.INTERNAL;case Ve.UNAVAILABLE:return P.UNAVAILABLE;case Ve.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ve.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ve.NOT_FOUND:return P.NOT_FOUND;case Ve.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ve.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ve.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ve.ABORTED:return P.ABORTED;case Ve.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ve.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ve.DATA_LOSS:return P.DATA_LOSS;default:return B()}}(ie=Ve||(Ve={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";var yE=null;function BT(){return new TextEncoder}var UR=new Wn([4294967295,4294967295],0);function vE(n){let e=BT().encode(n),t=new ff;return t.update(e),new Uint8Array(t.digest())}function wE(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Wn([t,r],0),new Wn([i,s],0)]}var Zf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Mr(`Invalid padding: ${t}`);if(r<0)throw new Mr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Mr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Mr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Wn.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Wn.fromNumber(r)));return i.compare(UR)===1&&(i=new Wn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=vE(e),[r,i]=wE(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=vE(e),[r,i]=wE(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Mr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ea=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ta.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new _e(Q),dt(),X())}},ta=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,X(),X(),X())}};var Gi=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},mc=class{constructor(e,t){this.targetId=e,this.me=t}},gc=class{constructor(e,t,r=ke.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},_c=class{constructor(){this.fe=0,this.ge=TE(),this.pe=ke.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),r=X();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new ta(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=TE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},ep=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=dt(),this.qe=EE(),this.Qe=new _e(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(dc(s))if(r===0){let o=new U(s.path);this.Ue(t,o,Fe.newNoDocument(o,z.min()))}else G(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}yE?.et(function(d,p,m,y,S){var k,N,q,j,M,K;let H={localCacheCount:d,existenceFilterCount:p.count,databaseId:m.database,projectId:m.projectId},Y=p.unchangedNames;return Y&&(H.bloomFilter={applied:S===0,hashCount:(k=Y?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=(q=(N=Y?.bits)===null||N===void 0?void 0:N.bitmap)===null||q===void 0?void 0:q.length)!==null&&j!==void 0?j:0,padding:(K=(M=Y?.bits)===null||M===void 0?void 0:M.padding)!==null&&K!==void 0?K:0,mightContain:E=>{var _;return(_=y?.mightContain(E))!==null&&_!==void 0&&_}}),H}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=tr(r).toUint8Array()}catch(c){if(c instanceof cc)return Vt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Zf(o,i,s)}catch(c){return Vt(c instanceof Mr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&dc(a.target)){let c=new U(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Fe.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=X();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new ea(e,t,this.Qe,this.ke,r);return this.ke=dt(),this.qe=EE(),this.Qe=new _e(Q),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new _c,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new fe(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new _c),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function EE(){return new _e(U.comparator)}function TE(){return new _e(U.comparator)}var BR={asc:"ASCENDING",desc:"DESCENDING"},qR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jR={and:"AND",or:"OR"},tp=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function np(n,e){return n.useProto3Json||da(e)?e:{value:e}}function Yi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function GR(n,e){return Yi(n,e.toTimestamp())}function xe(n){return G(!!n),z.fromTimestamp(function(t){let r=mn(t);return new Te(r.seconds,r.nanos)}(n))}function Nm(n,e){return rp(n,e).canonicalString()}function rp(n,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function jT(n){let e=se.fromString(n);return G(XT(e)),e}function na(n,e){return Nm(n.databaseId,e.path)}function Yt(n,e){let t=jT(e);if(t.get(1)!==n.databaseId.projectId)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(KT(t))}function GT(n,e){return Nm(n.databaseId,e)}function zT(n){let e=jT(n);return e.length===4?se.emptyPath():KT(e)}function ip(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function KT(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function IE(n,e,t){return{name:na(n,e),fields:t.value.mapValue.fields}}function WT(n,e,t){let r=Yt(n,e.name),i=xe(e.updateTime),s=e.createTime?xe(e.createTime):z.min(),o=new tt({mapValue:{fields:e.fields}}),a=Fe.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function zR(n,e){return"found"in e?function(r,i){G(!!i.found),i.found.name,i.found.updateTime;let s=Yt(r,i.found.name),o=xe(i.found.updateTime),a=i.found.createTime?xe(i.found.createTime):z.min(),c=new tt({mapValue:{fields:i.found.fields}});return Fe.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(r,i){G(!!i.missing),G(!!i.readTime);let s=Yt(r,i.missing),o=xe(i.readTime);return Fe.newNoDocument(s,o)}(n,e):B()}function KR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:B()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?(G(d===void 0||typeof d=="string"),ke.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),ke.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?P.UNKNOWN:UT(u.code);return new D(d,u.message||"")}(o);t=new gc(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Yt(n,r.document.name),s=xe(r.document.updateTime),o=r.document.createTime?xe(r.document.createTime):z.min(),a=new tt({mapValue:{fields:r.document.fields}}),c=Fe.newFoundDocument(i,s,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];t=new Gi(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Yt(n,r.document),s=r.readTime?xe(r.readTime):z.min(),o=Fe.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Gi([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Yt(n,r.document),s=r.removedTargetIds||[];t=new Gi([],s,i,null)}else{if(!("filter"in e))return B();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Xf(i,s),a=r.targetId;t=new mc(a,o)}}return t}function ra(n,e){let t;if(e instanceof or)t={update:IE(n,e.key,e.value)};else if(e instanceof ar)t={delete:na(n,e.key)};else if(e instanceof Mt)t={update:IE(n,e.key,e.data),updateMask:JR(e.fieldMask)};else{if(!(e instanceof Jo))return B();t={verify:na(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof ir)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof gn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof _n)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof sr)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw B()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:GR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B()}(n,e.precondition)),t}function sp(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Ce.updateTime(xe(s.updateTime)):s.exists!==void 0?Ce.exists(s.exists):Ce.none()}(e.currentDocument):Ce.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let c=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),c=new ir;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new gn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new _n(d)}else"increment"in a?c=new sr(o,a.increment):B();let u=Pe.fromServerFormat(a.fieldPath);return new jr(u,c)}(n,i)):[];if(e.update){e.update.name;let i=Yt(n,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new wt(u.map(d=>Pe.fromServerFormat(d)))}(e.updateMask);return new Mt(i,s,o,t,r)}return new or(i,s,t,r)}if(e.delete){let i=Yt(n,e.delete);return new ar(i,t)}if(e.verify){let i=Yt(n,e.verify);return new Jo(i,t)}return B()}function WR(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?xe(i.updateTime):xe(s);return o.isEqual(z.min())&&(o=xe(s)),new Yf(o,i.transformResults||[])}(t,e))):[]}function $T(n,e){return{documents:[GT(n,e.path)]}}function QT(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=GT(n,i);let s=function(u){if(u.length!==0)return JT(ue.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:Fi(m.field),direction:QR(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=np(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:i}}function HT(n){let e=zT(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){G(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(p){let m=YT(p);return m instanceof ue&&Rm(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(S){return new Br(Li(S.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,da(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(p){let m=!!p.before,y=p.values||[];return new Zt(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(p){let m=!p.before,y=p.values||[];return new Zt(y,m)}(t.endAt)),IT(e,i,o,s,a,"F",c,u)}function $R(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function YT(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Li(t.unaryFilter.field);return re.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Li(t.unaryFilter.field);return re.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Li(t.unaryFilter.field);return re.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Li(t.unaryFilter.field);return re.create(o,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):n.fieldFilter!==void 0?function(t){return re.create(Li(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ue.create(t.compositeFilter.filters.map(r=>YT(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B()}function QR(n){return BR[n]}function HR(n){return qR[n]}function YR(n){return jR[n]}function Fi(n){return{fieldPath:n.canonicalString()}}function Li(n){return Pe.fromServerFormat(n.fieldPath)}function JT(n){return n instanceof re?function(t){if(t.op==="=="){if(oE(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NAN"}};if(sE(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(oE(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NAN"}};if(sE(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fi(t.field),op:HR(t.op),value:t.value}}}(n):n instanceof ue?function(t){let r=t.getFilters().map(i=>JT(i));return r.length===1?r[0]:{compositeFilter:{op:YR(t.op),filters:r}}}(n):B()}function JR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function XT(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ji=class n{constructor(e,t,r,i,s=z.min(),o=z.min(),a=ke.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var yc=class{constructor(e){this.ct=e}};function XR(n,e){let t;if(e.document)t=WT(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=zr(e.noDocument.readTime);t=Fe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{let r=U.fromSegments(e.unknownDocument.path),i=zr(e.unknownDocument.version);t=Fe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Te(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}function AE(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:vc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:na(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Yi(s,o.version.toTimestamp()),createTime:Yi(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Gr(e.version)};else{if(!e.isUnknownDocument())return B();r.unknownDocument={path:t.path.toArray(),version:Gr(e.version)}}return r}function vc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Gr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zr(n){let e=new Te(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function Dr(n,e){let t=(e.baseMutations||[]).map(s=>sp(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>sp(n.ct,s)),i=Te.fromMillis(e.localWriteTimeMs);return new Xo(e.batchId,i,t,r)}function Uo(n){let e=zr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?zr(n.lastLimboFreeSnapshotVersion):z.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),ct(ls(zT(s.documents[0])))}(n.query):function(s){return ct(HT(s))}(n.query),new Ji(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ke.fromBase64String(n.resumeToken))}function ZT(n,e){let t=Gr(e.snapshotVersion),r=Gr(e.lastLimboFreeSnapshotVersion),i;i=dc(e.target)?$T(n.ct,e.target):QT(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:qr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Dm(n){let e=HT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?pc(e,e.limit,"L"):e}function vf(n,e){return new Zo(e.largestBatchId,sp(n.ct,e.overlayMutation))}function SE(n,e){let t=e.path.lastSegment();return[n,lt(e.path.popLast()),t]}function CE(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Gr(r.readTime),documentKey:lt(r.documentKey.path),largestBatchId:r.largestBatchId}}var op=class{getBundleMetadata(e,t){return bE(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:zr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return bE(e).put(function(i){return{bundleId:i.id,createTime:Gr(xe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return RE(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Dm(s.bundledQuery),readTime:zr(s.readTime)}}(r)})}saveNamedQuery(e,t){return RE(e).put(function(i){return{name:i.name,readTime:Gr(xe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function bE(n){return qe(n,"bundles")}function RE(n){return qe(n,"namedQueries")}var wc=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Vo(e).get(SE(this.userId,t)).next(r=>r?vf(this.serializer,r):null)}getOverlays(e,t){let r=Qt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Zo(t,o);i.push(this.ht(e,a))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(lt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Vo(e).j("collectionPathOverlayIndex",a))}),b.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Qt(),s=lt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Vo(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=vf(this.serializer,c);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Qt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Vo(e).J({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{let p=vf(this.serializer,u);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return Vo(e).put(function(i,s,o){let[a,c,u]=SE(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ra(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Vo(n){return qe(n,"documentOverlays")}var ap=class{Pt(e){return qe(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?ke.fromUint8Array(r):ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var fn=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ve(e.integerValue));else if("doubleValue"in e){let r=ve(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Wo(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=mn(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(tr(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?mT(e)?this.dt(t,Number.MAX_SAFE_INTEGER):tu(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(ve(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};fn.vt=new fn;function ZR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function PE(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=ZR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var lp=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=PE(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=PE(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},cp=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},up=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Vr=class{constructor(){this.jt=new lp,this.Ht=new cp(this.jt),this.Jt=new up(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Or=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function $n(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=xE(n.arrayValue,e.arrayValue),t!==0?t:(t=xE(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function xE(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Ec=class{constructor(e){this.Xt=new fe((t,r)=>Pe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=kf(e);if(t!==void 0&&!this.sn(t))return!1;let r=kr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let c=r[s];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new fe(Pe.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new qi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new qi(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new qi(r.field,r.dir==="asc"?0:1)));return new Ki(Ki.UNKNOWN_ID,this.collectionId,t,Ko.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function eI(n){var e,t;if(G(n instanceof re||n instanceof ue),n instanceof re){if(n instanceof hc){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return ue.create(i,"or")}return n}let r=n.filters.map(i=>eI(i));return ue.create(r,n.op)}function eP(n){if(n.getFilters().length===0)return[];let e=fp(eI(n));return G(tI(e)),hp(e)||dp(e)?[e]:e.getFilters()}function hp(n){return n instanceof re}function dp(n){return n instanceof ue&&Rm(n)}function tI(n){return hp(n)||dp(n)||function(t){if(t instanceof ue&&Uf(t)){for(let r of t.getFilters())if(!hp(r)&&!dp(r))return!1;return!0}return!1}(n)}function fp(n){if(G(n instanceof re||n instanceof ue),n instanceof re)return n;if(n.filters.length===1)return fp(n.filters[0]);let e=n.filters.map(r=>fp(r)),t=ue.create(e,n.op);return t=Tc(t),tI(t)?t:(G(t instanceof ue),G($i(t)),G(t.filters.length>1),t.filters.reduce((r,i)=>Vm(r,i)))}function Vm(n,e){let t;return G(n instanceof re||n instanceof ue),G(e instanceof re||e instanceof ue),t=n instanceof re?e instanceof re?function(i,s){return ue.create([i,s],"and")}(n,e):kE(n,e):e instanceof re?kE(e,n):function(i,s){if(G(i.filters.length>0&&s.filters.length>0),$i(i)&&$i(s))return wT(i,s.getFilters());let o=Uf(i)?i:s,a=Uf(i)?s:i,c=o.filters.map(u=>Vm(u,a));return ue.create(c,"or")}(n,e),Tc(t)}function kE(n,e){if($i(e))return wT(e,n.getFilters());{let t=e.filters.map(r=>Vm(n,r));return ue.create(t,"or")}}function Tc(n){if(G(n instanceof re||n instanceof ue),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return Tc(e[0]);if(yT(n))return n;let t=e.map(i=>Tc(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof ue&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ue.create(r,n.op)}var pp=class{constructor(){this.un=new ia}addToCollectionParentIndex(e,t){return this.un.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(bt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(bt.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},ia=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fe(se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fe(se.comparator)).toArray()}};var Ql=new Uint8Array(0),mp=class{constructor(e,t){this.databaseId=t,this.cn=new ia,this.ln=new en(r=>qr(r),(r,i)=>fa(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:lt(i)};return NE(e).put(s)}return b.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[rT(t),""],!1,!0);return NE(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push($t(o.parent))}return r})}addFieldIndex(e,t){let r=Oo(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Di(e);return s.next(a=>{o.put(CE(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Oo(e),i=Di(e),s=Ni(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Oo(e),r=Ni(e),i=Di(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return b.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Ec(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Ni(e),i=!0,s=new Map;return b.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=X(),a=[];return b.forEach(s,(c,u)=>{V("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`}(c)} to execute ${qr(t)}`);let d=function(M,K){let H=kf(K);if(H===void 0)return null;for(let Y of fc(M,H.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(u,c),p=function(M,K){let H=new Map;for(let Y of kr(K))for(let E of fc(M,Y.fieldPath))switch(E.op){case"==":case"in":H.set(Y.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return H.set(Y.fieldPath.canonicalString(),E.value),Array.from(H.values())}return null}(u,c),m=function(M,K){let H=[],Y=!0;for(let E of kr(K)){let _=E.kind===0?hE(M,E.fieldPath,M.startAt):dE(M,E.fieldPath,M.startAt);H.push(_.value),Y&&(Y=_.inclusive)}return new Zt(H,Y)}(u,c),y=function(M,K){let H=[],Y=!0;for(let E of kr(K)){let _=E.kind===0?dE(M,E.fieldPath,M.endAt):hE(M,E.fieldPath,M.endAt);H.push(_.value),Y&&(Y=_.inclusive)}return new Zt(H,Y)}(u,c),S=this.In(c,u,m),k=this.In(c,u,y),N=this.Tn(c,u,p),q=this.En(c.indexId,d,S,m.inclusive,k,y.inclusive,N);return b.forEach(q,j=>r.G(j,t.limit).next(M=>{M.forEach(K=>{let H=U.fromSegments(K.documentKey);o.has(H)||(o=o.add(H),a.push(H))})}))}).next(()=>a)}return b.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=eP(ue.create(e.filters,"and")).map(r=>Qf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,a){let c=(t!=null?t.length:1)*Math.max(r.length,s.length),u=c/(t!=null?t.length:1),d=[];for(let p=0;p<c;++p){let m=t?this.dn(t[p/u]):Ql,y=this.An(e,m,r[p%u],i),S=this.Rn(e,m,s[p%u],o),k=a.map(N=>this.An(e,m,N,!0));d.push(...this.createRange(y,S,k))}return d}An(e,t,r,i){let s=new Or(e,U.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new Or(e,U.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new Ec(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return b.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new fe(Pe.comparator),d=!1;for(let p of c.filters)for(let m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:u=u.add(m.field));for(let p of c.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new Vr;for(let i of kr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);fn.vt.It(s,o)}return r.zt()}dn(e){let t=new Vr;return fn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new Vr;return fn.vt.It(Ur(this.databaseId,t),r.Yt(function(s){let o=kr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new Vr);let s=0;for(let o of kr(e)){let a=r[s++];for(let c of i)if(this.fn(t,o.fieldPath)&&Yo(a))i=this.gn(i,o,a);else{let u=c.Yt(o.kind);fn.vt.It(a,u)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let c=new Vr;c.seed(a.zt()),fn.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Oo(e),i=Di(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return b.forEach(s,a=>i.get([a.indexId,this.uid]).next(c=>{o.push(function(d,p){let m=p?new Ko(p.sequenceNumber,new bt(zr(p.readTime),new U($t(p.documentKey)),p.largestBatchId)):Ko.empty(),y=d.fields.map(([S,k])=>new qi(Pe.fromServerFormat(S),k));return new Ki(d.indexId,d.collectionGroup,y,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Q(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Oo(e),s=Di(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,c=>s.put(CE(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return b.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),b.forEach(a,c=>this.wn(e,i,c).next(u=>{let d=this.Sn(s,c);return u.isEqual(d)?b.resolve():this.bn(e,s,c,u,d)}))))})}Dn(e,t,r,i){return Ni(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return Ni(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=Ni(e),s=new fe($n);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{s=s.add(new Or(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let r=new fe($n),i=this.Vn(t,e);if(i==null)return r;let s=kf(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Yo(o))for(let a of o.arrayValue.values||[])r=r.add(new Or(t.indexId,e.key,this.dn(a),i))}else r=r.add(new Or(t.indexId,e.key,Ql,i));return r}bn(e,t,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,p,m){let y=c.getIterator(),S=u.getIterator(),k=ki(y),N=ki(S);for(;k||N;){let q=!1,j=!1;if(k&&N){let M=d(k,N);M<0?j=!0:M>0&&(q=!0)}else k!=null?j=!0:q=!0;q?(p(N),N=ki(S)):j?(m(k),k=ki(y)):(k=ki(y),N=ki(S))}}(i,s,$n,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),b.waitFor(o)}yn(e){let t=1;return Di(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>$n(o,a)).filter((o,a,c)=>!a||$n(o,c[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=$n(o,e),c=$n(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&c<0)i.push(o),i.push(o.Zt());else if(c>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ql,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ql,[]];s.push(IDBKeyRange.bound(a,c))}return s}Cn(e,t){return $n(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(DE)}getMinOffset(e,t){return b.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||B())).next(DE)}};function NE(n){return qe(n,"collectionParents")}function Ni(n){return qe(n,"indexEntries")}function Oo(n){return qe(n,"indexConfiguration")}function Di(n){return qe(n,"indexState")}function DE(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Am(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new bt(e.readTime,e.documentKey,t)}var VE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ct=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function nI(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=r.J({range:o},(d,p,m)=>(a++,m.delete()));s.push(c.next(()=>{G(a===1)}));let u=[];for(let d of t.mutations){let p=cT(e,d.key.path,t.batchId);s.push(i.delete(p)),u.push(d.key)}return b.waitFor(s).next(()=>u)}function Ic(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B();e=n.noDocument}return JSON.stringify(e).length}Ct.DEFAULT_COLLECTION_PERCENTILE=10,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ct.DEFAULT=new Ct(41943040,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ct.DISABLED=new Ct(-1,0,0);var Ac=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Qn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Ui(e),o=Qn(e);return o.add({}).next(a=>{G(typeof a=="number");let c=new Xo(a,t,r,i),u=function(y,S,k){let N=k.baseMutations.map(j=>ra(y.ct,j)),q=k.mutations.map(j=>ra(y.ct,j));return{userId:S,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:N,mutations:q}}(this.serializer,this.userId,c),d=[],p=new fe((m,y)=>Q(m.canonicalString(),y.canonicalString()));for(let m of i){let y=cT(this.userId,m.key.path,a);p=p.add(m.key.path.popLast()),d.push(o.put(u)),d.push(s.put(y,oR))}return p.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),b.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return Qn(e).get(t).next(r=>r?(G(r.userId===this.userId),Dr(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?b.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Qn(e).J({index:"userMutationsIndex",range:i},(o,a,c)=>{a.userId===this.userId&&(G(a.batchId>=r),s=Dr(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Qn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Qn(e).U("userMutationsIndex",t).next(r=>r.map(i=>Dr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Xl(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ui(e).J({range:i},(o,a,c)=>{let[u,d,p]=o,m=$t(d);if(u===this.userId&&t.path.isEqual(m))return Qn(e).get(p).next(y=>{if(!y)throw B();G(y.userId===this.userId),s.push(Dr(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(Q),i=[];return t.forEach(s=>{let o=Xl(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Ui(e).J({range:a},(u,d,p)=>{let[m,y,S]=u,k=$t(y);m===this.userId&&s.path.isEqual(k)?r=r.add(S):p.done()});i.push(c)}),b.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Xl(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new fe(Q);return Ui(e).J({range:o},(c,u,d)=>{let[p,m,y]=c,S=$t(m);p===this.userId&&r.isPrefixOf(S)?S.length===i&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Qn(e).get(s).next(o=>{if(o===null)throw B();G(o.userId===this.userId),r.push(Dr(this.serializer,o))}))}),b.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return nI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),b.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Ui(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let c=$t(s[1]);i.push(c)}else a.done()}).next(()=>{G(i.length===0)})})}containsKey(e,t){return rI(e,this.userId,t)}Nn(e){return iI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function rI(n,e,t){let r=Xl(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Ui(n).J({range:s,H:!0},(a,c,u)=>{let[d,p,m]=a;d===e&&p===i&&(o=!0),u.done()}).next(()=>o)}function Qn(n){return qe(n,"mutations")}function Ui(n){return qe(n,"documentMutations")}function iI(n){return qe(n,"mutationQueues")}var Xi=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var gp=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new Xi(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>z.fromTimestamp(new Te(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Vi(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(G(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Vi(e).J((o,a)=>{let c=Uo(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Vi(e).J((r,i)=>{let s=Uo(i);t(s)})}qn(e){return OE(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return OE(e).put("targetGlobalKey",t)}Kn(e,t){return Vi(e).put(ZT(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=qr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Vi(e).J({range:i,index:"queryTargetsIndex"},(o,a,c)=>{let u=Uo(a);fa(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Hn(e);return t.forEach(o=>{let a=lt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),b.waitFor(i)}removeMatchingKeys(e,t,r){let i=Hn(e);return b.forEach(t,s=>{let o=lt(s.path);return b.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Hn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Hn(e),s=X();return i.J({range:r,H:!0},(o,a,c)=>{let u=$t(o[1]),d=new U(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=lt(t.path),i=IDBKeyRange.bound([r],[rT(r)],!1,!0),s=0;return Hn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}ot(e,t){return Vi(e).get(t).next(r=>r?Uo(r):null)}};function Vi(n){return qe(n,"targets")}function OE(n){return qe(n,"targetGlobal")}function Hn(n){return qe(n,"targetDocuments")}function ME([n,e],[t,r]){let i=Q(n,t);return i===0?Q(e,r):i}var _p=class{constructor(e){this.Un=e,this.buffer=new fe(ME),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();ME(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},yp=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>x(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ur(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield cr(t)}yield this.Hn(3e5)}))}},vp=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return b.resolve(vt.oe);let r=new _p(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(VE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),VE):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,a=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(u=Date.now(),Oi()<=Tt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function tP(n,e){return new vp(n,e)}var wp=class{constructor(e,t){this.db=e,this.garbageCollector=tP(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return Hl(e,r)}removeReference(e,t,r){return Hl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Hl(e,t)}nr(e,t){return function(i,s){let o=!1;return iI(i).Y(a=>rI(i,a,s).next(c=>(c&&(o=!0),b.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,z.min()),Hn(e).delete(function(p){return[0,lt(p.path)]}(o))))});i.push(c)}}).next(()=>b.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Hl(e,t)}tr(e,t){let r=Hn(e),i,s=vt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==vt.oe&&t(new U($t(i)),s),s=u,i=c):s=vt.oe}).next(()=>{s!==vt.oe&&t(new U($t(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Hl(n,e){return Hn(n).put(function(r,i){return{targetId:0,path:lt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var Sc=class{constructor(){this.changes=new en(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ep=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return xr(e).put(r)}removeEntry(e,t,r){return xr(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],vc(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Fe.newInvalidDocument(t);return xr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Mo(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Fe.newInvalidDocument(t)};return xr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Mo(t))},(i,s)=>{r={document:this.ir(t,s),size:Ic(s)}}).next(()=>r)}getEntries(e,t){let r=dt();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=dt(),i=new _e(U.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);r=r.insert(s,a),i=i.insert(s,Ic(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return b.resolve();let i=new fe(UE);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Mo(i.first()),Mo(i.last())),o=i.getIterator(),a=o.getNext();return xr(e).J({index:"documentKeyIndex",range:s},(c,u,d)=>{let p=U.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&UE(a,p)<0;)r(a,null),a=o.getNext();a&&a.isEqual(p)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?d.$(Mo(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),vc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xr(e).U(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let d=dt();for(let p of u){let m=this.ir(U.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(ma(t,m)||i.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=dt(),o=LE(t,r),a=LE(t,bt.max());return xr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let p=this.ir(U.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Tp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return FE(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return FE(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=XR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(z.min())))return r}return Fe.newInvalidDocument(e)}};function sI(n){return new Ep(n)}var Tp=class extends Sc{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new en(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new fe((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=AE(this.cr.serializer,o);i=i.add(s.path.popLast());let u=Ic(c);r+=u-a.size,t.push(this.cr.addEntry(e,s,c))}else if(r-=a.size,this.trackRemovals){let c=AE(this.cr.serializer,o.convertToNoDocument(z.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function FE(n){return qe(n,"remoteDocumentGlobal")}function xr(n){return qe(n,"remoteDocumentsV14")}function Mo(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function LE(n,e){let t=e.documentKey.path.toArray();return[n,vc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function UE(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Q(t[s],r[s]),i)return i;return i=Q(t.length,r.length),i||(i=Q(t[t.length-2],r[r.length-2]),i||Q(t[t.length-1],r[r.length-1]))}var Ip=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Cc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&jo(r.mutation,i,wt.empty(),Te.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,X()).next(()=>r))}getLocalViewOfDocuments(e,t,r=X()){let i=Qt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Lo();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Qt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,X()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=dt(),o=qo(),a=function(){return qo()}();return t.forEach((c,u)=>{let d=r.get(u.key);i.has(u.key)&&(d===void 0||d.mutation instanceof Mt)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),jo(d.mutation,u,d.mutation.getFieldMask(),Te.now())):o.set(u.key,wt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var p;return a.set(u,new Ip(d,(p=o.get(u))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let r=qo(),i=new _e((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=r.get(c)||wt.empty();d=a.applyToLocalView(u,d),r.set(c,d);let p=(i.get(a.batchId)||X()).add(c);i=i.insert(a.batchId,p)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,p=PT();d.forEach(m=>{if(!s.has(m)){let y=MT(t.get(m),r.get(m));y!==null&&p.set(m,y),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return b.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):b.resolve(Qt()),a=-1,c=s;return o.next(u=>b.forEach(u,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(d)?b.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{c=c.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,X())).next(d=>({batchId:a,changes:RT(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=Lo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Lo();return this.indexManager.getCollectionParents(e,s).next(a=>b.forEach(a,c=>{let u=function(p,m){return new Ot(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,Fe.newInvalidDocument(d)))});let a=Lo();return o.forEach((c,u)=>{let d=s.get(c);d!==void 0&&jo(d.mutation,u,wt.empty(),Te.now()),ma(t,u)&&(a=a.insert(c,u))}),a})}};var Ap=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return b.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:xe(i.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:Dm(i.bundledQuery),readTime:xe(i.readTime)}}(t)),b.resolve()}};var Sp=class{constructor(){this.overlays=new _e(U.comparator),this.Ir=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Qt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){let i=Qt(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new _e((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=Qt(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Qt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=i)););return b.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Zo(t,r));let s=this.Ir.get(t);s===void 0&&(s=X(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var Cp=class{constructor(){this.sessionToken=ke.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}};var sa=class{constructor(){this.Tr=new fe(Oe.Er),this.dr=new fe(Oe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new Oe(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Oe(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new U(new se([])),r=new Oe(t,e),i=new Oe(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new se([])),r=new Oe(t,e),i=new Oe(t,e+1),s=X();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Oe(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Oe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||U.comparator(e.key,t.key)}};var bp=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new fe(Oe.Er)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Xo(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new Oe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Oe(t,0),i=new Oe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let a=this.Dr(o.wr);s.push(a)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(Q);return t.forEach(i=>{let s=new Oe(i,0),o=new Oe(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),b.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new Oe(new U(s),0),a=new fe(Q);return this.br.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.wr)),!0)},o),b.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return b.forEach(t.mutations,i=>{let s=new Oe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new Oe(t,0),i=this.br.firstAfterOrEqual(r);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Rp=class{constructor(e){this.Mr=e,this.docs=function(){return new _e(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Fe.newInvalidDocument(t))}getEntries(e,t){let r=dt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Fe.newInvalidDocument(i))}),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=dt(),o=t.path,a=new U(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Am(sT(d),r)<=0||(i.has(d.key)||ma(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}Or(e,t){return b.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Pp(this)}getSize(e){return b.resolve(this.size)}},Pp=class extends Sc{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),b.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var xp=class{constructor(e){this.persistence=e,this.Nr=new en(t=>qr(t),fa),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Lr=0,this.Br=new sa,this.targetCount=0,this.kr=Xi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),b.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Xi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Kn(t),b.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this.Br.containsKey(t))}};var bc=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new vt(0),this.Kr=!1,this.Kr=!0,this.$r=new Cp,this.referenceDelegate=e(this),this.Ur=new xp(this),this.indexManager=new pp,this.remoteDocumentCache=function(i){return new Rp(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new yc(t),this.Gr=new Ap(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Sp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new bp(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new kp(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return b.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},kp=class extends oc{constructor(e){super(),this.currentSequenceNumber=e}},Rc=class n{constructor(e){this.persistence=e,this.Jr=new sa,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),b.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Xr,r=>{let i=U.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return b.or([()=>b.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Np=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new ac("createOrUpgrade",t);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",tE,{unique:!0}),c.createObjectStore("documentMutations")}(e),BE(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),BE(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",tE,{unique:!0});let p=u.store("mutations"),m=d.map(y=>p.put(y));return b.waitFor(m)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:yR});u.createIndex("collectionPathOverlayIndex",vR,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",wR,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:aR});u.createIndex("documentKeyIndex",lR),u.createIndex("collectionGroupIndex",cR)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:pR}).createIndex("sequenceNumberIndex",mR,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:gR}).createIndex("documentKeyIndex",_R,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Ic(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>b.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>b.forEach(a,c=>{G(c.userId===s.userId);let u=Dr(this.serializer,c);return nI(e,s.userId,u).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let c=new se(o),u=function(p){return[0,lt(p)]}(c);s.push(t.get(u).next(d=>d?b.resolve():(p=>t.put({targetId:0,path:lt(p),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:fR});let r=t.store("collectionParents"),i=new ia,s=o=>{if(i.add(o)){let a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:lt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new se(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],u)=>{let d=$t(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=Uo(i),o=ZT(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),c=function(p){return p.document?new U(se.fromString(p.document.name).popFirst(5)):p.noDocument?U.fromSegments(p.noDocument.path):p.unknownDocument?U.fromSegments(p.unknownDocument.path):B()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>b.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=sI(this.serializer),s=new bc(Rc.Zr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:X();Dr(this.serializer,c).keys().forEach(p=>d=d.add(p)),a.set(c.userId,d)}),b.forEach(a,(c,u)=>{let d=new Me(u),p=wc.lt(this.serializer,d),m=s.getIndexManager(d),y=Ac.lt(d,this.serializer,m,s.referenceDelegate);return new Cc(i,y,p,m).recalculateAndSaveOverlaysForDocumentKeys(new $o(t,vt.oe),c).next()})})}};function BE(n){n.createObjectStore("targetDocuments",{keyPath:hR}).createIndex("documentTargetsIndex",dR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",uR,{unique:!0}),n.createObjectStore("targetGlobal")}var wf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Dp=class n{constructor(e,t,r,i,s,o,a,c,u,d,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!n.D())throw new D(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new wp(this,i),this.Ai=t+"main",this.serializer=new yc(c),this.Ri=new er(this.Ai,this.hi,new Np(this.serializer)),this.$r=new ap,this.Ur=new gp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=sI(this.serializer),this.Gr=new op,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Re("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,wf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new vt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>x(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>x(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>x(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Yl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ur(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Fo(e).get("owner").next(t=>b.resolve(this.vi(t)))}Ci(e){return Yl(e).delete(this.clientId)}Fi(){return x(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=qe(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return b.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?b.resolve(!0):Fo(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,wf);return!1}}return!(!this.networkEnabled||!this.inForeground)||Yl(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return x(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new $o(e,vt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Yl(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Ac.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new mp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return wc.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?IR:c===16?TR:c===15?Cm:c===14?dT:c===13?hT:c===12?ER:c===11?uT:void B()}(this.hi),o;return this.Ri.runTransaction(e,i,s,a=>(o=new $o(a,this.Qr?this.Qr.next():vt.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw Re(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(P.FAILED_PRECONDITION,oT);return r(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Fo(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(P.FAILED_PRECONDITION,wf)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Fo(e).put("owner",t)}static D(){return er.D()}bi(e){let t=Fo(e);return t.get("owner").next(r=>this.vi(r)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Re(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;ih()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Re("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Re("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Fo(n){return qe(n,"owner")}function Yl(n){return qe(n,"clientMetadata")}function Om(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Vp=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=X(),i=X();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Op=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Pc=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ih()?8:aT(qs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Op;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Oi()<=Tt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Mi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),b.resolve()):(Oi()<=Tt.DEBUG&&V("QueryEngine","Query:",Mi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Oi()<=Tt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Mi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ct(t))):b.resolve())}Yi(e,t){if(fE(t))return b.resolve(null);let r=ct(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=pc(t,null,"F"),r=ct(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=X(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.ts(t,a);return this.ns(t,u,o,c.readTime)?this.Yi(e,pc(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,r,i){return fE(t)||i.isEqual(z.min())?b.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?b.resolve(null):(Oi()<=Tt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Mi(t)),this.rs(e,o,t,iT(i,-1)).next(a=>a))})}ts(e,t){let r=new fe(CT(e));return t.forEach((i,s)=>{ma(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Oi()<=Tt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Mi(t)),this.Ji.getDocumentsMatchingQuery(e,t,bt.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Mp=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new _e(Q),this._s=new en(s=>qr(s),fa),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cc(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function oI(n,e,t,r){return new Mp(n,e,t,r)}function aI(n,e){return x(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=X();for(let u of i){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function nP(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let p=u.batch,m=p.keys(),y=b.resolve();return m.forEach(S=>{y=y.next(()=>d.getEntry(c,S)).next(k=>{let N=u.docVersions.get(S);G(N!==null),k.version.compareTo(N)<0&&(p.applyToRemoteDocument(k,u),k.isValidDocument()&&(k.setReadTime(u.commitVersion),d.addEntry(k)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,p))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=X();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function lI(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function rP(n,e){let t=L(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((d,p)=>{let m=i.get(p);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,p)));let y=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(ke.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),i=i.insert(p,y),function(k,N,q){return k.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(m,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let c=dt(),u=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(cI(s,o,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!r.isEqual(z.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return b.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.os=i,s))}function cI(n,e,t){let r=X(),i=X();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=dt();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(z.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):V("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:i}})}function iP(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Zi(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,b.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new Ji(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function es(n,e,t){return x(this,null,function*(){let r=L(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ur(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function xc(n,e,t){let r=L(n),i=z.min(),s=X();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let p=L(c),m=p._s.get(d);return m!==void 0?b.resolve(p.os.get(m)):p.Ur.getTargetData(u,d)}(r,o,ct(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:X())).next(a=>(dI(r,ST(e),a),{documents:a,Ts:s})))}function uI(n,e){let t=L(n),r=L(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function hI(n,e){let t=L(n),r=t.us.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,iT(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(dI(t,e,i),i))}function dI(n,e,t){let r=n.us.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function sP(n,e,t,r){return x(this,null,function*(){let i=L(n),s=X(),o=dt();for(let u of t){let d=e.Es(u.metadata.name);u.document&&(s=s.add(d));let p=e.ds(u);p.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,p)}let a=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield Zi(i,function(d){return ct(ls(se.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",u=>cI(u,a,o).next(d=>(a.apply(u),d)).next(d=>i.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>i.Ur.addMatchingKeys(u,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))})}function oP(r,i){return x(this,arguments,function*(n,e,t=X()){let s=yield Zi(n,ct(Dm(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=xe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let u=s.withResumeToken(ke.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(u.targetId,u),o.Ur.updateTargetData(a,u).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function qE(n,e){return`firestore_clients_${n}_${e}`}function jE(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ef(n,e){return`firestore_targets_${n}_${e}`}var kc=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new D(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Re("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Go=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new D(r.error.code,r.error.message))),s?new n(e,r.state,i):(Re("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Nc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=xm();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=lT(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Re("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Fp=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Re("SharedClientState",`Failed to parse online state: ${e}`),null)}},oa=class{constructor(){this.activeTargetIds=xm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},zo=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new _e(Q),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=qE(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new oa),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return x(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(qE(this.persistenceKey,r));if(i){let s=Nc.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(Ef(this.persistenceKey,e));if(i){let s=Go.Rs(e,i);s&&(r=s.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ef(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Re("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>x(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=function(s){let o=vt.oe;if(s!=null)try{let a=JSON.parse(s);G(typeof a=="number"),o=a}catch(a){Re("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==vt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new kc(this.currentUser,e,t,r),s=jE(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=jE(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=Ef(this.persistenceKey,e),s=new Go(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return Nc.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return kc.Rs(new Me(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return Go.Rs(i,t)}Ls(e){return Fp.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return x(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],a=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=xm();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Dc=class{constructor(){this.so=new oa,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new oa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Lp=class{_o(e){}shutdown(){}};var Vc=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Jl=null;function Tf(){return Jl===null?Jl=function(){return 268435456+Math.round(2147483648*Math.random())}():Jl++,"0x"+Jl.toString(16)}var aP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Up=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var et="WebChannelConnection",Bp=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let a=Tf(),c=this.xo(t,r.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,c,u,i).then(d=>(V("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Vt("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",i),d})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+as}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=aP[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=Tf();return new Promise((o,a)=>{let c=new pf;c.setWithCredentials(!0),c.listenOnce(mf.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Do.NO_ERROR:let d=c.getResponseJson();V(et,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case Do.TIMEOUT:V(et,`RPC '${e}' ${s} timed out`),a(new D(P.DEADLINE_EXCEEDED,"Request time out"));break;case Do.HTTP_ERROR:let p=c.getStatus();if(V(et,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);let y=m?.error;if(y&&y.status&&y.message){let S=function(N){let q=N.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN}(y.status);a(new D(S,y.message))}else a(new D(P.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new D(P.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{V(et,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);V(et,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",u,r,15)})}Bo(e,t,r){let i=Tf(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=yf(),a=_f(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;let d=s.join("");V(et,`Creating RPC '${e}' stream ${i}: ${d}`,c);let p=o.createWebChannel(d,c),m=!1,y=!1,S=new Up({Io:N=>{y?V(et,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(m||(V(et,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),V(et,`RPC '${e}' stream ${i} sending:`,N),p.send(N))},To:()=>p.close()}),k=(N,q,j)=>{N.listen(q,M=>{try{j(M)}catch(K){setTimeout(()=>{throw K},0)}})};return k(p,xi.EventType.OPEN,()=>{y||(V(et,`RPC '${e}' stream ${i} transport opened.`),S.yo())}),k(p,xi.EventType.CLOSE,()=>{y||(y=!0,V(et,`RPC '${e}' stream ${i} transport closed`),S.So())}),k(p,xi.EventType.ERROR,N=>{y||(y=!0,Vt(et,`RPC '${e}' stream ${i} transport errored:`,N),S.So(new D(P.UNAVAILABLE,"The operation could not be completed")))}),k(p,xi.EventType.MESSAGE,N=>{var q;if(!y){let j=N.data[0];G(!!j);let M=j,K=M.error||((q=M[0])===null||q===void 0?void 0:q.error);if(K){V(et,`RPC '${e}' stream ${i} received error:`,K);let H=K.status,Y=function(w){let T=Ve[w];if(T!==void 0)return UT(T)}(H),E=K.message;Y===void 0&&(Y=P.INTERNAL,E="Unknown error status: "+H+" with message "+K.message),y=!0,S.So(new D(Y,E)),p.close()}else V(et,`RPC '${e}' stream ${i} received:`,j),S.bo(j)}}),k(a,gf.STAT_EVENT,N=>{N.stat===$l.PROXY?V(et,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===$l.NOPROXY&&V(et,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}};function fI(){return typeof window<"u"?window:null}function nc(){return typeof document<"u"?document:null}function ga(n){return new tp(n,!0)}var aa=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Oc=class{constructor(e,t,r,i,s,o,a,c){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new aa(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return x(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return x(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return x(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Re(t.toString()),Re("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new D(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>x(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},qp=class extends Oc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=KR(this.serializer,e),r=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?xe(o.readTime):z.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=ip(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=dc(c)?{documents:$T(s,c)}:{query:QT(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=qT(s,o.resumeToken);let u=np(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(z.min())>0){a.readTime=Yi(s,o.snapshotVersion.toTimestamp());let u=np(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=$R(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=ip(this.serializer),t.removeTarget=e,this.a_(t)}},jp=class extends Oc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=WR(e.writeResults,e.commitTime),r=xe(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=ip(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>ra(this.serializer,r))};this.a_(t)}};var Gp=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,rp(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(P.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,rp(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(P.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},zp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Re(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Kp=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>x(this,null,function*(){hr(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return x(this,null,function*(){let u=L(c);u.L_.add(4),yield cs(u),u.q_.set("Unknown"),u.L_.delete(4),yield _a(u)})}(this))}))}),this.q_=new zp(r,i)}};function _a(n){return x(this,null,function*(){if(hr(n))for(let e of n.B_)yield e(!0)})}function cs(n){return x(this,null,function*(){for(let e of n.B_)yield e(!1)})}function nu(n,e){let t=L(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Lm(t)?Fm(t):hs(t).r_()&&Mm(t,e))}function ts(n,e){let t=L(n),r=hs(t);t.N_.delete(e),r.r_()&&pI(t,e),t.N_.size===0&&(r.r_()?r.o_():hr(t)&&t.q_.set("Unknown"))}function Mm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}hs(n).A_(e)}function pI(n,e){n.Q_.xe(e),hs(n).R_(e)}function Fm(n){n.Q_=new ep({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),hs(n).start(),n.q_.v_()}function Lm(n){return hr(n)&&!hs(n).n_()&&n.N_.size>0}function hr(n){return L(n).L_.size===0}function mI(n){n.Q_=void 0}function lP(n){return x(this,null,function*(){n.q_.set("Online")})}function cP(n){return x(this,null,function*(){n.N_.forEach((e,t)=>{Mm(n,e)})})}function uP(n,e){return x(this,null,function*(){mI(n),Lm(n)?(n.q_.M_(e),Fm(n)):n.q_.set("Unknown")})}function hP(n,e,t){return x(this,null,function*(){if(n.q_.set("Online"),e instanceof gc&&e.state===2&&e.cause)try{yield function(i,s){return x(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Mc(n,r)}else if(e instanceof Gi?n.Q_.Ke(e):e instanceof mc?n.Q_.He(e):n.Q_.We(e),!t.isEqual(z.min()))try{let r=yield lI(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.N_.get(u);d&&s.N_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=s.N_.get(c);if(!d)return;s.N_.set(c,d.withResumeToken(ke.EMPTY_BYTE_STRING,d.snapshotVersion)),pI(s,c);let p=new Ji(d.target,c,u,d.sequenceNumber);Mm(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield Mc(n,r)}})}function Mc(n,e,t){return x(this,null,function*(){if(!ur(e))throw e;n.L_.add(1),yield cs(n),n.q_.set("Offline"),t||(t=()=>lI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>x(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield _a(n)}))})}function gI(n,e){return e().catch(t=>Mc(n,t,e))}function us(n){return x(this,null,function*(){let e=L(n),t=lr(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;dP(e);)try{let i=yield iP(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,fP(e,i)}catch(i){yield Mc(e,i)}_I(e)&&yI(e)})}function dP(n){return hr(n)&&n.O_.length<10}function fP(n,e){n.O_.push(e);let t=lr(n);t.r_()&&t.V_&&t.m_(e.mutations)}function _I(n){return hr(n)&&!lr(n).n_()&&n.O_.length>0}function yI(n){lr(n).start()}function pP(n){return x(this,null,function*(){lr(n).p_()})}function mP(n){return x(this,null,function*(){let e=lr(n);for(let t of n.O_)e.m_(t.mutations)})}function gP(n,e,t){return x(this,null,function*(){let r=n.O_.shift(),i=Jf.from(r,e,t);yield gI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield us(n)})}function _P(n,e){return x(this,null,function*(){e&&lr(n).V_&&(yield function(r,i){return x(this,null,function*(){if(function(o){return LT(o)&&o!==P.ABORTED}(i.code)){let s=r.O_.shift();lr(r).s_(),yield gI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield us(r)}})}(n,e)),_I(n)&&yI(n)})}function GE(n,e){return x(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let r=hr(t);t.L_.add(3),yield cs(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield _a(t)})}function Wp(n,e){return x(this,null,function*(){let t=L(n);e?(t.L_.delete(2),yield _a(t)):e||(t.L_.add(2),yield cs(t),t.q_.set("Unknown"))})}function hs(n){return n.K_||(n.K_=function(t,r,i){let s=L(t);return s.w_(),new qp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:lP.bind(null,n),Ro:cP.bind(null,n),mo:uP.bind(null,n),d_:hP.bind(null,n)}),n.B_.push(e=>x(this,null,function*(){e?(n.K_.s_(),Lm(n)?Fm(n):n.q_.set("Unknown")):(yield n.K_.stop(),mI(n))}))),n.K_}function lr(n){return n.U_||(n.U_=function(t,r,i){let s=L(t);return s.w_(),new jp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:pP.bind(null,n),mo:_P.bind(null,n),f_:mP.bind(null,n),g_:gP.bind(null,n)}),n.B_.push(e=>x(this,null,function*(){e?(n.U_.s_(),yield us(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var $p=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Be,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ds(n,e){if(Re("AsyncQueue",`${e}: ${n}`),ur(n))return new D(P.UNAVAILABLE,`${e}: ${n}`);throw n}var Fc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||U.comparator(t.key,r.key):(t,r)=>U.comparator(t.key,r.key),this.keyedMap=Lo(),this.sortedSet=new _e(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Lc=class{constructor(){this.W_=new _e(U.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},ns=class n{constructor(e,t,r,i,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Fc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Qp=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Hp=class{constructor(){this.queries=zE(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=L(t),s=i.queries;i.queries=zE(),s.forEach((o,a)=>{for(let c of a.j_)c.onError(r)})})(this,new D(P.ABORTED,"Firestore shutting down"))}};function zE(){return new en(n=>AT(n),pa)}function Um(n,e){return x(this,null,function*(){let t=L(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Qp,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=ds(o,`Initialization of query '${Mi(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&qm(t)})}function Bm(n,e){return x(this,null,function*(){let t=L(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function yP(n,e){let t=L(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&qm(t)}function vP(n,e,t){let r=L(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function qm(n){n.Y_.forEach(e=>{e.next()})}var Yp,KE;(KE=Yp||(Yp={})).ea="default",KE.Cache="cache";var la=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ns(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ns.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Yp.Cache}};var Jp=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var Uc=class{constructor(e){this.serializer=e}Es(e){return Yt(this.serializer,e)}ds(e){return e.metadata.exists?WT(this.serializer,e.document,!1):Fe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return xe(e)}},Xp=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=vI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=se.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new Uc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}complete(){return x(this,null,function*(){let e=yield sP(this.localStore,new Uc(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield oP(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function vI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Bc=class{constructor(e){this.key=e}},qc=class{constructor(e){this.key=e}},jc=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=CT(e),this.Ra=new Fc(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new Lc,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,p)=>{let m=i.get(d),y=ma(this.query,p)?p:null,S=!!m&&this.mutatedKeys.has(m.key),k=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),N=!1;m&&y?m.data.isEqual(y.data)?S!==k&&(r.track({type:3,doc:y}),N=!0):this.ga(m,y)||(r.track({type:2,doc:y}),N=!0,(c&&this.Aa(y,c)>0||u&&this.Aa(y,u)<0)&&(a=!0)):!m&&y?(r.track({type:0,doc:y}),N=!0):m&&!y&&(r.track({type:1,doc:m}),N=!0,(c||u)&&(a=!0)),N&&(y?(o=o.add(y),s=k?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,p)=>function(y,S){let k=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return k(y)-k(S)}(d.type,p.type)||this.Aa(d.doc,p.doc)),this.pa(r),i=i!=null&&i;let a=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new ns(this.query,e.Ra,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Lc,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=X(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new qc(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Bc(r))}),t}ba(e){this.Ta=e.Ts,this.da=X();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ns.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Zp=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},em=class{constructor(e){this.key=e,this.va=!1}},tm=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new en(a=>AT(a),pa),this.Ma=new Map,this.xa=new Set,this.Oa=new _e(U.comparator),this.Na=new Map,this.La=new sa,this.Ba={},this.ka=new Map,this.qa=Xi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function wP(n,e,t=!0){return x(this,null,function*(){let r=ru(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield wI(r,e,t,!0),i})}function EP(n,e){return x(this,null,function*(){let t=ru(n);yield wI(t,e,!0,!1)})}function wI(n,e,t,r){return x(this,null,function*(){let i=yield Zi(n.localStore,ct(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield jm(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&nu(n.remoteStore,i),a})}function jm(n,e,t,r,i){return x(this,null,function*(){n.Ka=(p,m,y)=>function(k,N,q,j){return x(this,null,function*(){let M=N.view.ma(q);M.ns&&(M=yield xc(k.localStore,N.query,!1).then(({documents:E})=>N.view.ma(E,M)));let K=j&&j.targetChanges.get(N.targetId),H=j&&j.targetMismatches.get(N.targetId)!=null,Y=N.view.applyChanges(M,k.isPrimaryClient,K,H);return nm(k,N.targetId,Y.wa),Y.snapshot})}(n,p,m,y);let s=yield xc(n.localStore,e,!0),o=new jc(e,s.Ts),a=o.ma(s.documents),c=ta.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,c);nm(n,t,u.wa);let d=new Zp(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot})}function TP(n,e,t){return x(this,null,function*(){let r=L(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!pa(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield es(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ts(r.remoteStore,i.targetId),rs(r,i.targetId)}).catch(cr))):(rs(r,i.targetId),yield es(r.localStore,i.targetId,!0))})}function IP(n,e){return x(this,null,function*(){let t=L(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ts(t.remoteStore,r.targetId))})}function AP(n,e,t){return x(this,null,function*(){let r=Wm(n);try{let i=yield function(o,a){let c=L(o),u=Te.now(),d=a.reduce((y,S)=>y.add(S.key),X()),p,m;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let S=dt(),k=X();return c.cs.getEntries(y,d).next(N=>{S=N,S.forEach((q,j)=>{j.isValidDocument()||(k=k.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,S)).next(N=>{p=N;let q=[];for(let j of a){let M=LR(j,p.get(j.key).overlayedDocument);M!=null&&q.push(new Mt(j.key,M,_T(M.value.mapValue),Ce.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,q,a)}).next(N=>{m=N;let q=N.applyToLocalDocumentSet(p,k);return c.documentOverlayCache.saveOverlays(y,N.batchId,q)})}).then(()=>({batchId:m.batchId,changes:RT(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Ba[o.currentUser.toKey()];u||(u=new _e(Q)),u=u.insert(a,c),o.Ba[o.currentUser.toKey()]=u}(r,i.batchId,t),yield wn(r,i.changes),yield us(r.remoteStore)}catch(i){let s=ds(i,"Failed to persist write");t.reject(s)}})}function EI(n,e){return x(this,null,function*(){let t=L(n);try{let r=yield rP(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?G(o.va):i.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield wn(t,r,e)}catch(r){yield cr(r)}})}function WE(n,e,t){let r=L(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=L(o);c.onlineState=a;let u=!1;c.queries.forEach((d,p)=>{for(let m of p.j_)m.Z_(a)&&(u=!0)}),u&&qm(c)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function SP(n,e,t){return x(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new _e(U.comparator);o=o.insert(s,Fe.newNoDocument(s,z.min()));let a=X().add(s),c=new ea(z.min(),new Map,new _e(Q),o,a);yield EI(r,c),r.Oa=r.Oa.remove(s),r.Na.delete(e),Km(r)}else yield es(r.localStore,e,!1).then(()=>rs(r,e,t)).catch(cr)})}function CP(n,e){return x(this,null,function*(){let t=L(n),r=e.batch.batchId;try{let i=yield nP(t.localStore,e);zm(t,r,null),Gm(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield wn(t,i)}catch(i){yield cr(i)}})}function bP(n,e,t){return x(this,null,function*(){let r=L(n);try{let i=yield function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(p=>(G(p!==null),d=p.keys(),c.mutationQueue.removeMutationBatch(u,p))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(r.localStore,e);zm(r,e,t),Gm(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield wn(r,i)}catch(i){yield cr(i)}})}function RP(n,e){return x(this,null,function*(){let t=L(n);hr(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=ds(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Gm(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function zm(n,e,t){let r=L(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function rs(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||TI(n,r)})}function TI(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(ts(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Km(n))}function nm(n,e,t){for(let r of t)r instanceof Bc?(n.La.addReference(r.key,e),PP(n,r)):r instanceof qc?(V("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||TI(n,r.key)):B()}function PP(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(r),Km(n))}function Km(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new U(se.fromString(e)),r=n.qa.next();n.Na.set(r,new em(t)),n.Oa=n.Oa.insert(t,r),nu(n.remoteStore,new Ji(ct(ls(t.path)),r,"TargetPurposeLimboResolution",vt.oe))}}function wn(n,e,t){return x(this,null,function*(){let r=L(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,c)=>{o.push(r.Ka(c,e,t).then(u=>{var d;if((u||t)&&r.isPrimaryClient){let p=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(u){i.push(u);let p=Vp.Wi(c.targetId,u);s.push(p)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(c,u){return x(this,null,function*(){let d=L(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(u,m=>b.forEach(m.$i,y=>d.persistence.referenceDelegate.addReference(p,m.targetId,y)).next(()=>b.forEach(m.Ui,y=>d.persistence.referenceDelegate.removeReference(p,m.targetId,y)))))}catch(p){if(!ur(p))throw p;V("LocalStore","Failed to update sequence numbers: "+p)}for(let p of u){let m=p.targetId;if(!p.fromCache){let y=d.os.get(m),S=y.snapshotVersion,k=y.withLastLimboFreeSnapshotVersion(S);d.os=d.os.insert(m,k)}}})}(r.localStore,s))})}function xP(n,e){return x(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let r=yield aI(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(c=>{c.reject(new D(P.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield wn(t,r.hs)}})}function kP(n,e){let t=L(n),r=t.Na.get(e);if(r&&r.va)return X().add(r.key);{let i=X(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function NP(n,e){return x(this,null,function*(){let t=L(n),r=yield xc(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&nm(t,e.targetId,i.wa),i})}function DP(n,e){return x(this,null,function*(){let t=L(n);return hI(t.localStore,e).then(r=>wn(t,r))})}function VP(n,e,t,r){return x(this,null,function*(){let i=L(n),s=yield function(a,c){let u=L(a),d=L(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",p=>d.Mn(p,c).next(m=>m?u.localDocuments.getDocuments(p,m):b.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield us(i.remoteStore):t==="acknowledged"||t==="rejected"?(zm(i,e,r||null),Gm(i,e),function(a,c){L(L(a).mutationQueue).On(c)}(i.localStore,e)):B(),yield wn(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function OP(n,e){return x(this,null,function*(){let t=L(n);if(ru(t),Wm(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield $E(t,r.toArray());t.Qa=!0,yield Wp(t.remoteStore,!0);for(let s of i)nu(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(rs(t,o),es(t.localStore,o,!0))),ts(t.remoteStore,o)}),yield i,yield $E(t,r),function(o){let a=L(o);a.Na.forEach((c,u)=>{ts(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new _e(U.comparator)}(t),t.Qa=!1,yield Wp(t.remoteStore,!1)}})}function $E(n,e,t){return x(this,null,function*(){let r=L(n),i=[],s=[];for(let o of e){let a,c=r.Ma.get(o);if(c&&c.length!==0){a=yield Zi(r.localStore,ct(c[0]));for(let u of c){let d=r.Fa.get(u),p=yield NP(r,d);p.snapshot&&s.push(p.snapshot)}}else{let u=yield uI(r.localStore,o);a=yield Zi(r.localStore,u),yield jm(r,II(u),o,!1,a.resumeToken)}i.push(a)}return r.Ca.d_(s),i})}function II(n){return IT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function MP(n){return function(t){return L(L(t).persistence).Qi()}(L(n).localStore)}function FP(n,e,t,r){return x(this,null,function*(){let i=L(n);if(i.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield hI(i.localStore,ST(s[0])),a=ea.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ke.EMPTY_BYTE_STRING);yield wn(i,o,a);break}case"rejected":yield es(i.localStore,e,!0),rs(i,e,r);break;default:B()}})}function LP(n,e,t){return x(this,null,function*(){let r=ru(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V("SyncEngine","Adding an already active target "+i);continue}let s=yield uI(r.localStore,i),o=yield Zi(r.localStore,s);yield jm(r,II(s),o.targetId,!1,o.resumeToken),nu(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield es(r.localStore,i,!1).then(()=>{ts(r.remoteStore,i),rs(r,i)}).catch(cr))}})}function ru(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=EI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=kP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=SP.bind(null,e),e.Ca.d_=yP.bind(null,e.eventManager),e.Ca.$a=vP.bind(null,e.eventManager),e}function Wm(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=CP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bP.bind(null,e),e}function UP(n,e,t){let r=L(n);(function(s,o,a){return x(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(y,S){let k=L(y),N=xe(S.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",q=>k.Gr.getBundleMetadata(q,S.id)).then(q=>!!q&&q.createTime.compareTo(N)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(vI(c));let u=new Xp(c,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let m=yield u.la(d);m&&a._updateProgress(m),d=yield o.Ua()}let p=yield u.complete();return yield wn(s,p.Ia,void 0),yield function(y,S){let k=L(y);return k.persistence.runTransaction("Save bundle","readwrite",N=>k.Gr.saveBundleMetadata(N,S))}(s.localStore,c),a._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return Vt("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var rm=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return x(this,null,function*(){this.serializer=ga(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return oI(this.persistence,new Pc,t.initialUser,this.serializer)}Ga(t){return new bc(Rc.Zr,this.serializer)}Wa(t){return new Dc}terminate(){return x(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Gc=class n extends rm{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return x(this,null,function*(){yield ju(n.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield Wm(this.Ja.syncEngine),yield us(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return oI(this.persistence,new Pc,e.initialUser,this.serializer)}ja(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new yp(r,e.asyncQueue,t)}Ha(e,t){let r=new Of(t,this.persistence);return new Vf(e.asyncQueue,r)}Ga(e){let t=Om(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new Dp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,fI(),nc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Dc}},im=class n extends Gc{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return x(this,null,function*(){yield ju(n.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof zo&&(this.sharedClientState.syncEngine={no:VP.bind(null,t),ro:FP.bind(null,t),io:LP.bind(null,t),Qi:MP.bind(null,t),eo:DP.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>x(this,null,function*(){yield OP(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=fI();if(!zo.D(t))throw new D(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Om(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new zo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},$m=(()=>{class n{initialize(t,r){return x(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>WE(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=xP.bind(null,this.syncEngine),yield Wp(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Hp}()}createDatastore(t){let r=ga(t.databaseInfo.databaseId),i=function(o){return new Bp(o)}(t.databaseInfo);return function(o,a,c,u){return new Gp(o,a,c,u)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,a,c){return new Kp(i,s,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,r=>WE(this.syncEngine,r,0),function(){return Vc.D()?new Vc:new Lp}())}createSyncEngine(t,r){return function(s,o,a,c,u,d,p){let m=new tm(s,o,a,c,u,d);return p&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return x(this,null,function*(){var t,r;yield function(s){return x(this,null,function*(){let o=L(s);V("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield cs(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function QE(n,e=10240){let t=0;return{read(){return x(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return x(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var is=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Re("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var sm=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Be,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}getMetadata(){return x(this,null,function*(){return this.metadata.promise})}Ua(){return x(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return x(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);let i=yield this.iu(r);return new Jp(JSON.parse(i),e.length+r)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return x(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return x(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return x(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var om=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return x(this,null,function*(){let o=L(i),a={documents:s.map(p=>na(o.serializer,p))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,se.emptyPath(),a,s.length),u=new Map;c.forEach(p=>{let m=zR(o.serializer,p);u.set(m.key.toString(),m)});let d=[];return s.forEach(p=>{let m=u.get(p.toString());G(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ar(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new Jo(i,this.precondition(i)))}),yield function(r,i){return x(this,null,function*(){let s=L(r),o={writes:i.map(a=>ra(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,se.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=z.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?Ce.exists(!1):Ce.updateTime(t):Ce.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new D(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ce.updateTime(t)}return Ce.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var am=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this._u=r.maxAttempts,this.t_=new aa(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>x(this,null,function*(){let e=new om(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.lu(i)}))}).catch(r=>{this.lu(r)})}))}cu(e){try{let t=this.updateFunction(e);return!da(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!LT(t)}return!1}};var lm=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Me.UNAUTHENTICATED,this.clientId=ic.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>x(this,null,function*(){V("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Be;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ds(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function If(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>x(this,null,function*(){r.isEqual(i)||(yield aI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function HE(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Qm(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>GE(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>GE(e.remoteStore,i)),n._onlineComponents=e})}function Qm(n){return x(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield If(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Vt("Error using user provided cache. Falling back to memory cache: "+t),yield If(n,new rm)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield If(n,new rm);return n._offlineComponents})}function iu(n){return x(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield HE(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield HE(n,new $m))),n._onlineComponents})}function AI(n){return Qm(n).then(e=>e.persistence)}function Hm(n){return Qm(n).then(e=>e.localStore)}function SI(n){return iu(n).then(e=>e.remoteStore)}function Ym(n){return iu(n).then(e=>e.syncEngine)}function BP(n){return iu(n).then(e=>e.datastore)}function ss(n){return x(this,null,function*(){let e=yield iu(n),t=e.eventManager;return t.onListen=wP.bind(null,e.syncEngine),t.onUnlisten=TP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=EP.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=IP.bind(null,e.syncEngine),t})}function qP(n){return n.asyncQueue.enqueue(()=>x(this,null,function*(){let e=yield AI(n),t=yield SI(n);return e.setNetworkEnabled(!0),function(i){let s=L(i);return s.L_.delete(0),_a(s)}(t)}))}function jP(n){return n.asyncQueue.enqueue(()=>x(this,null,function*(){let e=yield AI(n),t=yield SI(n);return e.setNetworkEnabled(!1),function(i){return x(this,null,function*(){let s=L(i);s.L_.add(0),yield cs(s),s.q_.set("Offline")})}(t)}))}function GP(n,e){let t=new Be;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s,o){return x(this,null,function*(){try{let a=yield function(u,d){let p=L(u);return p.persistence.runTransaction("read document","readonly",m=>p.localDocuments.getDocument(m,d))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=ds(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield Hm(n),e,t)})),t.promise}function CI(n,e,t={}){let r=new Be;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(s,o,a,c,u){let d=new is({next:m=>{d.Za(),o.enqueueAndForget(()=>Bm(s,p));let y=m.docs.has(a);!y&&m.fromCache?u.reject(new D(P.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&c&&c.source==="server"?u.reject(new D(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new la(ls(a.path),d,{includeMetadataChanges:!0,_a:!0});return Um(s,p)}(yield ss(n),n.asyncQueue,e,t,r)})),r.promise}function zP(n,e){let t=new Be;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s,o){return x(this,null,function*(){try{let a=yield xc(i,s,!0),c=new jc(s,a.Ts),u=c.ma(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=ds(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield Hm(n),e,t)})),t.promise}function bI(n,e,t={}){let r=new Be;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(s,o,a,c,u){let d=new is({next:m=>{d.Za(),o.enqueueAndForget(()=>Bm(s,p)),m.fromCache&&c.source==="server"?u.reject(new D(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new la(a,d,{includeMetadataChanges:!0,_a:!0});return Um(s,p)}(yield ss(n),n.asyncQueue,e,t,r)})),r.promise}function KP(n,e){let t=new is(e);return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s){L(i).Y_.add(s),s.next()}(yield ss(n),t)})),()=>{t.Za(),n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s){L(i).Y_.delete(s)}(yield ss(n),t)}))}}function WP(n,e,t,r){let i=function(o,a){let c;return c=typeof o=="string"?BT().encode(o):o,function(d,p){return new sm(d,p)}(function(d,p){if(d instanceof Uint8Array)return QE(d,p);if(d instanceof ArrayBuffer)return QE(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,ga(e));n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){UP(yield Ym(n),i,r)}))}function $P(n,e){return n.asyncQueue.enqueue(()=>x(this,null,function*(){return function(r,i){let s=L(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield Hm(n),e)}))}function RI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var YE=new Map;function Jm(n,e,t){if(!t)throw new D(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Xm(n,e,t,r){if(e===!0&&r===!0)throw new D(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function JE(n){if(!U.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function XE(n){if(U.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function su(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B()}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=su(n);throw new D(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function PI(n,e){if(e<=0)throw new D(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var zc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new D(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Xm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=RI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Kr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zc({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zc(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Af;switch(r.type){case"firstParty":return new Rf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return x(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=YE.get(t);r&&(V("ComponentProvider","Removing Datastore"),YE.delete(t),r.terminate())}(this),Promise.resolve()}};function xI(n,e,t,r={}){var i;let s=(n=oe(n,Kr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Vt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Me.MOCK_USER;else{a=Ka(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new D(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Me(u)}n._authCredentials=new Sf(new rc(a,c))}}var $e=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},me=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Jt=class n extends $e{constructor(e,t,r){super(e,t,ls(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new me(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Zm(n,e,...t){if(n=ne(n),Jm("collection","path",e),n instanceof Kr){let r=se.fromString(e,...t);return XE(r),new Jt(n,null,r)}{if(!(n instanceof me||n instanceof Jt))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return XE(r),new Jt(n.firestore,null,r)}}function kI(n,e){if(n=oe(n,Kr),Jm("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new $e(n,null,function(r){return new Ot(se.emptyPath(),r)}(e))}function ya(n,e,...t){if(n=ne(n),arguments.length===1&&(e=ic.newId()),Jm("doc","path",e),n instanceof Kr){let r=se.fromString(e,...t);return JE(r),new me(n,null,new U(r))}{if(!(n instanceof me||n instanceof Jt))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return JE(r),new me(n.firestore,n instanceof Jt?n.converter:null,new U(r))}}function eg(n,e){return n=ne(n),e=ne(e),(n instanceof me||n instanceof Jt)&&(e instanceof me||e instanceof Jt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function tg(n,e){return n=ne(n),e=ne(e),n instanceof $e&&e instanceof $e&&n.firestore===e.firestore&&pa(n._query,e._query)&&n.converter===e.converter}var Kc=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new aa(this,"async_queue_retry"),this.Vu=()=>{let r=nc();r&&V("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=nc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=nc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new Be;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return x(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ur(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Re("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=$p.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&B()}verifyOperationInProgress(){}wu(){return x(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function cm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var um=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Be,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var NI=-1,Ie=class extends Kr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Kc,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return x(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Kc(e),this._firestoreClient=void 0,yield e}})}};function Qe(n){if(n._terminated)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||DI(n),n._firestoreClient}function DI(n){var e,t,r;let i=n._freezeSettings(),s=function(a,c,u,d){return new Mf(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,RI(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new lm(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(n._componentsProvider))}function VI(n,e){Vt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return MI(n,$m.provider,{build:r=>new Gc(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function OI(n){return x(this,null,function*(){Vt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();MI(n,$m.provider,{build:t=>new im(t,e.cacheSizeBytes)})})}function MI(n,e,t){if((n=oe(n,Ie))._firestoreClient||n._terminated)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(P.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},DI(n)}function FI(n){if(n._initialized&&!n._terminated)throw new D(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Be;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{yield function(r){return x(this,null,function*(){if(!er.D())return Promise.resolve();let i=r+"main";yield er.delete(i)})}(Om(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function LI(n){return function(t){let r=new Be;return t.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return RP(yield Ym(t),r)})),r.promise}(Qe(n=oe(n,Ie)))}function UI(n){return qP(Qe(n=oe(n,Ie)))}function BI(n){return jP(Qe(n=oe(n,Ie)))}function qI(n,e){let t=Qe(n=oe(n,Ie)),r=new um;return WP(t,n._databaseId,e,r),r}function jI(n,e){return $P(Qe(n=oe(n,Ie)),e).then(t=>t?new $e(n,null,t.query):null)}var tn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ke.fromBase64String(e))}catch(t){throw new D(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Ft=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var yn=class{constructor(e){this._methodName=e}};var Wr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var ca=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var QP=/^__.*__$/,hm=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Mt(e,this.data,this.fieldMask,t,this.fieldTransforms):new or(e,this.data,t,this.fieldTransforms)}},Wc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Mt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function GI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var $c=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Qc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(GI(this.Cu)&&QP.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},dm=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ga(e)}Qu(e,t,r,i=!1){return new $c({Cu:e,methodName:t,qu:r,path:Pe.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Yr(n){let e=n._freezeSettings(),t=ga(n._databaseId);return new dm(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ou(n,e,t,r,i,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);ig("Data must be an object, but it was:",o,r);let a=WI(r,o),c,u;if(s.merge)c=new wt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let p of s.mergeFields){let m=_m(e,p,t);if(!o.contains(m))throw new D(P.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);QI(d,m)||d.push(m)}c=new wt(d),u=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,u=o.fieldTransforms;return new hm(new tt(a),c,u)}var ua=class n extends yn{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function zI(n,e,t){return new $c({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var fm=class n extends yn{_toFieldTransform(e){return new jr(e.path,new ir)}isEqual(e){return e instanceof n}},pm=class n extends yn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=zI(this,e,!0),r=this.Ku.map(s=>Jr(s,t)),i=new gn(r);return new jr(e.path,i)}isEqual(e){return e instanceof n&&sh(this.Ku,e.Ku)}},mm=class n extends yn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=zI(this,e,!0),r=this.Ku.map(s=>Jr(s,t)),i=new _n(r);return new jr(e.path,i)}isEqual(e){return e instanceof n&&sh(this.Ku,e.Ku)}},gm=class n extends yn{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new sr(e.serializer,kT(e.serializer,this.$u));return new jr(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function ng(n,e,t,r){let i=n.Qu(1,e,t);ig("Data must be an object, but it was:",i,r);let s=[],o=tt.empty();Hr(r,(c,u)=>{let d=sg(e,c,t);u=ne(u);let p=i.Nu(d);if(u instanceof ua)s.push(d);else{let m=Jr(u,p);m!=null&&(s.push(d),o.set(d,m))}});let a=new wt(s);return new Wc(o,a,i.fieldTransforms)}function rg(n,e,t,r,i,s){let o=n.Qu(1,e,t),a=[_m(e,r,t)],c=[i];if(s.length%2!=0)throw new D(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(_m(e,s[m])),c.push(s[m+1]);let u=[],d=tt.empty();for(let m=a.length-1;m>=0;--m)if(!QI(u,a[m])){let y=a[m],S=c[m];S=ne(S);let k=o.Nu(y);if(S instanceof ua)u.push(y);else{let N=Jr(S,k);N!=null&&(u.push(y),d.set(y,N))}}let p=new wt(u);return new Wc(d,p,o.fieldTransforms)}function KI(n,e,t,r=!1){return Jr(t,n.Qu(r?4:3,e))}function Jr(n,e){if($I(n=ne(n)))return ig("Unsupported field value:",e,n),WI(n,e);if(n instanceof yn)return function(r,i){if(!GI(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=Jr(a,i.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return kT(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Te.fromDate(r);return{timestampValue:Yi(i.serializer,s)}}if(r instanceof Te){let s=new Te(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Yi(i.serializer,s)}}if(r instanceof Wr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof tn)return{bytesValue:qT(i.serializer,r._byteString)};if(r instanceof me){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Nm(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof ca)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Bu("VectorValues must only contain numeric values.");return km(a.serializer,c)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${su(r)}`)}(n,e)}function WI(n,e){let t={};return fT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hr(n,(r,i)=>{let s=Jr(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function $I(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Te||n instanceof Wr||n instanceof tn||n instanceof me||n instanceof yn||n instanceof ca)}function ig(n,e,t){if(!$I(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=su(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function _m(n,e,t){if((e=ne(e))instanceof Ft)return e._internalPath;if(typeof e=="string")return sg(n,e);throw Qc("Field path arguments must be of type string or ",n,!1,void 0,t)}var HP=new RegExp("[~\\*/\\[\\]]");function sg(n,e,t){if(e.search(HP)>=0)throw Qc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ft(...e.split("."))._internalPath}catch{throw Qc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Qc(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new D(P.INVALID_ARGUMENT,a+n+c)}function QI(n,e){return n.some(t=>t.isEqual(e))}var $r=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new ym(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(au("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},ym=class extends $r{data(){return super.data()}};function au(n,e){return typeof e=="string"?sg(n,e):e instanceof Ft?e._internalPath:e._delegate._internalPath}function HI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ha=class{},Qr=class extends ha{};function En(n,e,...t){let r=[];e instanceof ha&&r.push(e),r=r.concat(t),function(s){let o=s.filter(c=>c instanceof vm).length,a=s.filter(c=>c instanceof Hc).length;if(o>1||o>0&&a>0)throw new D(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Hc=class n extends Qr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return s0(e._query,t),new $e(e.firestore,e.converter,Hf(e._query,t))}_parse(e){let t=Yr(e.firestore);return function(s,o,a,c,u,d,p){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){eT(p,d);let y=[];for(let S of p)y.push(ZE(c,s,S));m={arrayValue:{values:y}}}else m=ZE(c,s,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||eT(p,d),m=KI(a,o,p,d==="in"||d==="not-in");return re.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function YI(n,e,t){let r=e,i=au("where",n);return Hc._create(i,r,t)}var vm=class n extends ha{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)s0(o,c),o=Hf(o,c)}(e._query,t),new $e(e.firestore,e.converter,Hf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var wm=class n extends Qr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Br(s,o)}(e._query,this._field,this._direction);return new $e(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ot(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function JI(n,e="asc"){let t=e,r=au("orderBy",n);return wm._create(r,t)}var Yc=class n extends Qr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new $e(e.firestore,e.converter,pc(e._query,this._limit,this._limitType))}};function XI(n){return PI("limit",n),Yc._create("limit",n,"F")}function ZI(n){return PI("limitToLast",n),Yc._create("limitToLast",n,"L")}var Jc=class n extends Qr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=i0(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(i,s){return new Ot(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function e0(...n){return Jc._create("startAt",n,!0)}function t0(...n){return Jc._create("startAfter",n,!1)}var Xc=class n extends Qr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=i0(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(i,s){return new Ot(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function n0(...n){return Xc._create("endBefore",n,!1)}function r0(...n){return Xc._create("endAt",n,!0)}function i0(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof $r)return function(s,o,a,c,u){if(!c)throw new D(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let p of ji(s))if(p.field.isKeyField())d.push(Ur(o,c.key));else{let m=c.data.field(p.field);if(eu(m))throw new D(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let y=p.field.canonicalString();throw new D(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new Zt(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Yr(n.firestore);return function(o,a,c,u,d,p){let m=o.explicitOrderBy;if(d.length>m.length)throw new D(P.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let S=0;S<d.length;S++){let k=d[S];if(m[S].field.isKeyField()){if(typeof k!="string")throw new D(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof k}`);if(!Pm(o)&&k.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${k}' contains a slash.`);let N=o.path.child(se.fromString(k));if(!U.isDocumentKey(N))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let q=new U(N);y.push(Ur(a,q))}else{let N=KI(c,u,k);y.push(N)}}return new Zt(y,p)}(n._query,n.firestore._databaseId,i,e,t,r)}}function ZE(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new D(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pm(e)&&t.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(se.fromString(t));if(!U.isDocumentKey(r))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ur(n,new U(r))}if(t instanceof me)return Ur(n,t._key);throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${su(t)}.`)}function eT(n,e){if(!Array.isArray(n)||n.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function s0(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var os=class{convertValue(e,t="none"){switch(Lr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Hr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ve(o.doubleValue));return new ca(s)}convertGeoPoint(e){return new Wr(ve(e.latitude),ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=bm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qo(e));default:return null}}convertTimestamp(e){let t=mn(e);return new Te(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=se.fromString(e);G(XT(r));let i=new nr(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Re(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function lu(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Em=class extends os{constructor(e){super(),this.firestore=e}convertBytes(e){return new tn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}};var pn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Rt=class extends $r{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Xn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(au("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Xn=class extends Rt{data(e={}){return super.data(e)}},Lt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new pn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Xn(this._firestore,this._userDataWriter,r.key,r,new pn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new Xn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new pn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Xn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new pn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:YP(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function YP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function og(n,e){return n instanceof Rt&&e instanceof Rt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Lt&&e instanceof Lt&&n._firestore===e._firestore&&tg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function o0(n){n=oe(n,me);let e=oe(n.firestore,Ie);return CI(Qe(e),n._key).then(t=>ug(e,n,t))}var vn=class extends os{constructor(e){super(),this.firestore=e}convertBytes(e){return new tn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}};function a0(n){n=oe(n,me);let e=oe(n.firestore,Ie),t=Qe(e),r=new vn(e);return GP(t,n._key).then(i=>new Rt(e,r,n._key,i,new pn(i!==null&&i.hasLocalMutations,!0),n.converter))}function l0(n){n=oe(n,me);let e=oe(n.firestore,Ie);return CI(Qe(e),n._key,{source:"server"}).then(t=>ug(e,n,t))}function c0(n){n=oe(n,$e);let e=oe(n.firestore,Ie),t=Qe(e),r=new vn(e);return HI(n._query),bI(t,n._query).then(i=>new Lt(e,r,n,i))}function u0(n){n=oe(n,$e);let e=oe(n.firestore,Ie),t=Qe(e),r=new vn(e);return zP(t,n._query).then(i=>new Lt(e,r,n,i))}function h0(n){n=oe(n,$e);let e=oe(n.firestore,Ie),t=Qe(e),r=new vn(e);return bI(t,n._query,{source:"server"}).then(i=>new Lt(e,r,n,i))}function ag(n,e,t){n=oe(n,me);let r=oe(n.firestore,Ie),i=lu(n.converter,e,t);return fs(r,[ou(Yr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ce.none())])}function lg(n,e,t,...r){n=oe(n,me);let i=oe(n.firestore,Ie),s=Yr(i),o;return o=typeof(e=ne(e))=="string"||e instanceof Ft?rg(s,"updateDoc",n._key,e,t,r):ng(s,"updateDoc",n._key,e),fs(i,[o.toMutation(n._key,Ce.exists(!0))])}function d0(n){return fs(oe(n.firestore,Ie),[new ar(n._key,Ce.none())])}function f0(n,e){let t=oe(n.firestore,Ie),r=ya(n),i=lu(n.converter,e);return fs(t,[ou(Yr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ce.exists(!1))]).then(()=>r)}function cg(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||cm(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(cm(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let c,u,d;if(n instanceof me)u=oe(n.firestore,Ie),d=ls(n._key.path),c={next:p=>{e[o]&&e[o](ug(u,n,p))},error:e[o+1],complete:e[o+2]};else{let p=oe(n,$e);u=oe(p.firestore,Ie),d=p._query;let m=new vn(u);c={next:y=>{e[o]&&e[o](new Lt(u,m,p,y))},error:e[o+1],complete:e[o+2]},HI(n._query)}return function(m,y,S,k){let N=new is(k),q=new la(y,N,S);return m.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return Um(yield ss(m),q)})),()=>{N.Za(),m.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return Bm(yield ss(m),q)}))}}(Qe(u),d,a,c)}function p0(n,e){return KP(Qe(n=oe(n,Ie)),cm(e)?e:{next:e})}function fs(n,e){return function(r,i){let s=new Be;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return AP(yield Ym(r),i,s)})),s.promise}(Qe(n),e)}function ug(n,e,t){let r=t.docs.get(e._key),i=new vn(n);return new Rt(n,i,e._key,r,new pn(t.hasPendingWrites,t.fromCache),e.converter)}var JP={maxAttempts:5};var Zc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yr(e)}set(e,t,r){this._verifyNotCommitted();let i=Yn(e,this._firestore),s=lu(i.converter,t,r),o=ou(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Ce.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Yn(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof Ft?rg(this._dataReader,"WriteBatch.update",s._key,t,r,i):ng(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ce.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Yn(e,this._firestore);return this._mutations=this._mutations.concat(new ar(t._key,Ce.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Yn(n,e){if((n=ne(n)).firestore!==e)throw new D(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Tm=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Yr(t)}get(t){let r=Yn(t,this._firestore),i=new Em(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return B();let o=s[0];if(o.isFoundDocument())return new $r(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new $r(this._firestore,i,r._key,null,r.converter);throw B()})}set(t,r,i){let s=Yn(t,this._firestore),o=lu(s.converter,r,i),a=ou(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Yn(t,this._firestore),a;return a=typeof(r=ne(r))=="string"||r instanceof Ft?rg(this._dataReader,"Transaction.update",o._key,r,i,s):ng(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Yn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Yn(e,this._firestore),r=new vn(this._firestore);return super.get(e).then(i=>new Rt(this._firestore,r,t._key,i._document,new pn(!1,!1),t.converter))}};function m0(n,e,t){n=oe(n,Ie);let r=Object.assign(Object.assign({},JP),t);return function(s){if(s.maxAttempts<1)throw new D(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let c=new Be;return s.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){let u=yield BP(s);new am(s.asyncQueue,u,a,o,c).au()})),c.promise}(Qe(n),i=>e(new Tm(n,i)),r)}function g0(){return new ua("deleteField")}function _0(){return new fm("serverTimestamp")}function y0(...n){return new pm("arrayUnion",n)}function v0(...n){return new mm("arrayRemove",n)}function w0(n){return new gm("increment",n)}(function(e,t=!0){(function(i){as=i})(Ya),vr(new pt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Ie(new Cf(r.getProvider("auth-internal")),new xf(r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new D(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nr(u.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),xt(Xw,"4.7.3",e),xt(Xw,"4.7.3","esm2017")})();var XP="@firebase/firestore-compat",ZP="0.3.38";function gg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function E0(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function T0(){if(!pT())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var cu=class n{constructor(e){this._delegate=e}static fromBase64String(e){return T0(),new n(tn.fromBase64String(e))}static fromUint8Array(e){return E0(),new n(tn.fromUint8Array(e))}toBase64(){return T0(),this._delegate.toBase64()}toUint8Array(){return E0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function hg(n){return ex(n,["next","error","complete"])}function ex(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var dg=class{enableIndexedDbPersistence(e,t){return VI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return OI(e._delegate)}clearIndexedDbPersistence(e){return FI(e._delegate)}},uu=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof nr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Vt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){xI(this._delegate,e,t,r)}enableNetwork(){return UI(this._delegate)}disableNetwork(){return BI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Xm("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return LI(this._delegate)}onSnapshotsInSync(e){return p0(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new gs(this,Zm(this._delegate,e))}catch(t){throw ut(t,"collection()","Firestore.collection()")}}doc(e){try{return new nn(this,ya(this._delegate,e))}catch(t){throw ut(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ti(this,kI(this._delegate,e))}catch(t){throw ut(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return m0(this._delegate,t=>e(new hu(this,t)))}batch(){return Qe(this._delegate),new du(new Zc(this._delegate,e=>fs(this._delegate,e)))}loadBundle(e){return qI(this._delegate,e)}namedQuery(e){return jI(this._delegate,e).then(t=>t?new ti(this,t):null)}},ps=class extends os{constructor(e){super(),this.firestore=e}convertBytes(e){return new cu(new tn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return nn.forKey(t,this.firestore,null)}};function tx(n){tT(n)}var hu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ps(e)}get(e){let t=Xr(e);return this._delegate.get(t).then(r=>new Zr(this._firestore,new Rt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Xr(e);return r?(gg("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Xr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Xr(e);return this._delegate.delete(t),this}},du=class{constructor(e){this._delegate=e}set(e,t,r){let i=Xr(e);return r?(gg("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Xr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Xr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ms=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Xn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ei(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ps(e),t),i.set(t,s)),s}};ms.INSTANCES=new WeakMap;var nn=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ps(e)}static forPath(e,t,r){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new me(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new me(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new gs(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new gs(this.firestore,Zm(this._delegate,e))}catch(t){throw ut(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof me?eg(this._delegate,e):!1}set(e,t){t=gg("DocumentReference.set",t);try{return t?ag(this._delegate,e,t):ag(this._delegate,e)}catch(r){throw ut(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?lg(this._delegate,e):lg(this._delegate,e,t,...r)}catch(i){throw ut(i,"updateDoc()","DocumentReference.update()")}}delete(){return d0(this._delegate)}onSnapshot(...e){let t=I0(e),r=A0(e,i=>new Zr(this.firestore,new Rt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return cg(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=a0(this._delegate):e?.source==="server"?t=l0(this._delegate):t=o0(this._delegate),t.then(r=>new Zr(this.firestore,new Rt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ms.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ut(n,e,t){return n.message=n.message.replace(e,t),n}function I0(n){for(let e of n)if(typeof e=="object"&&!hg(e))return e;return{}}function A0(n,e){var t,r;let i;return hg(n[0])?i=n[0]:hg(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Zr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new nn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return og(this._delegate,e._delegate)}},ei=class extends Zr{data(e){let t=this._delegate.data(e);return this._delegate._converter||nT(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ti=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ps(e)}where(e,t,r){try{return new n(this.firestore,En(this._delegate,YI(e,t,r)))}catch(i){throw ut(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,En(this._delegate,JI(e,t)))}catch(r){throw ut(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,En(this._delegate,XI(e)))}catch(t){throw ut(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,En(this._delegate,ZI(e)))}catch(t){throw ut(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,En(this._delegate,e0(...e)))}catch(t){throw ut(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,En(this._delegate,t0(...e)))}catch(t){throw ut(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,En(this._delegate,n0(...e)))}catch(t){throw ut(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,En(this._delegate,r0(...e)))}catch(t){throw ut(t,"endAt()","Query.endAt()")}}isEqual(e){return tg(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=u0(this._delegate):e?.source==="server"?t=h0(this._delegate):t=c0(this._delegate),t.then(r=>new va(this.firestore,new Lt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=I0(e),r=A0(e,i=>new va(this.firestore,new Lt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return cg(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ms.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},fg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ei(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},va=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ti(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ei(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new fg(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ei(this._firestore,r))})}isEqual(e){return og(this._delegate,e._delegate)}},gs=class n extends ti{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new nn(this.firestore,e):null}doc(e){try{return e===void 0?new nn(this.firestore,ya(this._delegate)):new nn(this.firestore,ya(this._delegate,e))}catch(t){throw ut(t,"doc()","CollectionReference.doc()")}}add(e){return f0(this._delegate,e).then(t=>new nn(this.firestore,t))}isEqual(e){return eg(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ms.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Xr(n){return oe(n,me)}var pg=class n{constructor(...e){this._delegate=new Ft(...e)}static documentId(){return new n(Pe.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof Ft?this._delegate._internalPath.isEqual(e._internalPath):!1}};var mg=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=_0();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=g0();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=y0(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=v0(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=w0(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var nx={Firestore:uu,GeoPoint:Wr,Timestamp:Te,Blob:cu,Transaction:hu,WriteBatch:du,DocumentReference:nn,DocumentSnapshot:Zr,Query:ti,QueryDocumentSnapshot:ei,QuerySnapshot:va,CollectionReference:gs,FieldPath:pg,FieldValue:mg,setLogLevel:tx,CACHE_SIZE_UNLIMITED:NI};function rx(n,e){n.INTERNAL.registerComponent(new pt("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},nx)))}function ix(n){rx(n,(e,t)=>new uu(e,t,new dg)),n.registerVersion(XP,ZP)}ix(Ue);function sx(n,e=ai){return new Cn(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function S0(n,e){return sx(n,e)}function ox(n,e){return S0(n,e).pipe(Ba(void 0),Ua(),Se(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function vg(n,e){return S0(n,e).pipe(Se(t=>({payload:t,type:"query"})))}var fu=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=x0(r,t);return new mu(i,s,this.afs)}snapshotChanges(){return ox(this.ref,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return this.snapshotChanges().pipe(Se(({payload:t})=>e.idField?Ms(oi({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return bn(this.ref.get(e)).pipe(be)}};function pu(n,e){return vg(n,e).pipe(Ba(void 0),Ua(),Se(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,c)=>{let u=s.find(p=>p.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(p=>p.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function C0(n,e,t){return pu(n,t).pipe(_r((r,i)=>ax(r,i.map(s=>s.payload),e),[]),La(),Se(r=>r.map(i=>({type:i.type,payload:i}))))}function ax(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=lx(n,r))}),n}function _g(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function lx(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return _g(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return _g(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return _g(n,e.oldIndex,1);break}return n}function b0(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var mu=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=pu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Se(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Ba(void 0),Ua(),Ls(([r,i])=>i.length>0||!r),Se(([,r])=>r),be)}auditTrail(e){return this.stateChanges(e).pipe(_r((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=b0(e);return C0(this.query,t,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return vg(this.query,this.afs.schedulers.outsideAngular).pipe(Se(t=>t.payload.docs.map(r=>e.idField?Ms(oi({},r.data()),{[e.idField]:r.id}):r.data())),be)}get(e){return bn(this.query.get(e)).pipe(be)}add(e){return this.ref.add(e)}doc(e){return new fu(this.ref.doc(e),this.afs)}},yg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?pu(this.query,this.afs.schedulers.outsideAngular).pipe(be):pu(this.query,this.afs.schedulers.outsideAngular).pipe(Se(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ls(t=>t.length>0),be)}auditTrail(e){return this.stateChanges(e).pipe(_r((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=b0(e);return C0(this.query,t,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return vg(this.query,this.afs.schedulers.outsideAngular).pipe(Se(r=>r.payload.docs.map(i=>e.idField?oi({[e.idField]:i.id},i.data()):i.data())),be)}get(e){return bn(this.query.get(e)).pipe(be)}},R0=new je("angularfire2.enableFirestorePersistence"),P0=new je("angularfire2.firestore.persistenceSettings"),cx=new je("angularfire2.firestore.settings"),ux=new je("angularfire2.firestore.use-emulator");function x0(n,e=t=>t){return{query:e(n),ref:n}}var hx=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,c,u,d,p,m,y,S,k,N,q,j){this.schedulers=c;let M=wr(t,a,r),K=d;p&&Js(M,a,m,S,k,N,y,q),[this.firestore,this.persistenceEnabled$]=di(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let H=a.runOutsideAngular(()=>M.firestore());if(s&&H.settings(s),K&&H.useEmulator(...K),i&&!Ga(o)){let Y=()=>{try{return bn(H.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),Ut(!1)}};return[H,a.runOutsideAngular(Y)]}else return[H,Ut(!1)]},[s,K,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=x0(i,r),a=this.schedulers.ngZone.run(()=>s);return new mu(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new yg(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new fu(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(W(Vn),W(On,8),W(R0,8),W(cx,8),W(kn),W(Bt),W(hi),W(P0,8),W(ux,8),W(Xs,8),W(Ks,8),W(Ws,8),W($s,8),W(Qs,8),W(Hs,8),W(Ys,8),W(ln,8))};static \u0275prov=Rn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),k0=(()=>{class n{constructor(){Ue.registerVersion("angularfire",cn.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:R0,useValue:!0},{provide:P0,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=xn({type:n});static \u0275inj=Pn({providers:[hx]})}return n})();var N0={apiKey:"AIzaSyB4zWcUMYtdA0KIN4kEwTWYvV3ZByNU9NI",authDomain:"my-e-commerce-f5789.firebaseapp.com",projectId:"my-e-commerce-f5789",storageBucket:"my-e-commerce-f5789.appspot.com",messagingSenderId:"773143157089",appId:"1:773143157089:web:c0ec3a507f7debe03b0d20"},qN=oy(N0),D0={providers:[L_({eventCoalescing:!0}),K_(ly),q_(),x_([hy.initializeApp(N0),Sy,Hw,k0]),$_({domain:"dev-147itc6fogjjtaz5.us.auth0.com",clientId:"VoXYESZ9rRJKFzfHFYb01NlVzmPh0ZuB",authorizationParams:{redirect_uri:window.location.origin,audience:"https://my-public-api"},useRefreshTokens:!0,cacheLocation:"localstorage"})]};function wg(n,e){let t=!e?.manualCleanup;t&&!e?.injector&&k_(wg);let r=t?e?.injector?.get(Yu)??Us(Yu):null,i=dx(e?.equal),s;e?.requireSync?s=Ju({kind:0},{equal:i}):s=Ju({kind:1,value:e?.initialValue},{equal:i});let o=n.subscribe({next:a=>s.set({kind:1,value:a}),error:a=>{if(e?.rejectErrors)throw a;s.set({kind:2,error:a})}});if(e?.requireSync&&s().kind===0)throw new Ku(601,!1);return r?.onDestroy(o.unsubscribe.bind(o)),U_(()=>{let a=s();switch(a.kind){case 1:return a.value;case 2:throw a.error;case 0:throw new Ku(601,!1)}},{equal:e?.equal})}function dx(n=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&n(e.value,t.value)}function px(n,e){if(n&1){let t=Xu();we(0,"li")(1,"a",31),Zu("click",function(){Wu(t);let i=eh();return $u(i.auth.logout({logoutParams:{returnTo:i.document.location.origin}}))}),it(2,"Logout "),Ne()()}}function mx(n,e){if(n&1){let t=Xu();we(0,"li")(1,"a",31),Zu("click",function(){Wu(t);let i=eh();return $u(i.auth.loginWithRedirect())}),it(2,"Login "),Ne()()}}var wa=class n{constructor(e){this.cartService=e;this.auth.isAuthenticated$.subscribe(t=>console.log(t))}auth=Us(W_);document=Us(B_);authSignal=wg(this.auth.isAuthenticated$);static \u0275fac=function(t){return new(t||n)(N_(H_))};static \u0275cmp=qa({type:n,selectors:[["app-navbar"]],standalone:!0,features:[ja],decls:57,vars:4,consts:[[1,"navbar","bg-base-100"],[1,"navbar-start"],[1,"dropdown"],["tabindex","0","role","button",1,"btn","btn-ghost","lg:hidden"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h8m-8 6h16"],["tabindex","0",1,"menu","menu-sm","dropdown-content","bg-base-100","rounded-box","z-[1]","mt-3","w-52","p-2","shadow"],["routerLink","man-section"],["routerLink","woman-section"],["routerLink","contact"],["routerLink","home",1,"btn","btn-ghost","text-xl"],[1,"navbar-center","hidden","lg:flex"],[1,"menu","menu-horizontal","px-1"],[1,"navbar-end"],[1,"flex-none"],[1,"dropdown","dropdown-end"],["tabindex","0","role","button",1,"btn","btn-ghost","btn-circle"],[1,"indicator"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","m-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"],[1,"badge","badge-sm","indicator-item"],["tabindex","0",1,"card","card-compact","dropdown-content","bg-base-100","z-[1]","mt-3","w-52","shadow"],[1,"card-body"],[1,"text-lg","font-bold"],[1,"text-info"],[1,"card-actions"],["routerLink","cart",1,"btn","btn-primary","btn-block"],["tabindex","0","role","button",1,"btn","btn-ghost","btn-circle","avatar"],[1,"w-10","rounded-full"],["alt","Tailwind CSS Navbar component","src","https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp"],["routerLink","profile"],[3,"click"]],template:function(t,r){t&1&&(we(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),Qu(),we(4,"svg",4),yr(5,"path",5),Ne()(),Hu(),we(6,"ul",6)(7,"li",7)(8,"a"),it(9,"Man"),Ne()(),we(10,"li",8)(11,"a"),it(12,"Woman"),Ne()(),we(13,"li",9)(14,"a"),it(15,"Contact"),Ne()()()(),we(16,"a",10),it(17,"Shop"),Ne()(),we(18,"div",11)(19,"ul",12)(20,"li",7)(21,"a"),it(22,"Man"),Ne()(),we(23,"li",8)(24,"a"),it(25,"Woman"),Ne()(),we(26,"li",9)(27,"a"),it(28,"Contact"),Ne()()()(),we(29,"div",13)(30,"div",14)(31,"div",15)(32,"div",16)(33,"div",17),Qu(),we(34,"svg",18),yr(35,"path",19),Ne(),Hu(),we(36,"span",20),it(37),Ne()()(),we(38,"div",21)(39,"div",22)(40,"span",23),it(41),Ne(),we(42,"span",24),it(43),Ne(),we(44,"div",25)(45,"button",26),it(46," View cart "),Ne()()()()(),we(47,"div",15)(48,"div",27)(49,"div",28),yr(50,"img",29),Ne()(),we(51,"ul",6),D_(52,px,3,0,"li")(53,mx,3,0,"li"),we(54,"li",30)(55,"a"),it(56,"Profile"),Ne()()()()()()()),t&2&&(Bs(37),O_(r.cartService.totalCartItems()),Bs(4),th("",r.cartService.totalCartItems()," Items"),Bs(2),th("Subtotal: $ ",r.cartService.totalCartCost()," "),Bs(9),V_(r.authSignal()?52:53))},dependencies:[z_],changeDetection:0})};var gu=class n{title="e-commerce";static \u0275fac=function(t){return new(t||n)};static \u0275cmp=qa({type:n,selectors:[["app-root"]],standalone:!0,features:[ja],decls:3,vars:0,consts:[[1,"max-w-screen-xl","mx-auto"]],template:function(t,r){t&1&&(yr(0,"app-navbar"),we(1,"div",0),yr(2,"router-outlet"),Ne())},dependencies:[G_,wa]})};j_(gu,D0).catch(n=>console.error(n));
